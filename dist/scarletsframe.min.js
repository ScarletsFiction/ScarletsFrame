/*
  ScarletsFrame
  A frontend library for Scarlets Framework that support
  lazy page load and element binding that can help
  simplify your code

  https://github.com/ScarletsFiction/ScarletsFrame
*/
"undefined"==typeof sf&&(sf=function(){if(arguments[0].constructor===Function)return sf.loader.onFinish.apply(null,arguments)}),setTimeout(function(){sf(sf.router.init)},10),"undefined"!=typeof $&&$.fn&&$.fn.extend||setTimeout(function(){console.clear(),console.error("Please load jQuery before before ScarletsFrame")},1e3),$.fn.extend({animateCSS:function(e,t,r){var n=this,o={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var i in o)if(void 0!==n[0].style[i]){o=o[i];break}return r&&n.css("-webkit-animation-duration",r+"s").css("animation-duration",r+"s"),n.addClass("animated "+e).one(o,function(){setTimeout(function(){$(n).removeClass("animated "+e)},1),r&&$(n).css("-webkit-animation-duration","").css("animation-duration",""),"function"==typeof t&&t()}),n}}),sf.controller=new function(){var self=this,controller={};self.active={},self.for=function(e,t){sf.model.root[e]||(sf.model.root[e]={}),controller[e]=t},self.modelScope=function(e,t=!1){var r=$(e),n=sf.controller.modelName(e);if(!n)throw"model or controller was not found";var o=r.attr("[sf-bind-list]");if(o||(o=r.parents("[sf-bind-list]").attr("sf-bind-list")),!o)return t?t(sf.model.root[n],-1):sf.model.root[n];var i=0;return o&&(i=r.parents("[sf-bind-list]").prevAll("[sf-bind-list]").length),t?t(sf.model.root[n][o],i):sf.model.root[n][o][i]},self.modelName=function(e){return e.attributes["sf-controller"]?e.attributes["sf-controller"].value:$(e).parents("[sf-controller]").attr("sf-controller")};var listenSFClick=function(e){var element=$(e.target),script=element.attr("sf-click");script||(element=element.parents("[sf-click]").eq(0),script=element.attr("sf-click"));var model=element.parents("[sf-model]").attr("sf-model");if(sf.model.root[model]||(model=element.parents("[sf-controller]").attr("sf-controller")),!sf.model.root[model])throw"Couldn't find model for "+model+" that was called from sf-click";var _modelScope=sf.model.root[model],modelKeys=sf.model.modelKeys(_modelScope),scopeMask=RegExp("(?<=\\b[^.]|^|\\n| +|\\t|\\W )("+modelKeys+")(?=(?:[^\"']*(?:'|\")[^\"']*(?:'|\"))*[^\"']*$)\\b","g");script=script.replace(scopeMask,function(e,t){return"_modelScope."+t}),script=script.split("(");var method=script[0],method_=method;try{method=eval(method)}catch(e){method=!1}if(method){script.shift(),script=script.join("("),script=script.split(")"),script.pop(),script=script.join("("),0!==script.length&&(script=eval("["+script+"]")),script||(script=[]);try{method.apply(element,script)}catch(e){console.error("Error on sf-click for model: "+model+"\n",e.target,"\n",e)}}else console.error("Error on sf-click for model: "+model+" [Cannot find "+method_+"]\n",e.target)};self.run=function(e,t){if(!sf.loader.DOMWasLoaded)return sf(function(){self.run(e,t)});controller[e]&&(self.active[e]||(controller[e]&&controller[e](sf.model.root[e],sf.model.root),$('[sf-controller="'+e+'"]').on("click","[sf-click]",listenSFClick),self.active[e]=!0)),t&&t(sf.model.root[e],sf.model.root),controller[e]&&delete controller[e]},self.init=function(){if(!sf.loader.DOMWasLoaded)return sf(function(){self.init(name)});$("[sf-controller]").each(function(){self.run(this.attributes["sf-controller"].value)})}},sf.loader=new function(){var e=this;e.loadedContent=0,e.totalContent=1,e.DOMWasLoaded=!1;var t=[],r=[];e.onFinish=function(r){if(e.DOMWasLoaded)return r();-1===t.indexOf(r)&&t.push(r)},e.onProgress=function(t){if(e.DOMWasLoaded)return t(e.loadedContent,e.totalContent);-1===r.indexOf(t)&&r.push(t)},e.f=function(t){e.loadedContent++;for(var n=0;n<r.length;n++)r[n](e.loadedContent,e.totalContent);t&&t.removeAttribute&&t.removeAttribute("onload")},e.css=function(t){if(e.DOMWasLoaded){for(var r=t.length-1;r>=0;r--)0!==$('link[href*="'+t[r]+'"]').length&&t.splice(r,1);if(0===t.length)return}e.totalContent=e.totalContent+t.length;var n="";for(r=0;r<t.length;r++)n+='<link onload="sf.loader.f(this);" rel="stylesheet" href="'+t[r]+'">';$(function(){document.getElementsByTagName("body")[0].innerHTML+=n})},e.js=function(t,r="body"){if(e.DOMWasLoaded){for(var n=t.length-1;n>=0;n--)0!==$('script[src*="'+t[n]+'"]').length&&t.splice(n,1);if(0===t.length)return}e.totalContent=e.totalContent+t.length;for(n=0;n<t.length;n++)$.ajax({url:t[n],dataType:"script",cache:!0,success:sf.loader.f})};var n=setInterval(function(){if(/loaded|complete/.test(document.readyState)){clearInterval(n),e.DOMWasLoaded=!0;for(var o=0;o<t.length;o++)t[o]();r.splice(0),t.splice(0)}},100)},sf.prototype.constructor=sf.loader.onFinish,$(function(){$("img:not(onload)[src]").each(function(){sf.loader.totalContent++,this.setAttribute("onload","sf.loader.f(this)")})}),sf.model=new function(){var self=this,bindingEnabled=!1;self.root={};var skipQuotes="(?=(?:[^\"']*(?:'|\")[^\"']*(?:'|\"))*[^\"']*$)",processingElement=null,bracketMatch=RegExp("([\\w.]*?[\\S\\s])\\("+skipQuotes,"g"),chackValidFunctionCall=/[a-zA-Z0-9 \]\$\)]/,allowedFunction=[":","for","if","while","_content_.take","console.log"],localEval=function(script_,_model_,_modelScope,_content_){var script=script_;script_=script_.split('\\"').join("\\$%*").split("\\'").join("\\%$*");for(var preventExecution=!1,check=null;null!==(check=bracketMatch.exec(script_));)if(check[1]=check[1].trim(),-1===allowedFunction.indexOf(check[1])&&"_modelScope"!==check[1].split(".")[0]&&chackValidFunctionCall.test(check[1][check[1].length-1])){preventExecution=check[1];break}var _result_="";if(script_=script_.split("\\$%*").join('\\"').split("\\%$*").join("\\'"),preventExecution)return console.error("Trying to executing unrecognized function ("+preventExecution+")"),console.log($(processingElement.outerHTML)[0]),console.log(script_),"";var _evaled_=eval(script_);return""!==_result_?_result_:_evaled_};self.for=function(e,t){self.root[e]||(self.root[e]={}),t(self.root[e],self.root)},self.modelKeys=function(e){for(var t=Object.keys(e),r=t.length-1;r>=0;r--)-1!==t[r].indexOf("$")&&t.splice(r,1);return t.join("|")};var clearElementData=function(e){e.innerHTML="";for(var t=0;t<e.attributes.length;t++){var r=e.attributes[t].name;"sf-bind-list"!==r&&e.removeAttribute(r)}e.setAttribute("style","display:none")},dataParser=function(e,t,r,n,o=""){var i=self.root[n],a=RegExp("(?<=\\b[^.]|^|\\n| +|\\t|\\W )("+self.modelKeys(i)+")"+skipQuotes+"\\b","g");if(r)var s=RegExp("(?<=\\b[^.]|^|\\n| +|\\t|\\W )"+r+"\\."+skipQuotes+"\\b","g");return bindingEnabled=!0,e.replace(/{{([^@].*?)}}/g,function(e,n){return n=n.split('\\"').join("\\$%*").split("\\'").join("\\%$*"),r&&(n=n.replace(s,function(e){return"_model_."+e[0].slice(1)})),n=(n=n.replace(a,function(e,t){return"_modelScope."+t})).split("\\$%*").join('\\"').split("\\%$*").join("\\'"),(n=""+localEval.apply(self.root,[o+n,t,i])).replace(/[\u00A0-\u9999<>\&]/gim,function(e){return"&#"+e.charCodeAt(0)+";"})})},uniqueDataParser=function(e,t,r,n){var o={length:0,take:function(e,o){if(!e)return dataParser(this[o],t,r,n);var i='"use strict";var ',a=!0;for(var s in e)"string"==typeof e[s]?e[s]='"'+e[s].split('"').join('\\"')+'"':"object"==typeof e[s]&&(e[s]=JSON.stringify(e[s])),a||(i+=","),i+=s+" = "+e[s],a=!1;return i=i.split("(").join("").split(")").join(""),dataParser(this[o],t,r,n,i+";")}};e=e.replace(/{\[(.*?)\]}/gs,function(e,t){return o[o.length]=t,o.length++,"_result_ += _content_.take(&VarPass&, "+(o.length-1)+");"});var i=self.root[n],a=RegExp("(?<=\\b[^.]|^|\\n| +|\\t|\\W )("+self.modelKeys(i)+")"+skipQuotes+"\\b","g");if(r)var s=RegExp("(?<=\\b[^.]|^|\\n| +|\\t|\\W )"+r+"\\."+skipQuotes+"\\b","g");return e.replace(/{{(@.*?)}}/gs,function(e,n){n=n.split('\\"').join("\\$%*").split("\\'").join("\\%$*"),r&&(n=n.replace(s,function(e){return"_model_."+e[0].slice(1)}));var l=!1;if(1!=(l=(n=(n=n.replace(a,function(e,t){return"_modelScope."+t})).split("\\$%*").join('\\"').split("\\%$*").join("\\'")).split("@if ")).length&&(l=l[1].split(":"),localEval.apply(self.root,[l[0],t,i,o])))return l.shift(),l.join(":");var f=n.match(/(?<=var|let)[\w,\s]+(?=\s(?==|in|of))/g);if(f){for(var c=[],d=0;d<f.length;d++)f[d].replace(/([\n\t\r]|  )+/g,"").split(",").forEach(function(e){c.push(e)});f=c;for(d=0;d<f.length;d++)f[d]+=":(typeof "+f[d]+'!="undefined"?'+f[d]+":undefined)";f="{"+f.join(",")+"}",n=n.split("&VarPass&").join(f)}return 1!=(l=n.split("@exec")).length?(l=l[1].split("&lt;").join("<").split("&gt;").join(">").split("&amp;").join("&"),n=localEval.apply(self.root,[l,t,i,o])):""})},bindArray=function(e,t,r,n,o){for(var i=JSON.parse(JSON.stringify(t)),a=["pop","push","splice","shift","unshift","refreshBind"],s=function(t,i=!1,a=!1){var s=$("[sf-model='"+n+"']");if(0===s.length&&(s=$("[sf-controller='"+n+"']")),0!==s.length){s=s.find("[sf-bind-list='"+o+"']");var l=!1;if(self.root[n]["on$"+o]&&(l=self.root[n]["on$"+o]),i){var f=self.root[n][o][t],c=uniqueDataParser(e,f,r,n);c=dataParser(c,f,r,n),c=$(c),s[t]?a?(l.create&&l.create(c[0]),c.insertBefore(s[0])):(l.update&&l.update(c[0]),s[t].outerHTML=c[0].outerHTML):(l.create&&l.create(c[0]),c.insertAfter(s[s.length-1]))}else if(s[t]){var d=!1,u=function(){if(!d){if(d=!0,s.length<=1)return clearElementData(s[t]);s[t].remove()}};l.remove?l.remove(s[t],u)||setTimeout(u,800):u()}}},l=function(e,t){Object.defineProperty(e,t,{enumerable:!1,configurable:!0,value:function(){var e=void 0;if(Array.prototype[t]&&(e=Array.prototype[t].apply(this,arguments)),"pop"===t)s(this.length);else if("push"===t)s(this.length-1,!0);else if("shift"===t)s(0);else if("splice"===t)if(arguments.length>=3)arguments[0]=!1,t="refreshBind";else{var r=arguments[0];r<0&&(r=this.length+r+1);var n=arguments[1];n||(n=this.length-r);for(var o=0;o<n;o++)s(r)}else"unshift"===t&&s(0,!0,!0);if("refreshBind"===t)if(arguments[0]||0===arguments[0])s(arguments[0],!0);else{var a=!1;for(o=0;o<this.length;o++)JSON.stringify(i[o])!==JSON.stringify(this[o])&&(a=!0,s(o,!0));a&&(i=JSON.parse(JSON.stringify(this)))}return e}})},f=0;f<a.length;f++)l(t,a[f])},loopParser=function(e,t,r){var n="",o=r.split(" in "),i=o[0];if(!self.root[e])return console.error("Can't parse element because model for '"+e+"' was not found",$(t)[0]);var a=self.root[e][o[1]];if(t=(t=(processingElement=$(t).attr("sf-bind-list",o[1])[0]).outerHTML).replace(/  +|\t+/g,""),2===o.length){for(var s in a){var l=a[s];temp=uniqueDataParser(t,l,i,e),temp=dataParser(temp,l,i,e),n+=temp}Object.defineProperty(self.root[e],o[1],{enumerable:!0,configurable:!0,get:function(){return a},set:function(e){for(var t=0;t<e.length;t++)a[t]?(a[t]=e[t],a.refreshBind(t)):a.push(e[t]);return a.length>e.length&&a.splice(a.length-e.length),a}}),bindArray(t,a,i,e,o[1])}return n},bindInput=function(){$("input[sf-bound]").each(function(){var e=$(this),t=e.parents("[sf-controller]").attr("sf-controller");if(t){var r=e.attr("sf-bound");void 0!==typeof self.root[t][r]?(e.attr("sf-bounded",r),e.removeAttr("sf-bound"),e.keyup(function(n){self.root[t][r]=e.val()}),e.attr("value","{{"+r+"}}"),bindObject(e,self.root[t],r,"attr")):console.error('Cannot get reference for self.root["'+t+'"]["'+r+'"]')}})};function DOMNodeInserted(e){sf.controller.run(sf.controller.modelName(e))}function DOMNodeRemoved(e){var t=sf.controller.modelName(e);$(e).find("[sf-bind-id], [sf-bind-list], [sf-bounded], [sf-repeat-this]").each(function(){removeBinding(this,t)}),removeBinding(e)}self.init=function(e=!1){self.queuePreprocess(e),self.parsePreprocess(e),$("[sf-repeat-this]").each(function(){var e=$(this),t=e.parent(),r=e.next();r.length&&e[0]!==r[0]||(r=!1);var n=e.before();n.length&&e[0]!==n[0]||(n=!1);var o=e.attr("sf-repeat-this");e.removeAttr("sf-repeat-this");var i=e.parents("[sf-controller]").attr("sf-controller"),a=this.outerHTML;if(/sf-bind-id|sf-bind-list/.test(a))throw"Can't parse element that already bound";var s=loopParser(i,a,o);s?(e.remove(),s=$(s),r?s.insertBefore(r):n?s.insertAfter(n):t.append(s)):(e.attr("sf-bind-list",o.split(" in ")[1]),clearElementData(this))})},$(function(){"function"==typeof MutationObserver&&MutationObserver.prototype.observe?new MutationObserver(function(e){if(bindingEnabled)for(var t in e){for(var r in e[t].addedNodes){var n=e[t].addedNodes[r].attributes;n&&n["sf-controller"]&&DOMNodeInserted(e[t].addedNodes[r])}for(var r in e[t].removedNodes){var o=e[t].removedNodes[r].nodeName;"TEXT"===o&&"#comment"===o&&DOMNodeRemoved(e[t].removedNodes[r])}}}).observe(document.body,{childList:!0,subtree:!0}):(document.body.addEventListener("DOMNodeInserted",function(e){bindingEnabled&&e.target.attributes&&e.target.attributes["sf-controller"]&&DOMNodeInserted(e.target)}),document.body.addEventListener("DOMNodeRemoved",function(e){if(bindingEnabled){var t=e.target.nodeName;if("TEXT"!==t||"#comment"!==t)return;DOMNodeRemoved(e.target)}}))});var removeBinding=function(e,t=!1){if(e.attributes){var r=e.attributes;if(r["sf-bind-id"]){var n=r["sf-bind-id"].value;if(!bindRef[n])return;for(var o=bindRef[n],i=0;i<o.propertyName.length;i++){var a=o.object[o.propertyName[i]];Object.defineProperty(o.object,o.propertyName[i],{configurable:!0,enumerable:!0,writable:!0,value:a})}delete bindRef[n];var s=bindRef.cache;for(var i in s)s[i].callback&&s[i].callback[n]&&delete s[i].callback[n],$.isEmptyObject(s[i].callback)&&delete s[i];s[n]&&(delete s[n].attrs,delete s[n].innerHTML,delete s[n].modelName,delete s[n].model,delete s[n].created,delete s[n].element),bindRef.length--,0===bindRef.length&&(bindRef.index=0)}if(t){var l=!1;r["sf-bind-list"]&&(l=r["sf-bind-list"].value),r["sf-repeat-this"]&&(l=r["sf-repeat-this"].value.split(" in ")[1]),r["sf-bounded"]&&(l=r["sf-bounded"].value);for(i=0;i<t.length;i++){var f=self.root[t[i]];if(f[l]){a=f[l].slice(0);Object.defineProperty(f,l,{configurable:!0,enumerable:!0,writable:!0,value:a})}}}}},bindRef={length:0,index:0,cache:{}};self.bindRef=bindRef;var dcBracket=/{{.*?}}/,bindObject=function(e,t,r,n){e instanceof Node||(e=e[0]),processingElement=e;var o=bindRef.index;$(e).attr("sf-bind-id",o),bindRef.index++,bindRef.length++,bindRef.cache[o]={};var i=bindRef.cache[o];if(i.attrs={},i.innerHTML="",i.modelName=sf.controller.modelName(e),i.model=self.root[i.modelName],i.created=Date.now(),"attr"===n||!n)for(var a in e.attributes)if(dcBracket.test(e.attributes[a].value)){var s=e.attributes[a].name;i.attrs[s]=e.attributes[a].value,"value"===s&&e.removeAttribute(s)}"html"!==n&&n||(i.innerHTML=e.innerHTML),bindRef[o]||(bindRef[o]={object:t,propertyName:[]}),bindRef[o].propertyName.push(r),i.element=$(e);var l=function(){if("attr"===n||!n)for(var e in i.attrs)if(-1!==i.attrs[e].indexOf(r)){var t=dataParser(i.attrs[e],i.model,!1,i.modelName);"value"===e?i.element.val(t):i.element.attr(e,t);break}if("html"===n||!n){t=uniqueDataParser(i.innerHTML,i.model,!1,i.modelName);t=dataParser(t,i.model,!1,i.modelName),i.element.html(t)}};if(Object.getOwnPropertyDescriptor(i.model,r).set){for(var a in bindRef)if(i.model===bindRef[a].object&&-1!==bindRef[a].propertyName.indexOf(r)){bindRef.cache[a].callback[o]=l;break}}else{i.callback={},i.callback[o]=l;var f=t[r];Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:function(){return f},set:function(e){for(var t in f=e,i.callback)i.callback[t]();return f}})}};self.bindElement=function(e,t=!1){var r=sf.controller.modelName(e),n=self.root[r];if(!n)return console.error("Model for "+r+" was not found while binding:",e);var o=RegExp("(?<=\\b[^.]|^|\\n| +|\\t|\\W )("+self.modelKeys(n)+")"+skipQuotes+"\\b","g"),i=e.outerHTML;if(/sf-bind-id|sf-bind-list/.test(i))throw"Can't parse element that already bound";"attr"===t&&(i=i.replace(e.innerHTML,""));for(var a=i.match(/(?<={{).*?(?=}})/gs),s=0;s<a.length;s++)for(;null!==(bindable=o.exec(a[s]));)bindObject(e,n,bindable[s],t)},self.queuePreprocess=function(e=!1){for(var t=(e||document.body).childNodes,r=["html","head","style","link","meta","script","object","iframe"],n=0;n<r.length;n++)r[n]=r[n].toUpperCase();var o=[];for(n=0;n<t.length;n++){var i=t[n];if(-1===r.indexOf(i.nodeName))if(1===i.nodeType){var a=i.attributes;if(a["sf-bind-id"]||a["sf-repeat-this"]||a["sf-bind-list"])continue;for(var s=0;s<a.length;s++)-1!==a[s].value.indexOf("{{")&&(i.setAttribute("sf-preprocess","attronly"),o.push(i));self.queuePreprocess(i)}else if(3===i.nodeType&&-1!==i.nodeValue.indexOf("{{")){i.parentNode.setAttribute("sf-preprocess","");for(s=0;s<o.length;s++)o[s].removeAttribute("sf-preprocess");return}}},self.parsePreprocess=function(e=!1){$(e||document.body).find("[sf-preprocess]").each(function(){var e=sf.controller.modelName(this);if(this.removeAttribute("sf-preprocess"),!self.root[e])return console.error("Can't parse element because model for '"+e+"' was not found",this);if(processingElement=this,/sf-bind-id|sf-bind-list/.test(this.innerHTML))return console.error("Can't parse element that already bound"),void console.log($(processingElement.outerHTML)[0]);$(this).attr("sf-bind")&&self.bindElement(this,$(this).attr("sf-bind"));var t=uniqueDataParser(this.innerHTML,self.root[e],!1,e);this.innerHTML=dataParser(t,self.root[e],!1,e);for(var r=0;r<this.attributes.length;r++)-1!==this.attributes[r].value.indexOf("{{")&&(this.attributes[r].value=dataParser(this.attributes[r].value,self.root[e],!1,e))}),bindInput()}},sf.router=new function(){var e=this;e.loading=!1,e.enabled=!1,e.currentPage=[];var t=!1,r=!1,n="";e.init=function(){if(!sf.loader.DOMWasLoaded)return sf(function(){e.init()});e.lazy(),$("[sf-page]").each(function(){var e=this.attributes["sf-page"].value;a(e)}),t=!0,n=window.location.pathname},e.enable=function(t=!0){e.enabled=t,t?e.lazy():$("a[href][onclick]").each(function(){var e=$(this);"return sf.router.load(this)"===e.attr("onclick")&&e.removeAttr("onclick")})};var o={};e.before=function(e,t,r=!1){o[e]||(o[e]=[]),!1===r?-1===o[e].indexOf(t)&&o[e].push(t):o[e][r]=t};var i={};e.after=function(e,t,r=!1){i[e]||(i[e]=[]),!1===r?-1===i[e].indexOf(t)&&i[e].push(t):i[e][r]=t};var a=function(t,r=!1){if(-1===e.currentPage.indexOf(t)&&e.currentPage.push(t),sf.controller.init(),sf.model.init(r),o[t]){sf.model.root[t]||(sf.model.root[t]={});for(var n=0;n<o[t].length;n++)o[t][n](sf.model.root)}},s={loading:[],loaded:[],special:[],error:[]};e.on=function(e,t){-1===s[e].indexOf(t)&&s[e].push(t)},e.lazyViewPoint={},e.lazy=function(){e.enabled&&$("a[href]:not([onclick])").each(function(){var e=this.href;-1===e.indexOf("#")&&(0!==e.indexOf(window.location.origin)&&"/"!==e.charAt(0)||$(this).attr("onclick","return sf.router.load(this)"))})},e.load=function(e){return!history.pushState||"ignore"==$(e).attr("sf-router")||!f(e.href.replace(window.location.origin,""))};var l=!1,f=function(o){for(var f=0;f<s.loading.length;f++)if(s.loading[f](o))return;window.location.pathname;return t=!1,r&&r.abort(),r=loadURL(window.location.origin+o,{data:{_scarlets:".dynamic."},success:function(l){if(!t){!0,r=!1;var f=!1,d={};if(l=l.replace(/<!-- SF-Special:(.*?)-->(?=(?:[^"\']*(?:\'|")[^"\']*(?:\'|"))*[^"\']*$)/g,function(e,t){var r=t.split("--|&>").join("--\x3e");return d=Object.assign(d,JSON.parse(r)),""}),!$.isEmptyObject(d))for(var u=0;u<s.special.length;u++)if(s.special[u](d))return;for(u=0;u<s.loaded.length;u++)f=s.loaded[u](n,o,l)||f;var p=!1;if(!f){var m=function(t){(function(){if(-1===e.currentPage.indexOf(name)&&e.currentPage.splice(e.currentPage.indexOf(name),1),""!==e.currentPage&&i[e.currentPage]){sf.model.root[e.currentPage]||(sf.model.root[e.currentPage]={});for(var t=0;t<i[e.currentPage].length;t++)i[e.currentPage][t](sf.model.root)}})((p=$(t)).find("[sf-page]")),p.html(l);var r=p.find("title").eq(0).html();r&&$("head title").html(r),h=!0},h=!1;for(var b in e.lazyViewPoint){if(-1!==n.indexOf(b))for(var v in e.lazyViewPoint[b])if(-1!==n.indexOf(b)){m(e.lazyViewPoint[b][v]);break}if(h)break}if(!h&&(sf.router.lazyViewPoint["@default"]&&m(sf.router.lazyViewPoint["@default"]),!h))for(u=0;u<s.error.length;u++)s.error[u]('sf.router.lazyViewPoint["'+b+'"]["'+v+'"] was not found');if(t)return}e.lazy(),p||(p=$("body")),p.find("[sf-controller], [sf-page]").each(function(){this.attributes["sf-controller"]&&sf.controller.run(this.attributes["sf-controller"].value),this.attributes["sf-page"]&&a(this.attributes["sf-page"].value,p[0])}),t=!0,!1,n=o,c=!1}},error:function(e,t){r=!1;for(var n=0;n<s.error.length;n++)s.error[n](e.status,t);c=!0,window.history.back()}}),l||window.history.pushState(null,"",o),l=!1,!0},c=!1;window.addEventListener("popstate",function(e){c?c=!1:(l=!0,f(window.location.pathname))},!1)};
//# sourceMappingURL=scarletsframe.min.js.map
