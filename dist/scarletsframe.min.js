/*
  ScarletsFrame
  A frontend library for Scarlets Framework that support
  lazy page load and element binding that can help
  simplify your code

  https://github.com/ScarletsFiction/ScarletsFrame
*/
!function(e,t){var r=null;if("object"==typeof exports&&"undefined"!=typeof module){if(null===(r=require("dom7")))return void console.log("ScarletsFrame can't load Dom7!");void 0===r.fn.one&&(r.fn.one=r.fn.once),module.exports=t(r,e)}else{if("undefined"!=typeof Dom7)r=Dom7;else{if("undefined"==typeof jQuery)throw"Please load jQuery or Dom7 before ScarletsFrame";r=jQuery}e.sf=t(r,e)}}("undefined"!=typeof window?window:this,function($,window){"use strict";void 0===typeof document&&(document=window.document);var sf=function e(){if(arguments[0].constructor===Function)return e.loader.onFinish.apply(null,arguments)};return sf.internal={},sf.regex={avoidQuotes:"(?=(?:[^\"']*(?:'|\")[^\"']*(?:'|\"))*[^\"']*$)",strictVar:"(?=\\b[^.]|^|\\n| +|\\t|\\W )"},$.fn.extend||($.fn.extend=function(e){for(var t in e)$.fn[t]=e[t]}),$.isEmptyObject||($.isEmptyObject=function(e){for(var t in e)return!1;return!0}),$.fn.extend({animateCSS:function(e,t,r){var n=this,o={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var i in o)if(void 0!==n[0].style[i]){o=o[i];break}return r&&n.css("-webkit-animation-duration",r+"s").css("animation-duration",r+"s"),n.addClass("animated "+e).one(o,function(){setTimeout(function(){$(n).removeClass("animated "+e)},1),r&&$(n).css("-webkit-animation-duration","").css("animation-duration",""),"function"==typeof t&&t()}),n}}),sf.controller=new function(){var self=this;self.pending={},self.active={},self.for=function(e,t){self.pending[e]=t},self.modelScope=function(e,t){var r=$(e),n=sf.controller.modelName(e);if(!n)throw"model or controller was not found";var o=r.attr("[sf-bind-list]");if(o||(o=r.parents("[sf-bind-list]").attr("sf-bind-list")),!o)return t?t(sf.model.root[n],-1):sf.model.root[n];var i=0;return o&&(i=r.parents("[sf-bind-list]").prevAll("[sf-bind-list]").length),t?t(sf.model.root[n][o],i):sf.model.root[n][o][i]},self.modelName=function(e){var t=void 0;return void 0===(t=e.attributes["sf-controller"]?e.attributes["sf-controller"].value:$(e).parents("[sf-controller]").attr("sf-controller"))||self.active[t]||self.run(t),t};var listenSFClick=function listenSFClick(e){var element=$(e.target),script=element.attr("sf-click");script||(element=element.parents("[sf-click]").eq(0),script=element.attr("sf-click"));var model=element.parents("[sf-controller]").attr("sf-controller");if(!sf.model.root[model])throw"Couldn't find model for "+model+" that was called from sf-click";var _modelScope=sf.model.root[model],modelKeys=sf.model.modelKeys(_modelScope),scopeMask=RegExp(sf.regex.strictVar+"("+modelKeys+")"+sf.regex.avoidQuotes+"\\b","g");script=script.replace(scopeMask,function(e,t){return"_modelScope."+t}),script=script.split("(");var method=script[0],method_=method;try{method=eval(method)}catch(e){method=!1}if(method){script.shift(),script=script.join("("),script=script.split(")"),script.pop(),script=script.join("("),0!==script.length&&(script=eval("["+script+"]")),script||(script=[]);try{method.apply(element[0],script)}catch(e){console.error("Error on sf-click for model: "+model+"\n",e.target,"\n",e)}}else console.error("Error on sf-click for model: "+model+" [Cannot find "+method_+"]\n",e.target)},root_=function(e){return sf.model.root[e]||(sf.model.root[e]={}),sf.model.root[e]||sf.controller.run(e),sf.model.root[e]};self.run=function(e,t){if(!sf.loader.DOMWasLoaded)return sf(function(){self.run(e,t)});self.pending[e]&&(sf.model.root[e]||(sf.model.root[e]={}),self.pending[e](sf.model.root[e],root_),self.active[e]=!0,delete self.pending[e]),t&&t(sf.model.root[e],root_)},self.init=function(e){if(!sf.loader.DOMWasLoaded)return sf(function(){self.init(name)});$("[sf-controller]",e?$(e)[0]:document.body).each(function(){self.run(this.attributes["sf-controller"].value)})},$(document).one("DOMContentLoaded",function(){$(document.body).on("click","[sf-click]",listenSFClick)})},sf.loader=new function(){var e=this;e.loadedContent=0,e.totalContent=0,e.DOMWasLoaded=!1,e.DOMReady=!1,e.turnedOff=!1;var t=[],r=[],n=[];e.off=function(){e.turnedOff=!0},e.onFinish=function(t){if(e.DOMWasLoaded)return t();-1===r.indexOf(t)&&r.push(t)},e.domReady=function(r){if(e.DOMReady)return r();-1===t.indexOf(r)&&t.push(r)},e.onProgress=function(t){if(e.DOMWasLoaded)return t(e.loadedContent,e.totalContent);-1===n.indexOf(t)&&n.push(t)},e.f=function(t){e.loadedContent++;for(var r=0;r<n.length;r++)n[r](e.loadedContent,e.totalContent);t&&t.removeAttribute&&t.removeAttribute("onload")},e.css=function(t){if(e.DOMWasLoaded){for(var r=t.length-1;r>=0;r--)0!==$('link[href*="'+t[r]+'"]').length&&t.splice(r,1);if(0===t.length)return}e.totalContent=e.totalContent+t.length;var n="";for(r=0;r<t.length;r++)n+='<link onload="sf.loader.f(this);" rel="stylesheet" href="'+t[r]+'">';e.domReady(function(){document.getElementsByTagName("body")[0].innerHTML+=n})},e.js=function(t){if(e.DOMWasLoaded){for(var r=t.length-1;r>=0;r--)0!==$('script[src*="'+t[r]+'"]').length&&t.splice(r,1);if(0===t.length)return}e.totalContent=e.totalContent+t.length;for(r=0;r<t.length;r++)$.ajax({url:t[r],dataType:"script",cache:!0,complete:sf.loader.f})},setTimeout(function(){0!==e.totalContent||e.turnedOff||(e.loadedContent=e.totalContent=1,console.warn("If you don't use content loader feature, please turn it off with `sf.loader.off()`"))},1e4);var o=setInterval(function(){if(/loaded|complete/.test(document.readyState)){if(!1===e.DOMReady){e.DOMReady=!0;for(var i=0;i<t.length;i++)try{t[i]()}catch(e){console.error(e)}}if((e.loadedContent<e.totalContent||0===e.loadedContent)&&!e.turnedOff)return;clearInterval(o),e.DOMWasLoaded=!0;for(i=0;i<r.length;i++)try{r[i]()}catch(e){console.error(e)}n.splice(0),t.splice(0),r.splice(0),n=t=r=null,sf.controller.init(),sf.model.init(),sf.router.init()}},100)},sf.prototype.constructor=sf.loader.onFinish,sf.loader.domReady(function(){$("img:not(onload)[src]").each(function(){sf.loader.totalContent++,this.setAttribute("onload","sf.loader.f(this)")})},0),sf.model=function(e){return sf.model.root[e]||(sf.model.root[e]={}),sf.controller.pending[e]&&sf.controller.run(e),sf.model.root[e]},function(){var self=sf.model,bindingEnabled=!1;self.root={};var processingElement=null,bracketMatch=RegExp("([\\w.]*?[\\S\\s])\\("+sf.regex.avoidQuotes,"g"),chackValidFunctionCall=/[a-zA-Z0-9 \]\$\)]/,allowedFunction=[":","for","if","while","_content_.take","console.log"],localEval=function localEval(script_,_model_,_modelScope,_content_){var script=script_;script_=script_.split('\\"').join("\\$%*").split("\\'").join("\\%$*"),script_=script_.split("._modelScope").join(""),script_=script_.split("._model_").join("");for(var preventExecution=!1,check_=null;null!==(check_=bracketMatch.exec(script_));)if(check_[1]=check_[1].trim(),-1===allowedFunction.indexOf(check_[1])&&"_modelScope"!==check_[1].split(".")[0]&&chackValidFunctionCall.test(check_[1][check_[1].length-1])){preventExecution=check_[1];break}var _result_="";if(script_=script_.split("\\$%*").join('\\"').split("\\%$*").join("\\'"),preventExecution)return console.error("Trying to executing unrecognized function ("+preventExecution+")"),console.log($(processingElement.outerHTML)[0]),console.log(script_),"";try{if(!0===/@return /.test(script_)){var _evaled_=eval("(function(){"+script_.split("@return ").join("return ")+"})()");return _result_+_evaled_}var _evaled_=eval(script_)}catch(e){return console.error(e),console.log(script_),console.log($(processingElement.outerHTML)[0]),""}return""!==_result_?_result_:_evaled_};self.index=function(e){var t=$(e).prevAll(e.tagName).length,r=e.getAttribute("sf-bind-list");if(!r)return t;var n=sf.controller.modelScope(e)[r];return n.$virtual?t+n.$virtual.DOMCursor-1:t},self.for=function(e,t){if(!sf.loader.DOMWasLoaded)return sf(function(){self.for(e,t)});t(self(e),self)},self.modelKeys=function(e){for(var t=Object.keys(e),r=t.length-1;r>=0;r--)-1!==t[r].indexOf("$")&&t.splice(r,1);return t.join("|")};var clearElementData=function(e){$&&$.cleanData&&$.cleanData(e.getElementsByTagName("*")),e.innerHTML="";for(var t=0;t<e.attributes.length;t++){var r=e.attributes[t].name;"sf-bind-list"!==r&&e.removeAttribute(r)}e.setAttribute("style","display:none")},dataParser=function(e,t,r,n,o){var i=self.root[n];o||(o="");for(var l=self.modelKeys(i),s=l.length-1;s>=0;s--)i[l[s]]instanceof Function&&l.splice(s,1);var a=RegExp(sf.regex.strictVar+"("+l+")"+sf.regex.avoidQuotes+"\\b","g");if(r)var f=RegExp(sf.regex.strictVar+r+"\\."+sf.regex.avoidQuotes+"\\b","g");return bindingEnabled=!0,e.replace(/{{([^@][\s\S]*?)}}/g,function(e,n){return n=n.split('\\"').join("\\$%*").split("\\'").join("\\%$*"),r&&(n=n.replace(f,function(e){return"_model_."+e[0].slice(1)})),n=(n=n.replace(a,function(e,t){return"_modelScope."+t})).split("\\$%*").join('\\"').split("\\%$*").join("\\'"),(n=""+localEval.apply(self.root,[o+n,t,i])).replace(/[\u00A0-\u9999<>\&]/gim,function(e){return"&#"+e.charCodeAt(0)+";"})})},uniqueDataParser=function(e,t,r,n){var o={length:0,take:function(e,o){if(!e)return dataParser(this[o],t,r,n);var i='"use strict";var ',l=!0;for(var s in e)"string"==typeof e[s]?e[s]='"'+e[s].split('"').join('\\"')+'"':"object"==typeof e[s]&&(e[s]=JSON.stringify(e[s])),l||(i+=","),i+=s+" = "+e[s],l=!1;return!0===l&&(i=i.replace("var ","")),i=i.split("(").join("").split(")").join(""),dataParser(this[o],t,r,n,i+";")}};e=e.replace(/{\[([\s\S]*?)\]}/g,function(e,t){return!1===/{{.*?}}/.test(t)?"_result_ += '"+t.split("'").join("\\'")+"'":(o[o.length]=t,o.length++,"_result_ += _content_.take(&VarPass&, "+(o.length-1)+");")});var i=self.root[n],l=RegExp(sf.regex.strictVar+"("+self.modelKeys(i)+")"+sf.regex.avoidQuotes+"\\b","g");if(r)var s=RegExp(sf.regex.strictVar+r+"\\."+sf.regex.avoidQuotes+"\\b","g");return e.replace(/{{(@[\s\S]*?)}}/g,function(e,n){n=n.split('\\"').join("\\$%*").split("\\'").join("\\%$*"),r&&(n=n.replace(s,function(e){return"_model_."+e[0].slice(1)}));var a=!1;if(1!=(a=(n=(n=n.replace(l,function(e,t){return"_modelScope."+t})).split("\\$%*").join('\\"').split("\\%$*").join("\\'")).split("@if ")).length){var f=[(a=a[1].split(":"))[0],t,i,o];return 0==localEval.apply(self.root,f)?"":(a.shift(),f.splice(0,1,a.join(":").split("&VarPass&").join("{}")),localEval.apply(self.root,f))}for(var u=/(var|let)([\w,\s]+)(?=\s(?==|in|of))/g,c=[],d=null;null!==(d=u.exec(n));)c.push(d[2]);if(c.length){for(var p=[],v=0;v<c.length;v++)c[v].replace(/([\n\t\r]|  )+/g,"").split(",").forEach(function(e){p.push(e)});c=p;for(v=0;v<c.length;v++)c[v]+=":(typeof "+c[v]+'!=="undefined"?'+c[v]+":undefined)";c="{"+c.join(",")+"}",n=n.split("&VarPass&").join(c)}return 1!=(a=(n=n.split("&VarPass&").join("{}")).split("@exec")).length?(a=a[1].split("&lt;").join("<").split("&gt;").join(">").split("&amp;").join("&"),n=localEval.apply(self.root,[a,t,i,o])):""})},bindArray=function(e,t,r,n,o,i,l,s){var a=t.slice(0),f=["pop","push","splice","shift","unshift","softRefresh","hardRefresh"],u=-1,c=function(l,s){if(0===(a=$("[sf-controller='"+n+"']",i)).length){if(i.getAttribute("sf-controller")!==n)return;a=i}if(t.$virtual){var a=$(t.$virtual.elements());clearTimeout(u),u=setTimeout(function(){t.$virtual.refresh(!0)},100)}else a=$("[sf-bind-list='"+o+"']",a);var f=!1;if(self.root[n]["on$"+o]&&(f=self.root[n]["on$"+o]),-1===l){for(var c=self.root[n][o],d="",p=0;p<c.length;p++){var v=uniqueDataParser(e,c[p],r,n);d+=dataParser(v,c[p],r,n)}var h=a.eq(0).prev();return h[0]===a[0]?a.parent().prepend(d):$(d).insertAfter(h),void a.remove()}if("remove"!==s){c=self.root[n][o][l],v=uniqueDataParser(e,c,r,n);v=dataParser(v,c,r,n),v=$(v),a[l]&&"insertAfter"!==s?"insertBefore"===s?(f.create&&f.create(v[0]),v.insertBefore(a[0])):(f.update&&f.update(v[0]),$&&$.cleanData&&($.cleanData(a[l].getElementsByTagName("*")),$.cleanData(a[l])),a[l].outerHTML=v[0].outerHTML):(f.create&&f.create(v[0]),v.insertAfter(a[0!==l?l-1:a.length-1]))}else if(a[l]){var g=!1,m=function(){if(!g){if(g=!0,a.length<=1)return clearElementData(a[l]);a[l].remove()}};f.remove?f.remove(a[l],m)||setTimeout(m,800):m()}},d=function(e,t){Object.defineProperty(e,t,{enumerable:!1,configurable:!0,value:function(){var e=void 0,r=this.length;if(Array.prototype[t]&&(e=Array.prototype[t].apply(this,arguments)),"pop"===t)c(r-1,"remove");else if("push"===t)c(r,"add");else if("shift"===t)c(0,"remove");else if("splice"===t){if(null===arguments[0])return a.splice(0),e;var n=arguments[0];n<0&&(n=r+n);var o=arguments[1];o||0===o||(o=a.length);for(var i=o-1;i>=0;i--)c(n+i,"remove");if(arguments.length>=3){o=arguments.length-2;for(i=0;i<o;i++)c(n+i,"insertAfter")}}else if("unshift"===t)c(0,"insertBefore");else if("softRefresh"===t)if(arguments[0]||0===arguments[0])c(arguments[0],a[arguments[0]]?"add":"remove");else{var l=!1;if(a.length>this.length)for(i=a.length-1;i>=this.length;i--)-1===this.indexOf(a[i])&&(l=!0,c(i,"remove"));if(a.length<this.length)for(i=a.length-1;i<this.length;i++)l=!0,c(i,"insertBefore");for(i=0;i<this.length;i++)!1===compareObject(a[i],this[i])&&(l=!0,c(i,"add"));l&&(a=this.slice(0))}else"hardRefresh"===t&&c(-1,"remove");return Array.prototype[t]&&(a=this.slice(0)),e}})};l&&l.classList.contains("sf-virtual-list")&&(Object.defineProperty(t,"$virtual",{enumerable:!1,configurable:!0,value:{}}),t.$virtual.dom=document.createElement("div"),t.$virtual.dom.innerHTML=s,sf.internal.virtual_scroll.handle(t,i,l));for(var p=0;p<f.length;p++)d(t,f[p]);Object.defineProperty(t,"getElement",{enumerable:!1,configurable:!0,value:function(e){return t.$virtual?e<t.$virtual.DOMCursor?t.$virtual.dom.children[e]:(e-=t.$virtual.DOMCursor)-l.childElementCount+2<=0?l.children[e+1]:t.$virtual.dom.children[e+t.$virtual.DOMCursor]:l.childElementCount===t.length?l.children[e]:l.querySelectorAll('[sf-bind-list="'+o+'"]')[e]}})};function compareObject(e,t){if(!e||!t)return!1;for(var r in e)if("object"!=typeof e[r]&&e[r]!==t[r])return!1;return!0}var loopParser=function(e,t,r,n,o){var i="",l=r.split(" in "),s=l[0];if(!self.root[e])return console.error("Can't parse element because model for '"+e+"' was not found",$(t)[0]);var a=self.root[e][l[1]];if(t=(t=(processingElement=$(t).attr("sf-bind-list",l[1])[0]).outerHTML).replace(/  +|\t+/g,""),2===l.length){var f="";for(var u in a){var c=a[u];f=uniqueDataParser(t,c,s,e),i+=f=dataParser(f,c,s,e)}var d=self.root[e];void 0===d.sf$bindedKey&&initBindingInformation(d),void 0===d.sf$bindedKey[l[1]]&&(d.sf$bindedKey[l[1]]=null),Object.defineProperty(d,l[1],{enumerable:!0,configurable:!0,get:function(){return a},set:function(e){for(var t=0;t<e.length;t++)a[t]?(a[t]=e[t],a.softRefresh(t)):a.push(e[t]);return a.length>e.length&&a.splice(e.length),a}}),bindArray(t,a,s,e,l[1],n,o,i)}return i},bindInput=function(e){$("input[sf-bound]",e).each(function(){var e=sf.controller.modelName(this);if(e){var t=this.getAttribute("sf-bound");if(void 0!==typeof self.root[e][t]){this.setAttribute("sf-bounded",t),this.removeAttribute("sf-bound");var r=$(this);"INPUT"===this.tagName||"TEXTAREA"===this.tagName?r.on("keyup",function(n){self.root[e][t]=r.val()}):r.on("change",function(n){self.root[e][t]=r.val()})}else console.error('Cannot get reference for self.root["'+e+'"]["'+t+'"]')}})},alreadyInitialized=!1;function DOMNodeRemoved(e){$("[sf-controller]",e).each(function(){removeModelBinding(this.getAttribute("sf-controller"))}),!1!==e.hasAttribute("sf-controller")&&removeModelBinding(e.getAttribute("sf-controller"))}self.init=function(e){alreadyInitialized&&!e||(alreadyInitialized=!0,setTimeout(function(){alreadyInitialized=!1},50),e?e instanceof Node||(e=$(e)[0]):e=document.body,self.parsePreprocess(self.queuePreprocess(e)),bindInput(e),$("[sf-repeat-this]",e).each(function(){var t=$(this),r=t.parent();if(this.parentNode.classList.contains("sf-virtual-list")){var n=$(this.parentNode).children("[sf-repeat-this]")[0].tagName,o=document.createElement(n);o.classList.add("virtual-spacer"),o.classList.add("ceiling"),this.parentNode.prepend(o);var i=document.createElement(n);i.classList.add("virtual-spacer"),i.classList.add("floor"),this.parentNode.append(i);var l=window.getComputedStyle(this),s=parseFloat(l.marginTop)+parseFloat(l.marginBottom);l=null,s=Math.ceil(this.offsetHeight+s)}var a=t.next();a.length&&t[0]!==a[0]||(a=!1);var f=t.prev();f.length&&t[0]!==f[0]||(f=!1);var u=t.attr("sf-repeat-this");t.removeAttr("sf-repeat-this");var c=sf.controller.modelName(this),d=this.outerHTML;if(/sf-bind-key|sf-bind-list/.test(d))throw"Can't parse element that already bound";if(this.parentNode.classList.contains("sf-virtual-list"))loopParser(c,d,u,e,this.parentNode)?t.remove():(t.attr("sf-bind-list",u.split(" in ")[1]),clearElementData(this));else{var p=loopParser(c,d,u,e,this.parentNode);p?(t.remove(),p=$(p),a?p.insertBefore(a):f?p.insertAfter(f):r.append(p)):(t.attr("sf-bind-list",u.split(" in ")[1]),clearElementData(this))}}))},sf(function(){var e=function(e){var t=e.nodeName;"TEXT"!==t&&"#text"!==t&&"#comment"!==t&&DOMNodeRemoved(e)};if("function"==typeof MutationObserver&&MutationObserver.prototype.observe){var t=function(t){t.removedNodes.forEach(e)};new MutationObserver(function(e){bindingEnabled&&e.forEach(t)}).observe(document.body,{childList:!0,subtree:!0})}else document.body.addEventListener("DOMNodeRemoved",function(t){bindingEnabled&&e(t.target)})});var removeModelBinding=function(e){var t=self.root[e];if(void 0!==t){var r=t.sf$bindedKey,n=null;for(var o in r)if(delete r[o],void 0!==t[o]&&null!==t[o]){if(t[o].constructor===String||t[o].constructor===Number||t[o].constructor===Boolean);else{if(t[o].constructor!==Array)continue;t[o].$virtual&&(t[o].$virtual.destroy(),delete t[o].$virtual),n=t[o].splice("obtain"),delete t[o],t[o]=n}if(void 0!==Object.getOwnPropertyDescriptor(t,o)){n=t[o];delete t[o],t[o]=n}}}},dcBracket=/{{[\s\S]*?}}/,bindObject=function(e,t,r,n){e instanceof Node||(e=e[0]),processingElement=e,e.setAttribute("sf-bind-key",r);var o=sf.controller.modelName(e);if("attr"===n||!n){var i={};for(var l in e.attributes)if(dcBracket.test(e.attributes[l].value)){var s=e.attributes[l].name;"value"===s&&e.removeAttribute(s),i[s]=e.attributes[l].value}}if("html"===n||!n)var a=e.innerHTML;e=$(e);var f=function(){if("attr"===n||!n)for(var l in i)if(-1!==i[l].indexOf(r)){var s=dataParser(i[l],t,!1,o);"value"===l?e.val(s):e.attr(l,s);break}if("html"===n||!n){s=uniqueDataParser(a,t,!1,o);s=dataParser(s,t,!1,o),e.html(s)}};if(void 0===t[r])throw"Property '"+r+"' was not found on '"+o+"' model";if(void 0===t.sf$bindedKey&&initBindingInformation(t),void 0===t.sf$bindedKey[r]){var u=t[r];Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:function(){return u},set:function(e){u=e;for(var n=t.sf$bindedKey[r],o=0;o<n.length;o++)n[o]();return u}}),t.sf$bindedKey[r]=[f]}else t.sf$bindedKey[r].push(f)};function initBindingInformation(e){void 0===e.sf$bindedKey&&Object.defineProperty(e,"sf$bindedKey",{configurable:!0,enumerable:!1,writable:!0,value:{}})}self.bindElement=function(e,t){var r=sf.controller.modelName(e),n=self.root[r];if(!n)return console.error("Model for "+r+" was not found while binding:",e);var o=e.outerHTML;if(/sf-bind-key|sf-bind-list/.test(o))throw"Can't parse element that already bound";"attr"===t&&(o=o.replace(e.innerHTML,""));for(var i=/{{([\s\S]*?)}}/g,l=self.modelKeys(n),s=l.length-1;s>=0;s--)n[l[s]]instanceof Function&&l.splice(s,1);for(var a,f=RegExp(sf.regex.strictVar+"("+l+")"+sf.regex.avoidQuotes+"\\b","g"),u=null;null!==(a=i.exec(o));)for(;null!==(u=f.exec(a[1]));)bindObject(e,n,u[1],t)},self.queuePreprocess=function(e){for(var t=(e||document.body).childNodes,r=["html","head","style","link","meta","script","object","iframe"],n=0;n<r.length;n++)r[n]=r[n].toUpperCase();var o=[];for(n=0;n<t.length;n++){var i=t[n];if(-1===r.indexOf(i.nodeName))if(1===i.nodeType){var l=i.attributes;if(l["sf-bind-key"]||l["sf-repeat-this"]||l["sf-bind-list"])continue;for(var s=0;s<l.length;s++)-1!==l[s].value.indexOf("{{")&&(i.setAttribute("sf-preprocess","attronly"),o.push(i));o=o.concat(self.queuePreprocess(i))}else if(3===i.nodeType&&-1!==i.nodeValue.indexOf("{{")){i.parentNode.setAttribute("sf-preprocess","");for(s=0;s<o.length;s++)o[s].removeAttribute("sf-preprocess");o.push(i.parentNode);break}}return o},self.parsePreprocess=function(e){for(var t=0;t<e.length;t++){var r=sf.controller.modelName(e[t]);if(e[t].removeAttribute("sf-preprocess"),!self.root[r])return console.error("Can't parse element because model for '"+r+"' was not found",e[t]);self.root[r];if(processingElement=e[t],/sf-bind-key|sf-bind-list/.test(e[t].innerHTML))return console.error("Can't parse element that already bound"),void console.log($(processingElement.outerHTML)[0]);$(e[t]).attr("sf-bind")&&self.bindElement(e[t],$(e[t]).attr("sf-bind"));var n=uniqueDataParser(e[t].innerHTML,self.root[r],!1,r);e[t].innerHTML=dataParser(n,self.root[r],!1,r);for(var o=0;o<e[t].attributes.length;o++)-1!==e[t].attributes[o].value.indexOf("{{")&&(e[t].attributes[o].value=dataParser(e[t].attributes[o].value,self.root[r],!1,r))}}}(),sf.router=new function(){var e=this;e.loading=!1,e.enabled=!1,e.pauseRenderOnTransition=!1,e.currentPage=[];var t=!1,r="";function n(t){c?c=!1:(u=!0,e.goto(window.location.pathname))}e.init=function(n){if(!sf.loader.DOMWasLoaded)return sf(function(){e.init()});$("[sf-controller], [sf-page]",$(n)[0]).each(function(){if(this.attributes["sf-controller"]&&sf.controller.run(this.attributes["sf-controller"].value),this.attributes["sf-page"]){var e=this.attributes["sf-page"].value;s(e)}}),t=!0,r=window.location.pathname},e.enable=function(t){void 0===t&&(t=!0),e.enabled!==t&&(e.enabled=t,!0===t?($(document.body).on("click","a[href]",e.load),window.addEventListener("popstate",n,!1)):($(document.body).off("click","a[href]",e.load),window.removeEventListener("popstate",n,!1)))};var o={};e.before=function(e,t,r){o[e]||(o[e]=[]),void 0===r?-1===o[e].indexOf(t)&&o[e].push(t):o[e][r]=t};var i={};e.after=function(e,t,r){i[e]||(i[e]=[]),void 0===r?-1===i[e].indexOf(t)&&i[e].push(t):i[e][r]=t};var l=function(e){return sf.model.root[e]||(sf.model.root[e]={}),sf.model.root[e]||sf.controller.run(e),sf.model.root[e]},s=function(t){if(-1===e.currentPage.indexOf(t)&&e.currentPage.push(t),o[t])for(var r=0;r<o[t].length;r++)o[t][r](l)},a={loading:[],loaded:[],special:[],error:[]};e.on=function(e,t){-1===a[e].indexOf(t)&&a[e].push(t)},e.lazyViewPoint={},e.load=function(t){if(!0===e.enabled){var r=t.target;if(r.href&&history.pushState&&!r.hasAttribute("sf-router-ignore")){var n=r.href.replace(window.location.origin,"");if(-1===n.indexOf("//"))return t.preventDefault(),!e.goto(n)}}};var f=!1,u=!1,c=!1;e.goto=function(n,o,d){d=d?d.toUpperCase():"GET",o||(o={});for(var p=0;p<a.loading.length;p++)if(a.loading[p](n))return;window.location.pathname;return t=!1,f&&f.abort(),f=$.ajax({url:window.location.origin+n,method:d,data:Object.assign(o,{_scarlets:".dynamic."}),success:function(o){if(!t){!0,f=!1;var u=RegExp("\x3c!-- SF-Special:(.*?)--\x3e"+sf.regex.avoidQuotes,"gm").exec(o);if(u&&1!==u.length&&(u=u[1].split("--|&>").join("--\x3e"),u=JSON.parse(u),!$.isEmptyObject(u)))for(var d=0;d<a.special.length;d++)if(a.special[d](u))return;var p=!1,v=function(t){p=$(t),function(t){if(-1===e.currentPage.indexOf(t)&&e.currentPage.splice(e.currentPage.indexOf(t),1),i[t])for(var r=0;r<i[t].length;r++)i[t][r](l)}($("[sf-page]",p[0]).attr("sf-page")),u&&u.title&&$("head title").html(u.title),h=!0},h=!1;for(var g in e.lazyViewPoint){if(-1!==r.indexOf(g))for(var m in e.lazyViewPoint[g])if(-1!==r.indexOf(g)){v(e.lazyViewPoint[g][m]);break}if(h)break}if(!h&&(sf.router.lazyViewPoint["@default"]&&v(sf.router.lazyViewPoint["@default"]),!h))for(d=0;d<a.error.length;d++)a.error[d]('sf.router.lazyViewPoint["'+g+'"]["'+m+'"] was not found');p||(p=$(document.body)),e.pauseRenderOnTransition&&e.pauseRenderOnTransition.css("display","none"),p.html(o),sf.model.init(p),$("[sf-page]",p[0]).each(function(){this.attributes["sf-page"]&&s(this.attributes["sf-page"].value)}),e.pauseRenderOnTransition&&e.pauseRenderOnTransition.css("display",""),function(e,t,r){for(var n=0;n<a.loaded.length;n++)a.loaded[n](e,t,r)}(r,n,p),t=!0,!1,r=n,c=!1}},error:function(e,t){if(c=!0,!e.aborted){f=!1;for(var r=0;r<a.error.length;r++)a.error[r](e.status,t);window.history.back()}}}),u||window.history.pushState(null,"",n),u=!1,!0}},sf.internal.virtual_scroll=new function(){var e=this,t=!1,r=!1;function n(t,r,n,o){var i=Math.floor(e.prepareCount/2);if(t<e.prepareCount)return r.ceiling=-1,r.floor=o.children[2*e.prepareCount+1],void(void 0!==r.floor?r.floor=r.floor.offsetTop:r.floor=o.lastElementChild.offsetTop+1e3);void 0!==o.children[i+1]&&(r.ceiling=o.children[i+1].offsetTop),void 0!==n.$virtual.preparedLength&&t>=n.length-n.$virtual.preparedLength?r.floor=n.$virtual.dCursor.floor.offsetTop+2*n.$virtual.scrollHeight:(r.floor=o.children[e.prepareCount+3].offsetTop,o.hasAttribute("scroll-reduce-floor")&&(r.floor-=o.getAttribute("scroll-reduce-floor"),r.ceiling-=o.getAttribute("scroll-reduce-floor")))}function o(e,t,o,i,l,s){var a=t.$virtual,f=0;if(e>=t.length-a.preparedLength&&(f-=o,e=t.length-a.preparedLength),!(e-a.DOMCursor==0||e>=t.length)){if(r=!0,0===a.DOMCursor&&e<o+o/2||a.DOMCursor+o/2>e&&a.DOMCursor+o<e)l.scrollTop=i.children[e-a.DOMCursor+1].offsetTop;else{for(var u=null,c=a.dCursor.ceiling,d=a.dCursor.floor,p=a.vCursor,v=i.childElementCount-2,h=0;h<v;h++)u=c.nextElementSibling,null===p.floor?(a.dom.insertAdjacentElement("beforeEnd",u),h===v-1&&(p.floor=u)):p.floor.insertAdjacentElement("beforeBegin",u);e>=o?e<t.length-a.preparedLength&&(e-=o):(f=o-e,a.DOMCursor=e=0);var g=a.preparedLength<=t.length?a.preparedLength:t.length;for(h=0;h<g&&void 0!==(u=a.dom.children[e]);h++)d.insertAdjacentElement("beforeBegin",u);a.DOMCursor=e,p.floor=a.dom.children[e]||null,p.ceiling=p.floor?p.floor.previousElementSibling:null,s&&s(e),n(e,a.bounding,t,i),void 0!==(u=i.children[o-f+1])&&(l.scrollTop=u.offsetTop-l.offsetTop)}r=!1}}function i(e){e.style.overflow="hidden",setTimeout(function(){e.style.overflow=""},50)}function l(e){var t=window.getComputedStyle(e),r=parseInt(t.marginTop)+parseInt(t.marginBottom);return e.offsetHeight+r||0}function s(e,t,r,i,l,s,a){var f=t.$virtual.DOMCursor,u=0;if(e){var c=-1,d=t.$virtual.preparedLength;do{c++}while(c<d&&i.children[c].offsetTop<l.scrollTop);(f+=c)>0&&(f-=1),u=l.scrollTop-i.children[c].offsetTop}if(e||i.childElementCount-2>t.$virtual.preparedLength){t.$virtual.DOMCursor=t.length;var p=f;e||(p=f<=r?f:f+r),o(p,t,r,i,l,a),l.scrollTop+=u}a&&a(f),s&&s(),n(f,t.$virtual.bounding,t,i)}e.prepareCount=4,e.handle=function(u,c,d){t||(!function(){var e=document.getElementById("sf-styles");e||((e=document.createElement("style")).id="sf-styles",document.head.appendChild(e));e.sheet.insertRule(".sf-virtual-list .virtual-spacer{visibility: hidden;position: relative;height: 1px;transform-origin: 0 0;width: 1px;margin: 0;padding: 0;background: none;border: none;box-shadow: none;}")}(),t=!0),u.$virtual.elements=function(){return function(e,t){for(var r=[],n=void 0,o=e.$virtual.DOMCursor,i=0;i<o&&void 0!==(n=e.$virtual.dom.children[i]);i++)r.push(n);o=t.childElementCount-2;for(var i=1;i<=o&&void 0!==(n=t.children[i]);i++)r.push(n);o=e.length-o-e.$virtual.DOMCursor;for(var i=0;i<o&&void 0!==(n=e.$virtual.dom.children[e.$virtual.DOMCursor+i]);i++)r.push(n);return r}(u,d)},u.$virtual.dCursor={ceiling:d.querySelector(".virtual-spacer.ceiling"),floor:d.querySelector(".virtual-spacer.floor")},u.$virtual.bounding={ceiling:-1,floor:0},u.$virtual.vCursor={ceiling:null,floor:null},u.$virtual.targetNode=d,u.$virtual.DOMCursor=0,u.$virtual.scrollHeight=u.$virtual.dCursor.floor.offsetTop-u.$virtual.dCursor.ceiling.offsetTop;var p=null;u.$virtual.destroy=function(){$(p).off("scroll"),$(d).off("mousedown mouseup"),u.$virtual.dom.innerHTML="",function(e){for(var t=a.length-1;t>=0;t--)a[t].element===e&&a.splice(t,1)}(d),delete u.$virtual},u.$virtual.resetViewport=function(){u.$virtual.visibleLength=Math.floor(p.clientHeight/u.$virtual.scrollHeight),u.$virtual.preparedLength=u.$virtual.visibleLength+2*e.prepareCount},setTimeout(function(){p=d;for(var t=d.getAttribute("scroll-parent-index")||0,c=0;c<t;c++)p=p.parentElement;u.$virtual.resetViewport(),d.classList.contains("sf-list-dynamic")?function(t,i,u,c){var d=t.$virtual,p=d.dCursor.ceiling,v=d.dCursor.floor,h=d.vCursor;h.floor=d.dom.firstElementChild,d.scrollTo=function(r){o(r,t,e.prepareCount,u,c)},d.refresh=function(r){s(r,t,e.prepareCount,u,c)},E(),d.visibleLength=u.childElementCount-2,d.preparedLength=d.visibleLength+2*e.prepareCount;for(var g=0;g<e.prepareCount;g++){var m=h.floor;if(null===m)break;h.floor=m.nextElementSibling,v.insertAdjacentElement("beforeBegin",m)}d.DOMCursor=0;var b=0,y=0;function E(){for(var e=d.preparedLength-(u.childElementCount-2),t=0;t<e&&null!==(m=null===h.ceiling?d.dom.firstElementChild:h.ceiling.nextElementSibling);t++)h.floor=m.nextElementSibling,v.insertAdjacentElement("beforeBegin",m)}var C=d.bounding;n(0,C,t,u);var O=!1;$(c).on("scroll",function(){if(O||r)return;O=!0,c.scrollTop<C.ceiling?(!function(){for(var r=null,n=!1,o=0;o<e.prepareCount&&null!==(r=null===h.floor?d.dom.lastElementChild:h.floor.previousElementSibling);o++)h.ceiling=r.previousElementSibling,d.DOMCursor--,p.insertAdjacentElement("afterEnd",r),b>0&&(b-=l(r)),d.DOMCursor<e.prepareCount&&!n&&(o=0,n=!0,r=null);(b<0||null===r)&&(b=0);for(var i=u.childElementCount-2-t.$virtual.preparedLength,o=0;o<i;o++)r=v.previousElementSibling,y+=l(r),null===h.floor?d.dom.insertAdjacentElement("beforeEnd",r):h.floor.insertAdjacentElement("beforeBegin",r),h.floor=r;null===h.floor?h.ceiling=d.dom.lastElementChild:h.ceiling=h.floor.previousElementSibling;p.style.height=b+"px",v.style.height=y+"px"}(),n(d.DOMCursor,C,t,u)):c.scrollTop>C.floor&&(!function(){var r=null;E(),null===h.ceiling&&(h.ceiling=h.floor.previousElementSibling);for(var n=0;n<e.prepareCount&&null!==(r=h.floor);n++)h.floor=r.nextElementSibling,v.insertAdjacentElement("beforeBegin",r),y>0&&(y-=l(r));(y<0||null===r)&&(y=0);for(var o=u.childElementCount-2-t.$virtual.preparedLength,n=0;n<o;n++)r=p.nextElementSibling,b+=l(r),d.DOMCursor++,null===h.ceiling?d.dom.insertAdjacentElement("afterBegin",r):h.ceiling.insertAdjacentElement("afterEnd",r),h.ceiling=r;null===h.ceiling?h.floor=d.dom.firstElementChild:h.floor=h.ceiling.nextElementSibling;p.style.height=b+"px",v.style.height=y+"px"}(),n(d.DOMCursor,C,t,u));O=!1}),function(e,t){-1===f&&(f=setInterval(function(){for(var e=null,t=a.length-1;t>=0;t--)(e=a[t]).element.scrollHeight!==e.height&&e.element.scrollWidth!==e.width&&(null!==e.element.parentElement?e.callback():a.splice(t,1));0===a.length&&(clearInterval(f),f=-1)},200));a.push({element:e,callback:t,height:e.scrollHeight,width:e.scrollWidth})}(u,function(){n(d.DOMCursor,C,t,u)})}(u,0,d,p):function(t,l,a,f){for(var u=t.$virtual,c=u.dCursor.ceiling,d=u.dCursor.floor,p=u.preparedLength<=t.length?u.preparedLength:t.length,v=0;v<p&&null!==u.dom.firstElementChild;v++)d.insertAdjacentElement("beforeBegin",u.dom.firstElementChild);function h(r){if(r>=e.prepareCount)c.style.height=(r-e.prepareCount)*u.scrollHeight+"px",d.style.height=(t.length-u.preparedLength-r)*u.scrollHeight+"px";else{c.style.height=r*u.scrollHeight+"px";var n=t.length-u.preparedLength;d.style.height=(n||0)*u.scrollHeight+"px"}}var g=u.bounding;h(0),n(e.prepareCount,g,t,a),g.ceiling=-1,u.offsetTo=function(e){return e*u.scrollHeight+c.offsetTop},u.vCursor.floor=u.dom.firstElementChild,u.scrollTo=function(r){o(r,t,e.prepareCount,a,f,h)},u.refresh=function(r){s(r,t,e.prepareCount,a,f,E,h)};var m=!1,b=!0,y=!1;function E(){if(m||r||f.scrollTop>=g.ceiling&&f.scrollTop<=g.floor)y&&(0!==f.scrollTop&&f.scrollTop!==f.scrollHeight-f.clientHeight||(i(f),y=!1));else{var o=Math.floor(f.scrollTop/u.scrollHeight);o+u.preparedLength>t.length&&(o=t.length-u.preparedLength),b&&(o<2*e.prepareCount&&(o-=e.prepareCount),y&&(i(f),y=!1),b=!1),o<e.prepareCount&&(o=0,b=!0),m=!0;var l=o-u.DOMCursor;o+l>=t.length&&(l=o+l-t.length),0!==l?(u.DOMCursor=o,function(e,t){var r=t.$virtual.dom,n=t.$virtual.vCursor,o=t.$virtual.dCursor;if(e>0){for(var i=0,l=0;l<e;l++)i=null===n.ceiling?r.firstElementChild:n.ceiling.nextElementSibling,o.floor.insertAdjacentElement("beforeBegin",i);for(var l=e;l>0;l--)null===n.ceiling?(n.ceiling=o.ceiling.nextElementSibling,r.insertAdjacentElement("afterBegin",n.ceiling)):(i=o.ceiling.nextElementSibling,n.ceiling.insertAdjacentElement("afterEnd",i),n.ceiling=i);n.floor=n.ceiling.nextElementSibling}else if(e<0){var i=0;e=-e;for(var l=0;l<e;l++)i=null===n.floor?r.lastElementChild:n.floor.previousElementSibling,o.ceiling.insertAdjacentElement("afterEnd",i);for(var l=0;l<e;l++)null===n.floor?(n.floor=o.floor.previousElementSibling,r.insertAdjacentElement("beforeEnd",n.floor)):(i=o.floor.previousElementSibling,n.floor.insertAdjacentElement("beforeBegin",i),n.floor=i);n.ceiling=n.floor.previousElementSibling}}(l,t),h(o),n(o,g,t,a),m=!1):m=!1}}$(f).on("scroll",E),f===a&&-1!==navigator.userAgent.indexOf("Chrom")&&($(a).on("mousedown",function(){y=!0}),$(a).on("mouseup",function(){y=!1}))}(u,0,d,p)},500)};var a=[],f=-1},sf});
//# sourceMappingURL=scarletsframe.min.js.map
