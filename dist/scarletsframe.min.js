/*
  ScarletsFrame
  A frontend library for Scarlets Framework that support
  lazy page load and element binding that can help
  simplify your code

  https://github.com/ScarletsFiction/ScarletsFrame
*/
if(sf=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){if(arguments[0].constructor===Function)return sf.loader.onFinish.apply(null,arguments)}),sf.internal={},sf.regex={avoidQuotes:"(?=(?:[^\"']*(?:'|\")[^\"']*(?:'|\"))*[^\"']*$)",strictVar:"(?=\\b[^.]|^|\\n| +|\\t|\\W )"},"undefined"==typeof $||!$.fn)if("undefined"!=typeof jQuery)$=jQuery;else{if("undefined"==typeof Dom7)throw"Please load jQuery before ScarletsFrame";$=Dom7}$.fn.extend||($.fn.extend=function(e){for(var t in e)$.fn[t]=e[t]}),$.fn.extend({animateCSS:function(e,t,r){var n=this,o={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"mozAnimationEnd",WebkitAnimation:"webkitAnimationEnd"};for(var i in o)if(void 0!==n[0].style[i]){o=o[i];break}return r&&n.css("-webkit-animation-duration",r+"s").css("animation-duration",r+"s"),n.addClass("animated "+e).one(o,function(){setTimeout(function(){$(n).removeClass("animated "+e)},1),r&&$(n).css("-webkit-animation-duration","").css("animation-duration",""),"function"==typeof t&&t()}),n}}),sf.controller=new function(){var self=this;self.pending={},self.active={},self.for=function(e,t){self.pending[e]=t},self.modelScope=function(e,t){var r=$(e),n=sf.controller.modelName(e);if(!n)throw"model or controller was not found";var o=r.attr("[sf-bind-list]");if(o||(o=r.parents("[sf-bind-list]").attr("sf-bind-list")),!o)return t?t(sf.model.root[n],-1):sf.model.root[n];var i=0;return o&&(i=r.parents("[sf-bind-list]").prevAll("[sf-bind-list]").length),t?t(sf.model.root[n][o],i):sf.model.root[n][o][i]},self.modelName=function(e){var t=void 0;return void 0===(t=e.attributes["sf-controller"]?e.attributes["sf-controller"].value:$(e).parents("[sf-controller]").attr("sf-controller"))||self.active[t]||self.run(t),t};var listenSFClick=function listenSFClick(e){var element=$(e.target),script=element.attr("sf-click");script||(element=element.parents("[sf-click]").eq(0),script=element.attr("sf-click"));var model=element.parents("[sf-controller]").attr("sf-controller");if(!sf.model.root[model])throw"Couldn't find model for "+model+" that was called from sf-click";var _modelScope=sf.model.root[model],modelKeys=sf.model.modelKeys(_modelScope),scopeMask=RegExp(sf.regex.strictVar+"("+modelKeys+")"+sf.regex.avoidQuotes+"\\b","g");script=script.replace(scopeMask,function(e,t){return"_modelScope."+t}),script=script.split("(");var method=script[0],method_=method;try{method=eval(method)}catch(e){method=!1}if(method){script.shift(),script=script.join("("),script=script.split(")"),script.pop(),script=script.join("("),0!==script.length&&(script=eval("["+script+"]")),script||(script=[]);try{method.apply(element[0],script)}catch(e){console.error("Error on sf-click for model: "+model+"\n",e.target,"\n",e)}}else console.error("Error on sf-click for model: "+model+" [Cannot find "+method_+"]\n",e.target)},root_=function(e){return sf.model.root[e]||(sf.model.root[e]={}),sf.model.root[e]||sf.controller.run(e),sf.model.root[e]};self.run=function(e,t){if(!sf.loader.DOMWasLoaded)return sf(function(){self.run(e,t)});self.pending[e]&&(sf.model.root[e]||(sf.model.root[e]={}),self.pending[e](sf.model.root[e],root_),self.active[e]=!0,delete self.pending[e]),t&&t(sf.model.root[e],root_)},self.init=function(e){if(!sf.loader.DOMWasLoaded)return sf(function(){self.init(name)});$("[sf-controller]",e?$(e)[0]:document.body).each(function(){self.run(this.attributes["sf-controller"].value)})},$(document).one("DOMContentLoaded",function(){$(document.body).on("click","[sf-click]",listenSFClick)})},sf.loader=new function(){var e=this;e.loadedContent=0,e.totalContent=0,e.DOMWasLoaded=!1;var t=[],r=[];e.onFinish=function(r){if(e.DOMWasLoaded)return r();-1===t.indexOf(r)&&t.push(r)},e.onProgress=function(t){if(e.DOMWasLoaded)return t(e.loadedContent,e.totalContent);-1===r.indexOf(t)&&r.push(t)},e.f=function(t){e.loadedContent++;for(var n=0;n<r.length;n++)r[n](e.loadedContent,e.totalContent);t&&t.removeAttribute&&t.removeAttribute("onload")},e.css=function(t){if(e.DOMWasLoaded){for(var r=t.length-1;r>=0;r--)0!==$('link[href*="'+t[r]+'"]').length&&t.splice(r,1);if(0===t.length)return}e.totalContent=e.totalContent+t.length;var n="";for(r=0;r<t.length;r++)n+='<link onload="sf.loader.f(this);" rel="stylesheet" href="'+t[r]+'">';$(function(){document.getElementsByTagName("body")[0].innerHTML+=n})},e.js=function(t){if(e.DOMWasLoaded){for(var r=t.length-1;r>=0;r--)0!==$('script[src*="'+t[r]+'"]').length&&t.splice(r,1);if(0===t.length)return}e.totalContent=e.totalContent+t.length;for(r=0;r<t.length;r++)$.ajax({url:t[r],dataType:"script",cache:!0,complete:sf.loader.f})},setTimeout(function(){0===e.totalContent&&(e.loadedContent=e.totalContent=1)},1e4);var n=setInterval(function(){if(/loaded|complete/.test(document.readyState)){if(e.loadedContent<e.totalContent||0===e.loadedContent)return;clearInterval(n),e.DOMWasLoaded=!0;for(var o=0;o<t.length;o++)try{t[o]()}catch(e){console.error(e)}r.splice(0),t.splice(0),sf.controller.init(),sf.model.init(),sf.router.init()}},100)},sf.prototype.constructor=sf.loader.onFinish,$(function(){$("img:not(onload)[src]").each(function(){sf.loader.totalContent++,this.setAttribute("onload","sf.loader.f(this)")})}),sf.model=function(e){return sf.model.root[e]||(sf.model.root[e]={}),sf.controller.pending[e]&&sf.controller.run(e),sf.model.root[e]},function(){var self=sf.model,bindingEnabled=!1;self.root={};var processingElement=null,bracketMatch=RegExp("([\\w.]*?[\\S\\s])\\("+sf.regex.avoidQuotes,"g"),chackValidFunctionCall=/[a-zA-Z0-9 \]\$\)]/,allowedFunction=[":","for","if","while","_content_.take","console.log"],localEval=function localEval(script_,_model_,_modelScope,_content_){var script=script_;script_=script_.split('\\"').join("\\$%*").split("\\'").join("\\%$*"),script_=script_.split("._modelScope").join(""),script_=script_.split("._model_").join("");for(var preventExecution=!1,check=null;null!==(check=bracketMatch.exec(script_));)if(check[1]=check[1].trim(),-1===allowedFunction.indexOf(check[1])&&"_modelScope"!==check[1].split(".")[0]&&chackValidFunctionCall.test(check[1][check[1].length-1])){preventExecution=check[1];break}var _result_="";if(script_=script_.split("\\$%*").join('\\"').split("\\%$*").join("\\'"),preventExecution)return console.error("Trying to executing unrecognized function ("+preventExecution+")"),console.log($(processingElement.outerHTML)[0]),console.log(script_),"";try{var _evaled_=eval(script_)}catch(e){return console.error(e),console.log(script_),console.log($(processingElement.outerHTML)[0]),""}return""!==_result_?_result_:_evaled_};self.index=function(e){return $(e).prevAll(e.tagName).length},self.for=function(e,t){if(!sf.loader.DOMWasLoaded)return sf(function(){self.for(e,t)});t(self(e),self)},self.modelKeys=function(e){for(var t=Object.keys(e),r=t.length-1;r>=0;r--)-1!==t[r].indexOf("$")&&t.splice(r,1);return t.join("|")};var clearElementData=function(e){$&&$.cleanData&&$.cleanData(e.getElementsByTagName("*")),e.innerHTML="";for(var t=0;t<e.attributes.length;t++){var r=e.attributes[t].name;"sf-bind-list"!==r&&e.removeAttribute(r)}e.setAttribute("style","display:none")},dataParser=function(e,t,r,n,o){var i=self.root[n];o||(o="");for(var l=self.modelKeys(i),a=l.length-1;a>=0;a--)i[l[a]]instanceof Function&&l.splice(a,1);var s=RegExp(sf.regex.strictVar+"("+l+")"+sf.regex.avoidQuotes+"\\b","g");if(r)var f=RegExp(sf.regex.strictVar+r+"\\."+sf.regex.avoidQuotes+"\\b","g");return bindingEnabled=!0,e.replace(/{{([^@][\s\S]*?)}}/g,function(e,n){return n=n.split('\\"').join("\\$%*").split("\\'").join("\\%$*"),r&&(n=n.replace(f,function(e){return"_model_."+e[0].slice(1)})),n=(n=n.replace(s,function(e,t){return"_modelScope."+t})).split("\\$%*").join('\\"').split("\\%$*").join("\\'"),(n=""+localEval.apply(self.root,[o+n,t,i])).replace(/[\u00A0-\u9999<>\&]/gim,function(e){return"&#"+e.charCodeAt(0)+";"})})},uniqueDataParser=function(e,t,r,n){var o={length:0,take:function(e,o){if(!e)return dataParser(this[o],t,r,n);var i='"use strict";var ',l=!0;for(var a in e)"string"==typeof e[a]?e[a]='"'+e[a].split('"').join('\\"')+'"':"object"==typeof e[a]&&(e[a]=JSON.stringify(e[a])),l||(i+=","),i+=a+" = "+e[a],l=!1;return i=i.split("(").join("").split(")").join(""),dataParser(this[o],t,r,n,i+";")}};e=e.replace(/{\[([\s\S]*?)\]}/g,function(e,t){return o[o.length]=t,o.length++,"_result_ += _content_.take(&VarPass&, "+(o.length-1)+");"});var i=self.root[n],l=RegExp(sf.regex.strictVar+"("+self.modelKeys(i)+")"+sf.regex.avoidQuotes+"\\b","g");if(r)var a=RegExp(sf.regex.strictVar+r+"\\."+sf.regex.avoidQuotes+"\\b","g");return e.replace(/{{(@[\s\S]*?)}}/g,function(e,n){n=n.split('\\"').join("\\$%*").split("\\'").join("\\%$*"),r&&(n=n.replace(a,function(e){return"_model_."+e[0].slice(1)}));var s=!1;if(1!=(s=(n=(n=n.replace(l,function(e,t){return"_modelScope."+t})).split("\\$%*").join('\\"').split("\\%$*").join("\\'")).split("@if ")).length&&(s=s[1].split(":"),localEval.apply(self.root,[s[0],t,i,o])))return s.shift(),s.join(":");for(var f=/(var|let)([\w,\s]+)(?=\s(?==|in|of))/g,c=[],d=null;null!==(d=f.exec(n));)c.push(d[2]);if(c.length){for(var u=[],p=0;p<c.length;p++)c[p].replace(/([\n\t\r]|  )+/g,"").split(",").forEach(function(e){u.push(e)});c=u;for(p=0;p<c.length;p++)c[p]+=":(typeof "+c[p]+'!="undefined"?'+c[p]+":undefined)";c="{"+c.join(",")+"}",n=n.split("&VarPass&").join(c)}return 1!=(s=(n=n.split("&VarPass&").join("{}")).split("@exec")).length?(s=s[1].split("&lt;").join("<").split("&gt;").join(">").split("&amp;").join("&"),n=localEval.apply(self.root,[s,t,i,o])):""})},bindArray=function(e,t,r,n,o,i,l,a){var s=t.slice(0),f=["pop","push","splice","shift","unshift","softRefresh","hardRefresh"],c=-1,d=function(a,s){if(0===(f=$("[sf-controller='"+n+"']",i)).length){if(i.getAttribute("sf-controller")!==n)return;f=i}if(t.$virtual){for(var f=[],d=t.$virtual.DOMCursor,u=0;u<d;u++)f.push(t.$virtual.dom.children[u]);d=l[0].childElementCount-2;for(u=1;u<=d;u++)f.push(l[0].children[u]);d=t.length-d-t.$virtual.DOMCursor;for(u=t.$virtual.DOMCursor;u<d;u++)f.push(t.$virtual.dom.children[u]);f=$(f),clearTimeout(c),c=setTimeout(function(){t.$virtual.refresh(!0)},100)}else f=$("[sf-bind-list='"+o+"']",f);var p=!1;if(self.root[n]["on$"+o]&&(p=self.root[n]["on$"+o]),-1===a){var m=self.root[n][o],g="";for(u=0;u<m.length;u++){var h=uniqueDataParser(e,m[u],r,n);g+=dataParser(h,m[u],r,n)}var v=f.eq(0).prev();return v[0]===f[0]?f.parent().prepend(g):$(g).insertAfter(v),void f.remove()}if("remove"!==s){m=self.root[n][o][a],h=uniqueDataParser(e,m,r,n);h=dataParser(h,m,r,n),h=$(h),f[a]&&"insertAfter"!==s?"insertBefore"===s?(p.create&&p.create(h[0]),h.insertBefore(f[0])):(p.update&&p.update(h[0]),$&&$.cleanData&&($.cleanData(f[a].getElementsByTagName("*")),$.cleanData(f[a])),f[a].outerHTML=h[0].outerHTML):(p.create&&p.create(h[0]),h.insertAfter(f[0!==a?a-1:f.length-1]))}else if(f[a]){var b=!1,y=function(){if(!b){if(b=!0,f.length<=1)return clearElementData(f[a]);f[a].remove()}};p.remove?p.remove(f[a],y)||setTimeout(y,800):y()}},u=function(e,t){Object.defineProperty(e,t,{enumerable:!1,configurable:!0,value:function(){var e=void 0,r=this.length;if(Array.prototype[t]&&(e=Array.prototype[t].apply(this,arguments)),"pop"===t)d(r-1,"remove");else if("push"===t)d(r,"add");else if("shift"===t)d(0,"remove");else if("splice"===t){var n=arguments[0];n<0&&(n=r+n);var o=arguments[1];o||0===o||(o=s.length);for(var i=o-1;i>=0;i--)d(n+i,"remove");if(arguments.length>=3){o=arguments.length-2;for(i=0;i<o;i++)d(n+i,"insertAfter")}}else if("unshift"===t)d(0,"insertBefore");else if("softRefresh"===t)if(arguments[0]||0===arguments[0])d(arguments[0],s[arguments[0]]?"add":"remove");else{var l=!1;if(s.length>this.length)for(i=s.length-1;i>=this.length;i--)-1===this.indexOf(s[i])&&(l=!0,d(i,"remove"));if(s.length<this.length)for(i=s.length-1;i<this.length;i++)l=!0,d(i,"insertBefore");for(i=0;i<this.length;i++)!1===compareObject(s[i],this[i])&&(l=!0,d(i,"add"));l&&(s=this.slice(0))}else"hardRefresh"===t&&d(-1,"remove");return Array.prototype[t]&&(s=this.slice(0)),e}})};l&&l[0].classList.contains("sf-virtual-list")&&(Object.defineProperty(t,"$virtual",{enumerable:!1,configurable:!0,value:{}}),t.$virtual.dom=document.createElement("div"),t.$virtual.dom.innerHTML=a,sf.internal.virtual_scroll.handle(t,i,l[0]));for(var p=0;p<f.length;p++)u(t,f[p])};function compareObject(e,t){if(!e||!t)return!1;for(var r in e)if("object"!=typeof e[r]&&e[r]!==t[r])return!1;return!0}var loopParser=function(e,t,r,n,o){var i="",l=r.split(" in "),a=l[0];if(!self.root[e])return console.error("Can't parse element because model for '"+e+"' was not found",$(t)[0]);var s=self.root[e][l[1]];if(t=(t=(processingElement=$(t).attr("sf-bind-list",l[1])[0]).outerHTML).replace(/  +|\t+/g,""),2===l.length){for(var f in s){var c=s[f];temp=uniqueDataParser(t,c,a,e),temp=dataParser(temp,c,a,e),i+=temp}Object.defineProperty(self.root[e],l[1],{enumerable:!0,configurable:!0,get:function(){return s},set:function(e){for(var t=0;t<e.length;t++)s[t]?(s[t]=e[t],s.softRefresh(t)):s.push(e[t]);return s.length>e.length&&s.splice(e.length),s}}),bindArray(t,s,a,e,l[1],n,o,i)}return i},bindInput=function(e){$("input[sf-bound]",e).each(function(){var e=$(this),t=e.parents("[sf-controller]").attr("sf-controller");if(t){var r=e.attr("sf-bound");void 0!==typeof self.root[t][r]?(e.attr("sf-bounded",r),e.removeAttr("sf-bound"),e.keyup(function(n){self.root[t][r]=e.val()}),e.attr("value","{{"+r+"}}"),bindObject(e,self.root[t],r,"attr")):console.error('Cannot get reference for self.root["'+t+'"]["'+r+'"]')}})},alreadyInitialized=!1;function DOMNodeRemoved(e){var t=sf.controller.modelName(e);$("[sf-bind-id], [sf-bind-list], [sf-bounded], [sf-repeat-this]",e).each(function(){removeBinding(this,t)}),removeBinding(e)}self.init=function(e){alreadyInitialized&&!e||(alreadyInitialized=!0,setTimeout(function(){alreadyInitialized=!1},50),e?e instanceof Node||(e=$(e)[0]):e=document.body,self.parsePreprocess(self.queuePreprocess(e)),bindInput(e),$("[sf-repeat-this]",e).each(function(){var t=$(this),r=t.parent();if(this.parentNode.classList.contains("sf-virtual-list")){var n=$(this.parentNode).children("[sf-repeat-this]")[0].tagName,o=document.createElement(n);o.classList.add("virtual-spacer"),o.classList.add("ceiling"),this.parentNode.prepend(o);var i=document.createElement(n);i.classList.add("virtual-spacer"),i.classList.add("floor"),this.parentNode.append(i);var l=window.getComputedStyle(this),a=parseFloat(l.marginTop)+parseFloat(l.marginBottom);l=null,a=Math.ceil(this.offsetHeight+a)}var s=t.next();s.length&&t[0]!==s[0]||(s=!1);var f=t.prev();f.length&&t[0]!==f[0]||(f=!1);var c=t.attr("sf-repeat-this");t.removeAttr("sf-repeat-this");var d=sf.controller.modelName(this),u=this.outerHTML;if(/sf-bind-id|sf-bind-list/.test(u))throw"Can't parse element that already bound";if(this.parentNode.classList.contains("sf-virtual-list"))return loopParser(d,u,c,e,[this.parentNode,a]),void t.remove();var p=loopParser(d,u,c,e);p?(t.remove(),p=$(p),s?p.insertBefore(s):f?p.insertAfter(f):r.append(p)):(t.attr("sf-bind-list",c.split(" in ")[1]),clearElementData(this))}))},$(function(){"function"==typeof MutationObserver&&MutationObserver.prototype.observe?new MutationObserver(function(e){if(bindingEnabled)for(var t in e)for(var r in e[t].removedNodes){var n=e[t].removedNodes[r].nodeName;"TEXT"===n&&"#comment"===n&&DOMNodeRemoved(e[t].removedNodes[r])}}).observe(document.body,{childList:!0,subtree:!0}):document.body.addEventListener("DOMNodeRemoved",function(e){if(bindingEnabled){var t=e.target.nodeName;if("TEXT"!==t||"#comment"!==t)return;DOMNodeRemoved(e.target)}})});var removeBinding=function(e,t){if(e.attributes){var r=e.attributes;if(r["sf-bind-id"]){var n=r["sf-bind-id"].value;if(!bindRef[n])return;for(var o=bindRef[n],i=0;i<o.propertyName.length;i++){var l=o.object[o.propertyName[i]];Object.defineProperty(o.object,o.propertyName[i],{configurable:!0,enumerable:!0,writable:!0,value:l})}delete bindRef[n];var a=bindRef.cache;for(var i in a)a[i].callback&&a[i].callback[n]&&delete a[i].callback[n],$.isEmptyObject(a[i].callback)&&delete a[i];a[n]&&(delete a[n].attrs,delete a[n].innerHTML,delete a[n].modelName,delete a[n].model,delete a[n].created,delete a[n].element),bindRef.length--,0===bindRef.length&&(bindRef.index=0)}if(t){var s=!1;r["sf-bind-list"]&&(s=r["sf-bind-list"].value),r["sf-repeat-this"]&&(s=r["sf-repeat-this"].value.split(" in ")[1]),r["sf-bounded"]&&(s=r["sf-bounded"].value);for(i=0;i<t.length;i++){var f=self.root[t[i]];if(f[s]){l=f[s].slice(0);Object.defineProperty(f,s,{configurable:!0,enumerable:!0,writable:!0,value:l})}}}}},bindRef={length:0,index:0,cache:{}};self.bindRef=bindRef;var dcBracket=/{{[\s\S]*?}}/,bindObject=function(e,t,r,n){e instanceof Node||(e=e[0]),processingElement=e;var o=bindRef.index;$(e).attr("sf-bind-id",o),bindRef.index++,bindRef.length++,bindRef.cache[o]={};var i=bindRef.cache[o];if(i.attrs={},i.innerHTML="",i.modelName=sf.controller.modelName(e),i.model=self.root[i.modelName],i.created=Date.now(),"attr"===n||!n)for(var l in e.attributes)if(dcBracket.test(e.attributes[l].value)){var a=e.attributes[l].name;i.attrs[a]=e.attributes[l].value,"value"===a&&e.removeAttribute(a)}"html"!==n&&n||(i.innerHTML=e.innerHTML),bindRef[o]||(bindRef[o]={object:t,propertyName:[]}),bindRef[o].propertyName.push(r),i.element=$(e);var s=function(){if("attr"===n||!n)for(var e in i.attrs)if(-1!==i.attrs[e].indexOf(r)){var t=dataParser(i.attrs[e],i.model,!1,i.modelName);"value"===e?i.element.val(t):i.element.attr(e,t);break}if("html"===n||!n){t=uniqueDataParser(i.innerHTML,i.model,!1,i.modelName);t=dataParser(t,i.model,!1,i.modelName),i.element.html(t)}};if(void 0===i.model[r])throw"Property '"+r+"' was not found on '"+i.modelName+"' model";if(Object.getOwnPropertyDescriptor(i.model,r).set){for(var l in bindRef)if(i.model===bindRef[l].object&&-1!==bindRef[l].propertyName.indexOf(r)){bindRef.cache[l].callback[o]=s;break}}else{i.callback={},i.callback[o]=s;var f=t[r];Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:function(){return f},set:function(e){for(var t in f=e,i.callback)i.callback[t]();return f}})}};self.bindElement=function(e,t){var r=sf.controller.modelName(e),n=self.root[r];if(!n)return console.error("Model for "+r+" was not found while binding:",e);var o=e.outerHTML;if(/sf-bind-id|sf-bind-list/.test(o))throw"Can't parse element that already bound";"attr"===t&&(o=o.replace(e.innerHTML,""));for(var i=/{{([\s\S]*?)}}/g,l=self.modelKeys(n),a=l.length-1;a>=0;a--)n[l[a]]instanceof Function&&l.splice(a,1);for(var s,f=RegExp(sf.regex.strictVar+"("+l+")"+sf.regex.avoidQuotes+"\\b","g"),c=null;null!==(s=i.exec(o));)for(;null!==(c=f.exec(s[1]));)bindObject(e,n,c[1],t)},self.queuePreprocess=function(e){for(var t=(e||document.body).childNodes,r=["html","head","style","link","meta","script","object","iframe"],n=0;n<r.length;n++)r[n]=r[n].toUpperCase();var o=[];for(n=0;n<t.length;n++){var i=t[n];if(-1===r.indexOf(i.nodeName))if(1===i.nodeType){var l=i.attributes;if(l["sf-bind-id"]||l["sf-repeat-this"]||l["sf-bind-list"])continue;for(var a=0;a<l.length;a++)-1!==l[a].value.indexOf("{{")&&(i.setAttribute("sf-preprocess","attronly"),o.push(i));o=o.concat(self.queuePreprocess(i))}else if(3===i.nodeType&&-1!==i.nodeValue.indexOf("{{")){i.parentNode.setAttribute("sf-preprocess","");for(a=0;a<o.length;a++)o[a].removeAttribute("sf-preprocess");o.push(i.parentNode);break}}return o},self.parsePreprocess=function(e){for(var t=0;t<e.length;t++){var r=sf.controller.modelName(e[t]);if(e[t].removeAttribute("sf-preprocess"),!self.root[r])return console.error("Can't parse element because model for '"+r+"' was not found",e[t]);if(processingElement=e[t],/sf-bind-id|sf-bind-list/.test(e[t].innerHTML))return console.error("Can't parse element that already bound"),void console.log($(processingElement.outerHTML)[0]);$(e[t]).attr("sf-bind")&&self.bindElement(e[t],$(e[t]).attr("sf-bind"));var n=uniqueDataParser(e[t].innerHTML,self.root[r],!1,r);e[t].innerHTML=dataParser(n,self.root[r],!1,r);for(var o=0;o<e[t].attributes.length;o++)-1!==e[t].attributes[o].value.indexOf("{{")&&(e[t].attributes[o].value=dataParser(e[t].attributes[o].value,self.root[r],!1,r))}}}(),sf.router=new function(){var e=this;e.loading=!1,e.enabled=!1,e.pauseRenderOnTransition=!1,e.currentPage=[];var t=!1,r="";e.init=function(n){if(!sf.loader.DOMWasLoaded)return sf(function(){e.init()});e.lazy(),$("[sf-controller], [sf-page]",$(n)[0]).each(function(){if(this.attributes["sf-controller"]&&sf.controller.run(this.attributes["sf-controller"].value),this.attributes["sf-page"]){var e=this.attributes["sf-page"].value;l(e)}}),t=!0,r=window.location.pathname},e.enable=function(t){void 0===t&&(t=!0),e.enabled!==t&&(e.enabled=t,t?e.lazy():$("a[href][onclick]").each(function(){var e=$(this);"return sf.router.load(this)"===e.attr("onclick")&&e.removeAttr("onclick")}),window.addEventListener("popstate",function(t){c?c=!1:(f=!0,e.goto(window.location.pathname))},!1))};var n={};e.before=function(e,t,r){n[e]||(n[e]=[]),void 0===r?-1===n[e].indexOf(t)&&n[e].push(t):n[e][r]=t};var o={};e.after=function(e,t,r){o[e]||(o[e]=[]),void 0===r?-1===o[e].indexOf(t)&&o[e].push(t):o[e][r]=t};var i=function(e){return sf.model.root[e]||(sf.model.root[e]={}),sf.model.root[e]||sf.controller.run(e),sf.model.root[e]},l=function(t){if(-1===e.currentPage.indexOf(t)&&e.currentPage.push(t),n[t])for(var r=0;r<n[t].length;r++)n[t][r](i)},a={loading:[],loaded:[],special:[],error:[]};e.on=function(e,t){-1===a[e].indexOf(t)&&a[e].push(t)},e.lazyViewPoint={},e.lazy=function(){e.enabled&&$("a[href]:not([onclick])").each(function(){var e=this.href;-1===e.indexOf("#")&&(0!==e.indexOf(window.location.origin)&&"/"!==e.charAt(0)||$(this).attr("onclick","return sf.router.load(this)"))})},e.load=function(t){return!history.pushState||"ignore"==$(t).attr("sf-router")||!e.goto(t.href.replace(window.location.origin,""))};var s=!1,f=!1,c=!1;e.goto=function(n,d,u){u=u?u.toUpperCase():"GET";for(var p=0;p<a.loading.length;p++)if(a.loading[p](n))return;window.location.pathname;return t=!1,s&&s.abort(),s=$.ajax({url:window.location.origin+n,method:u,data:Object.assign(d,{_scarlets:".dynamic."}),success:function(f){if(!t){!0,s=!1;var d=RegExp("\x3c!-- SF-Special:(.*?)--\x3e"+sf.regex.avoidQuotes,"gm").exec(f);if(d&&1!==d.length&&(d=d[1].split("--|&>").join("--\x3e"),d=JSON.parse(d),!$.isEmptyObject(d)))for(var u=0;u<a.special.length;u++)if(a.special[u](d))return;var p=!1,m=function(t){p=$(t),function(t){if(-1===e.currentPage.indexOf(t)&&e.currentPage.splice(e.currentPage.indexOf(t),1),o[t])for(var r=0;r<o[t].length;r++)o[t][r](i)}($("[sf-page]",p[0]).attr("sf-page")),d&&d.title&&$("head title").html(d.title),g=!0},g=!1;for(var h in e.lazyViewPoint){if(-1!==r.indexOf(h))for(var v in e.lazyViewPoint[h])if(-1!==r.indexOf(h)){m(e.lazyViewPoint[h][v]);break}if(g)break}if(!g&&(sf.router.lazyViewPoint["@default"]&&m(sf.router.lazyViewPoint["@default"]),!g))for(u=0;u<a.error.length;u++)a.error[u]('sf.router.lazyViewPoint["'+h+'"]["'+v+'"] was not found');e.lazy(),p||(p=$(document.body)),e.pauseRenderOnTransition&&e.pauseRenderOnTransition.css("display","none"),p.html(f),sf.model.init(p),$("[sf-page]",p[0]).each(function(){this.attributes["sf-page"]&&l(this.attributes["sf-page"].value)}),e.pauseRenderOnTransition&&e.pauseRenderOnTransition.css("display",""),function(e,t,r){for(var n=0;n<a.loaded.length;n++)a.loaded[n](e,t,r)}(r,n,p),t=!0,!1,r=n,c=!1}},error:function(e,t){if(c=!0,!e.aborted){s=!1;for(var r=0;r<a.error.length;r++)a.error[r](e.status,t);window.history.back()}}}),f||window.history.pushState(null,"",n),f=!1,!0}},sf.internal.virtual_scroll=new function(){var e=this;function t(t,r,n,o){var i=Math.floor(e.prepareCount/2);if(t<e.prepareCount)return r.ceiling=-1,void(r.floor=o.children[2*e.prepareCount+1].offsetTop);r.ceiling=o.children[i+1].offsetTop,void 0!==n.$virtual.preparedLength&&t>=n.length-n.$virtual.preparedLength?r.floor=n.$virtual.dCursor.floor.offsetTop+2*n.$virtual.scrollHeight:r.floor=o.children[e.prepareCount+3].offsetTop}function r(e,r,n,o,i,l){var a=r.$virtual,s=0;if(e>=r.length-a.preparedLength&&(s-=n,e=r.length-a.preparedLength),!(e-a.DOMCursor==0||e>=r.length)){if(updating=!0,0===a.DOMCursor&&e<n+n/2||a.DOMCursor+n/2>e&&a.DOMCursor+n<e)i.scrollTop=o.children[e-a.DOMCursor+1].offsetTop;else{for(var f=null,c=a.dCursor.ceiling,d=a.dCursor.floor,u=a.vCursor,p=o.childElementCount-2,m=0;m<p;m++)f=c.nextElementSibling,null===u.floor?(a.dom.insertAdjacentElement("beforeEnd",f),m===p-1&&(u.floor=f)):u.floor.insertAdjacentElement("beforeBegin",f);e>=n?e<r.length-a.preparedLength&&(e-=n):(s=n-e,a.DOMCursor=e=0);var g=a.preparedLength<=r.length?a.preparedLength:r.length;for(m=0;m<g&&null!==(f=a.dom.children[e]);m++)d.insertAdjacentElement("beforeBegin",f);a.DOMCursor=e,u.floor=a.dom.children[e]||null,u.ceiling=u.floor?u.floor.previousElementSibling:null,l&&l(e),t(e,a.bounding,r,o),i.scrollTop=o.children[n-s+1].offsetTop}updating=!1}}function n(e){e.style.overflow="hidden",setTimeout(function(){e.style.overflow=""},50)}function o(e){var t=window.getComputedStyle(e),r=parseInt(t.marginTop)+parseInt(t.marginBottom);return e.offsetHeight+r}e.prepareCount=4,e.handle=function(i,l,a){i.$virtual.dCursor={ceiling:a.querySelector(".virtual-spacer.ceiling"),floor:a.querySelector(".virtual-spacer.floor")},i.$virtual.bounding={ceiling:-1,floor:0},i.$virtual.vCursor={ceiling:null,floor:null},i.$virtual.targetNode=a,i.$virtual.DOMCursor=0,i.$virtual.scrollHeight=i.$virtual.dCursor.floor.offsetTop-i.$virtual.dCursor.ceiling.offsetTop;var s=null;i.$virtual.destroy=function(){$(s).off(),$(a).off(),i.$virtual.dom.innerHTML="",delete i.$virtual},i.$virtual.resetViewport=function(){i.$virtual.visibleLength=Math.floor(s.clientHeight/i.$virtual.scrollHeight),i.$virtual.preparedLength=i.$virtual.visibleLength+2*e.prepareCount},setTimeout(function(){s=a.parentElement.classList.contains("simplebar-content")?a.parentElement:a,i.$virtual.resetViewport(),a.classList.contains("sf-list-dynamic")?function(r,n,i,l){var a=r.$virtual,s=a.dCursor.ceiling,f=a.dCursor.floor,c=a.vCursor;c.floor=a.dom.firstElementChild;var d=null;do{if(null===(d=c.floor))break;c.floor=d.nextElementSibling,f.insertAdjacentElement("beforeBegin",d)}while(f.offsetTop<l.clientHeight);r.$virtual.visibleLength=i.childElementCount-2,r.$virtual.preparedLength=r.$virtual.visibleLength+2*e.prepareCount;for(var d=0;d<e.prepareCount;d++){var u=c.floor;if(null===u)break;c.floor=u.nextElementSibling,f.insertAdjacentElement("beforeBegin",u)}var p=0,m=0;var g=a.bounding;!function(){null===c.ceiling?g.ceiling=-1:g.ceiling=i.children[e.prepareCount].offsetTop;if(null===c.floor)g.floor=i.lastElementChild.offsetTop+1e3;else{var t=i.childElementCount-e.prepareCount-2;g.floor=f.offsetTop-i.children[t].offsetTop}}();var h=!1;$(l).on("scroll",function(){if(h)return;h=!0,l.scrollTop<g.ceiling?(console.log("back"),function(){for(var t=null,n=0;n<e.prepareCount&&null!==(t=null===c.floor?a.dom.lastElementChild:c.floor.previousElementSibling);n++)c.ceiling=t.previousElementSibling,s.insertAdjacentElement("afterEnd",t),p-=o(t);p<0&&(p=0);i.childElementCount,r.$virtual.preparedLength;for(var n=0;n<e.prepareCount;n++)t=f.previousElementSibling,m+=o(t),null===c.floor?a.dom.insertAdjacentElement("beforeEnd",t):c.floor.insertAdjacentElement("beforeBegin",t),c.floor=t;null===c.ceiling?c.ceiling=a.dom.lastElementChild:c.ceiling=c.floor.previousElementSibling;s.style.height=p+"px",f.style.height=m+"px"}(),t(e.prepareCount,g,r,i)):l.scrollTop>g.floor&&(console.log("front"),function(){var t=null;for(;f.offsetTop<l.clientHeight&&null!==(t=null===c.ceiling?a.dom.firstElementChild:c.ceiling.nextElementSibling);)c.floor=t.nextElementSibling,f.insertAdjacentElement("beforeBegin",t);null===c.ceiling&&(c.ceiling=c.floor.previousElementSibling);for(var n=0;n<e.prepareCount;n++){var t=c.floor;if(null===t)break;m>0&&(m-=o(t)),c.floor=t.nextElementSibling,f.insertAdjacentElement("beforeBegin",t)}m<0&&(m=0);for(var d=i.childElementCount-2-r.$virtual.preparedLength,n=0;n<d;n++){var t=s.nextElementSibling;p+=o(t),null===c.ceiling?a.dom.insertAdjacentElement("afterBegin",t):c.ceiling.insertAdjacentElement("afterEnd",t),c.ceiling=t}null===c.ceiling?c.floor=a.dom.firstElementChild:c.floor=c.ceiling.nextElementSibling;s.style.height=p+"px",f.style.height=m+"px"}(),t(e.prepareCount,g,r,i));h=!1})}(i,0,a,s):function(o,i,l,a){for(var s=o.$virtual,f=s.dCursor.ceiling,c=s.dCursor.floor,d=s.preparedLength<=o.length?s.preparedLength:o.length,u=0;u<d;u++)c.insertAdjacentElement("beforeBegin",s.dom.firstElementChild);function p(t){t>=e.prepareCount?(f.style.height=(t-e.prepareCount)*s.scrollHeight+"px",c.style.height=(o.length-s.preparedLength-t)*s.scrollHeight+"px"):(f.style.height=t*s.scrollHeight+"px",c.style.height=o.length*s.scrollHeight+"px")}var m=s.bounding;p(0),t(e.prepareCount,m,o,l),m.ceiling=-1,s.offsetTo=function(e){return e*s.scrollHeight+f.offsetTop},o.$virtual.vCursor.floor=s.dom.firstElementChild,s.scrollTo=function(t){r(t,o,e.prepareCount,l,a,p)},s.refresh=function(n){var i=s.DOMCursor;(n||l.childElementCount-2>s.preparedLength)&&(s.DOMCursor=o.length,r(i<=e.prepareCount?i:i+e.prepareCount,o,e.prepareCount,l,a,p)),p(i),b(),t(i,m,o,l)};var g=!1,h=!0,v=!1;function b(){if(g||a.scrollTop>=m.ceiling&&a.scrollTop<=m.floor)v&&(0!==a.scrollTop&&a.scrollTop!==a.scrollHeight-a.clientHeight||(n(a),v=!1));else{var r=Math.floor(a.scrollTop/s.scrollHeight);r+s.preparedLength>o.length&&(r=o.length-s.preparedLength),h&&(r<2*e.prepareCount&&(r-=e.prepareCount),v&&(n(a),v=!1),h=!1),r<e.prepareCount&&(r=0,h=!0),g=!0;var i=r-s.DOMCursor;r+i>=o.length&&(i=r+i-o.length),0!==i?(s.DOMCursor=r,function(e,t){var r=t.$virtual.dom,n=t.$virtual.vCursor,o=t.$virtual.dCursor;if(e>0){for(var i=0,l=0;l<e;l++)i=null===n.ceiling?r.firstElementChild:n.ceiling.nextElementSibling,o.floor.insertAdjacentElement("beforeBegin",i);for(var l=e;l>0;l--)null===n.ceiling?(n.ceiling=o.ceiling.nextElementSibling,r.insertAdjacentElement("afterBegin",n.ceiling)):(i=o.ceiling.nextElementSibling,n.ceiling.insertAdjacentElement("afterEnd",i),n.ceiling=i);n.floor=n.ceiling.nextElementSibling}else if(e<0){var i=0;e=-e;for(var l=0;l<e;l++)i=null===n.floor?r.lastElementChild:n.floor.previousElementSibling,o.ceiling.insertAdjacentElement("afterEnd",i);for(var l=0;l<e;l++)null===n.floor?(n.floor=o.floor.previousElementSibling,r.insertAdjacentElement("beforeEnd",n.floor)):(i=o.floor.previousElementSibling,n.floor.insertAdjacentElement("beforeBegin",i),n.floor=i);n.ceiling=n.floor.previousElementSibling}}(i,o),p(r),t(r,m,o,l),g=!1):g=!1}}$(a).on("scroll",b),a===l&&-1!==navigator.userAgent.indexOf("Chrom")&&($(l).on("mousedown",function(){v=!0}),$(l).on("mouseup",function(){v=!1}))}(i,0,a,s)},500)}};
//# sourceMappingURL=scarletsframe.min.js.map
