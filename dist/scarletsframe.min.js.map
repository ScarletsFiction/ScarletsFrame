{"version":3,"sources":["sf-a_init.js","sf-z_end.js","sf-controller.js","sf-loader.js","sf-model.js","sf-router.js","sf-virtual_scroll.js"],"names":["global","factory","$","exports","module","require","console","log","undefined","fn","one","once","Dom7","jQuery","sf","window","this","document","arguments","constructor","Function","loader","onFinish","apply","internal","regex","avoidQuotes","strictVar","extend","obj","func","isEmptyObject","key","animateCSS","animationName","callback","duration","self","animationEnd","animation","OAnimation","MozAnimation","WebkitAnimation","t","style","css","addClass","setTimeout","removeClass","controller","pending","active","for","name","modelScope","element","elem","model","modelName","bindedList","attr","parents","root","bindedListIndex","prevAll","length","attributes","value","run","listenSFClick","e","target","script","eq","_modelScope","modelKeys","scopeMask","RegExp","replace","full","matched","split","method","method_","eval","shift","join","pop","error","root_","scope","DOMWasLoaded","init","parent","body","each","on","loadedContent","totalContent","DOMReady","turnedOff","whenDOMReady","whenDOMLoaded","whenProgress","off","indexOf","push","domReady","onProgress","f","i","removeAttribute","list","splice","temp","getElementsByTagName","innerHTML","js","ajax","url","dataType","cache","complete","warn","everythingLoaded","setInterval","test","readyState","clearInterval","router","prototype","setAttribute","bindingEnabled","processingElement","bracketMatch","chackValidFunctionCall","allowedFunction","localEval","script_","_model_","_content_","preventExecution","check_","exec","trim","_result_","outerHTML","_evaled_","index","tagName","getAttribute","ref","$virtual","DOMCursor","modelRef","keys","Object","clearElementData","current","cleanData","dataParser","html","mask","runEval","variableList","itemMask","actual","slice","charCodeAt","uniqueDataParser","take","passVar","currentIndex","strDeclare","firstTime","JSON","stringify","check","scopes","VarPass_","VarPass","s1","obtained","forEach","val","bindArray","propertyName","targetNode","parentNode","htmlParsedData","oldArray","editProperty","refreshTimer","processElement","options","exist","elements","clearTimeout","refresh","item","all","first","prev","prepend","insertAfter","remove","create","insertBefore","update","currentRemoved","startRemove","propertyProxy","subject","defineProperty","enumerable","configurable","lastLength","Array","real","limit","foundChanges","compareObject","classList","contains","dom","createElement","virtual_scroll","handle","children","childElementCount","querySelectorAll","obj1","obj2","loopParser","content","returns","items","sf$bindedKey","initBindingInformation","get","set","softRefresh","bindInput","whichVar","alreadyInitialized","DOMNodeRemoved","removeModelBinding","hasAttribute","Node","parsePreprocess","queuePreprocess","ceiling","add","floor","append","styles","getComputedStyle","absHeight","parseFloat","Math","ceil","offsetHeight","after","next","before","removeAttr","data","everyRemovedNodes","nodes","nodeName","MutationObserver","observe","everyRecords","record","removedNodes","records","childList","subtree","addEventListener","bindedKey","String","Number","Boolean","destroy","getOwnPropertyDescriptor","dcBracket","bindObject","which","attrs","attrName","onChanges","objValue","writable","bindElement","brackets","s2","childNodes","excludes","toUpperCase","currentNode","nodeType","a","concat","nodeValue","loading","enabled","pauseRenderOnTransition","currentPage","initialized","currentRouterURL","popstateListener","event","routingError","routingBack","goto","location","pathname","beforeEvent","enable","status","load","removeEventListener","onEvent","loaded","special","lazyViewPoint","ev","href","history","pushState","path","origin","preventDefault","RouterLoading","abort","assign","_scarlets","success","parse","DOMReference","foundAction","afterEvent","title","found","oldURL","newURL","routerLoaded","xhr","aborted","back","styleInitialized","scrollingByScript","refreshScrollBounding","cursor","bounding","prepareCount","offsetTop","lastElementChild","preparedLength","dCursor","scrollHeight","scrollTo","scroller","refreshVirtualSpacer","virtual","reduce","scrollTop","vCursor","nextElementSibling","insertAdjacentElement","insertCount","previousElementSibling","removeUserScrollFocus","overflow","getAbsoluteHeight","el","margin","parseInt","force","checkCursorPosition","additionalScroll","moveTo","getElementById","id","head","appendChild","sheet","insertRule","initStyles","obtainElements","querySelector","_onElementResize","offElementResize","resetViewport","visibleLength","clientHeight","parentElement","firstElementChild","fillViewport","ceilingHeight","floorHeight","updating","resetCeiling","height","previousCeiling","nextFloor","_onElementResize_timer","scrollWidth","width","onElementResize","dynamicHeight","count","offsetTo","fromCeiling","scrollFocused","changes","vDOM","moveElementCursor","navigator","userAgent","staticHeight"],"mappings":"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","file":"scarletsframe.min.js","sourcesContent":["(function(global, factory){\r\n  var $ = null;\r\n  if(typeof exports === 'object' && typeof module !== 'undefined'){\r\n  \t$ = require(\"dom7\");\r\n\r\n  \tif($ === null){\r\n  \t\tconsole.log(\"ScarletsFrame can't load Dom7!\");\r\n  \t\treturn;\r\n  \t}\r\n  \tif($.fn.one === undefined)\r\n  \t\t$.fn.one = $.fn.once;\r\n\r\n  \tmodule.exports = factory($, global);\r\n  }\r\n\r\n  else{\r\n\tif(typeof Dom7 !== 'undefined')\r\n\t\t$ = Dom7;\r\n\telse if(typeof jQuery !== 'undefined')\r\n\t\t$ = jQuery;\r\n\telse\r\n\t\tthrow \"Please load jQuery or Dom7 before ScarletsFrame\";\r\n\r\n  \tglobal.sf = factory($, global);\r\n  }\r\n}(typeof window !== \"undefined\" ? window : this, (function($, window){'use strict';\r\nif(typeof document === undefined)\r\n\tdocument = window.document;\r\n// ===== Module Init =====\r\n\r\nvar sf = function(){\r\n\tif(arguments[0].constructor === Function){\r\n\t\treturn sf.loader.onFinish.apply(null, arguments);\r\n\t}\r\n};\r\n\r\nsf.internal = {};\r\nsf.regex = {\r\n\t// ToDo: Need help to skip escaped quote\r\n\tavoidQuotes:'(?=(?:[^\"\\']*(?:\\'|\")[^\"\\']*(?:\\'|\"))*[^\"\\']*$)',\r\n\tstrictVar:'(?=\\\\b[^.]|^|\\\\n| +|\\\\t|\\\\W )'\r\n};\r\n\r\nif(!$.fn.extend){\r\n\t$.fn.extend = function(obj){\r\n\t\tfor(var func in obj){\r\n\t\t\t$.fn[func] = obj[func];\r\n\t\t}\r\n\t}\r\n}\r\n\r\nif(!$.isEmptyObject){\r\n\t$.isEmptyObject = function(obj){\r\n\t\tfor(var key in obj){\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true\r\n\t}\r\n}\r\n\r\n// Add animate.css feature on jQuery\r\n$.fn.extend({\r\n  animateCSS: function(animationName, callback, duration) {\r\n\tvar self = this;\r\n\tvar animationEnd = {\r\n\t\tanimation: 'animationend',\r\n\t\tOAnimation: 'oAnimationEnd',\r\n\t\tMozAnimation: 'mozAnimationEnd',\r\n\t\tWebkitAnimation: 'webkitAnimationEnd',\r\n\t};\r\n\r\n\tfor (var t in animationEnd)\r\n\t\tif (self[0].style[t] !== undefined){\r\n\t\t\tanimationEnd = animationEnd[t];\r\n\t\t\tbreak;\r\n\t\t}\r\n\r\n\tif(duration)\r\n\t\tself.css('-webkit-animation-duration', duration+'s').css('animation-duration', duration+'s');\r\n\r\n\tself.addClass('animated ' + animationName).one(animationEnd, function(){\r\n\t\tsetTimeout(function(){\r\n\t\t\t$(self).removeClass('animated ' + animationName);\r\n\t\t}, 1);\r\n\r\n\t\tif(duration)\r\n\t\t\t$(self).css('-webkit-animation-duration', '').css('animation-duration', '');\r\n\r\n\t\tif (typeof callback === 'function') callback();\r\n\t});\r\n\r\n\treturn self;\r\n  }\r\n});","return sf;\r\n\r\n// ===== Module End =====\r\n})));","// DOM Controller on loaded app\r\nsf.controller = new function(){\r\n\tvar self = this;\r\n\tself.pending = {};\r\n\tself.active = {};\r\n\r\n\tself.for = function(name, func){\r\n\t\tself.pending[name] = func;\r\n\t}\r\n\r\n\tself.modelScope = function(element, func){\r\n\t\tvar elem = $(element);\r\n\t\tvar model = sf.controller.modelName(element);\r\n\r\n\t\tif(!model)\r\n\t\t\tthrow 'model or controller was not found';\r\n\r\n\t\tvar bindedList = elem.attr('[sf-bind-list]');\r\n\t\tif(!bindedList)\r\n\t\t\tbindedList = elem.parents('[sf-bind-list]').attr('sf-bind-list');\r\n\r\n\t\tif(!bindedList){\r\n\t\t\tif(func) return func(sf.model.root[model], -1);\r\n\t\t\telse return sf.model.root[model];\r\n\t\t}\r\n\r\n\t\t// Find index\r\n\t\tvar bindedListIndex = 0;\r\n\t\tif(bindedList)\r\n\t\t\tbindedListIndex = elem.parents('[sf-bind-list]').prevAll('[sf-bind-list]').length;\r\n\r\n\t\tif(func) return func(sf.model.root[model][bindedList], bindedListIndex);\r\n\t\telse return sf.model.root[model][bindedList][bindedListIndex];\r\n\t}\r\n\r\n\tself.modelName = function(element){\r\n\t\tvar name = undefined;\r\n\t\tif(element.attributes['sf-controller'])\r\n\t\t\tname = element.attributes['sf-controller'].value;\r\n\t\telse\r\n\t\t\tname = $(element).parents('[sf-controller]').attr('sf-controller');\r\n\r\n\t\t// Initialize it first\r\n\t\tif(name !== undefined && !self.active[name])\r\n\t\t\tself.run(name);\r\n\r\n\t\treturn name;\r\n\t}\r\n\r\n\tvar listenSFClick = function(e){\r\n\t\tvar element = $(e.target);\r\n\t\tvar script = element.attr('sf-click');\r\n\r\n\t\tif(!script){\r\n\t\t\telement = element.parents('[sf-click]').eq(0);\r\n\t\t\tscript = element.attr('sf-click');\r\n\t\t}\r\n\r\n\t\tvar model = element.parents('[sf-controller]').attr('sf-controller');\r\n\r\n\t\tif(!sf.model.root[model])\r\n\t\t\tthrow \"Couldn't find model for \"+model+\" that was called from sf-click\";\r\n\r\n\t\tvar _modelScope = sf.model.root[model];\r\n\r\n\t\tvar modelKeys = sf.model.modelKeys(_modelScope);\r\n\t\tvar scopeMask = RegExp(sf.regex.strictVar+'('+modelKeys+')'+sf.regex.avoidQuotes+'\\\\b', 'g');\r\n\r\n\t\tscript = script.replace(scopeMask, function(full, matched){\r\n\t\t\treturn '_modelScope.'+matched;\r\n\t\t});\r\n\r\n\t\tscript = script.split('(');\r\n\r\n\t\tvar method = script[0];\r\n\t\tvar method_ = method;\r\n\r\n\t\t// Get method reference\r\n\t\ttry{\r\n\t\t\tmethod = eval(method);\r\n\t\t} catch(e) {\r\n\t\t\tmethod = false;\r\n\t\t}\r\n\r\n\t\tif(!method){\r\n\t\t\tconsole.error(\"Error on sf-click for model: \" + model + ' [Cannot find '+method_+']\\n', e.target);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Take the argument list\r\n\t\tscript.shift();\r\n\t\tscript = script.join('(');\r\n\t\tscript = script.split(')');\r\n\t\tscript.pop();\r\n\t\tscript = script.join('(');\r\n\r\n\t\t// Turn argument as array\r\n\t\tif(script.length !== 0)\r\n\t\t\tscript = eval('['+script+']');\r\n\t\tif(!script)\r\n\t\t\tscript = [];\r\n\r\n\t\ttry{\r\n\t\t\tmethod.apply(element[0], script);\r\n\t\t} catch(e) {\r\n\t\t\tconsole.error(\"Error on sf-click for model: \" + model + '\\n', e.target, '\\n', e);\r\n\t\t}\r\n\t}\r\n\r\n\tvar root_ = function(scope){\r\n\t\tif(!sf.model.root[scope])\r\n\t\t\tsf.model.root[scope] = {};\r\n\r\n\t\tif(!sf.model.root[scope])\r\n\t\t\tsf.controller.run(scope);\r\n\r\n\t\treturn sf.model.root[scope];\r\n\t}\r\n\r\n\tself.run = function(name, func){\r\n\t\tif(!sf.loader.DOMWasLoaded)\r\n\t\t\treturn sf(function(){\r\n\t\t\t\tself.run(name, func);\r\n\t\t\t});\r\n\r\n\t\tif(self.pending[name]){\r\n\t\t\tif(!sf.model.root[name])\r\n\t\t\t\tsf.model.root[name] = {};\r\n\r\n\t\t\tself.pending[name](sf.model.root[name], root_);\r\n\t\t\tself.active[name] = true;\r\n\t\t\tdelete self.pending[name];\r\n\t\t}\r\n\r\n\t\tif(func)\r\n\t\t\tfunc(sf.model.root[name], root_);\r\n\t}\r\n\r\n\tself.init = function(parent){\r\n\t\tif(!sf.loader.DOMWasLoaded)\r\n\t\t\treturn sf(function(){\r\n\t\t\t\tself.init(name);\r\n\t\t\t});\r\n\r\n\t\t$('[sf-controller]', parent ? $(parent)[0] : document.body).each(function(){\r\n\t\t\tself.run(this.attributes['sf-controller'].value);\r\n\t\t});\r\n\t}\r\n\r\n\t// Create listener for sf-click\r\n\t$(document).one('DOMContentLoaded', function(){\r\n\t\t$(document.body).on('click', '[sf-click]', listenSFClick);\r\n\t});\r\n}","sf.loader = new function(){\r\n\tvar self = this;\r\n\tself.loadedContent = 0;\r\n\tself.totalContent = 0;\r\n\tself.DOMWasLoaded = false;\r\n\tself.DOMReady = false;\r\n\tself.turnedOff = false;\r\n\r\n\tvar whenDOMReady = [];\r\n\tvar whenDOMLoaded = [];\r\n\tvar whenProgress = [];\r\n\r\n\tself.off = function(){\r\n\t\tself.turnedOff = true;\r\n\t}\r\n\r\n\t// Make event listener\r\n\tself.onFinish = function(func){\r\n\t\tif(self.DOMWasLoaded) return func();\r\n\t\tif(whenDOMLoaded.indexOf(func) !== -1) return;\r\n\t\twhenDOMLoaded.push(func);\r\n\t}\r\n\tself.domReady = function(func){\r\n\t\tif(self.DOMReady) return func();\r\n\t\tif(whenDOMReady.indexOf(func) !== -1) return;\r\n\t\twhenDOMReady.push(func);\r\n\t}\r\n\tself.onProgress = function(func){\r\n\t\tif(self.DOMWasLoaded) return func(self.loadedContent, self.totalContent);\r\n\t\tif(whenProgress.indexOf(func) !== -1) return;\r\n\t\twhenProgress.push(func);\r\n\t}\r\n\r\n\tself.f = function(element){\r\n\t\tself.loadedContent++;\r\n\t\tfor (var i = 0; i < whenProgress.length; i++) {\r\n\t\t\twhenProgress[i](self.loadedContent, self.totalContent);\r\n\t\t}\r\n\t\tif(element && element.removeAttribute) element.removeAttribute('onload');\r\n\t}\r\n\r\n\tself.css = function(list){\r\n\t\tif(self.DOMWasLoaded){\r\n\t\t\t// check if some list was loaded\r\n\t\t\tfor (var i = list.length - 1; i >= 0; i--) {\r\n\t\t\t\tif($('link[href*=\"'+list[i]+'\"]').length!==0)\r\n\t\t\t\t\tlist.splice(i, 1);\r\n\t\t\t}\r\n\t\t\tif(list.length === 0) return;\r\n\t\t}\r\n\t\tself.totalContent = self.totalContent + list.length;\r\n\t\tvar temp = '';\r\n\t\tfor(var i = 0; i < list.length; i++){\r\n\t\t\ttemp += '<link onload=\"sf.loader.f(this);\" rel=\"stylesheet\" href=\"'+list[i]+'\">';\r\n\t\t}\r\n\r\n\t\tself.domReady(function(){\r\n\t\t\tdocument.getElementsByTagName('body')[0].innerHTML += temp;\r\n\t\t});\r\n\t}\r\n\r\n\tself.js = function(list){\r\n\t\tif(self.DOMWasLoaded){\r\n\t\t\t// check if some list was loaded\r\n\t\t\tfor (var i = list.length - 1; i >= 0; i--) {\r\n\t\t\t\tif($('script[src*=\"'+list[i]+'\"]').length!==0)\r\n\t\t\t\t\tlist.splice(i, 1);\r\n\t\t\t}\r\n\t\t\tif(list.length === 0) return;\r\n\t\t}\r\n\t\tself.totalContent = self.totalContent + list.length;\r\n\t\tfor(var i = 0; i < list.length; i++){\r\n\t\t\t$.ajax({\r\n\t\t\t  url: list[i],\r\n\t\t\t  dataType: \"script\",\r\n\t\t\t  cache: true,\r\n\t\t\t  complete: sf.loader.f\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tsetTimeout(function(){\r\n\t\tif(self.totalContent === 0 && !self.turnedOff){\r\n\t\t\tself.loadedContent = self.totalContent = 1;\r\n\t\t\tconsole.warn(\"If you don't use content loader feature, please turn it off with `sf.loader.off()`\");\r\n\t\t}\r\n\t}, 10000);\r\n\tvar everythingLoaded = setInterval(function() {\r\n\tif (/loaded|complete/.test(document.readyState)) {\r\n\t\tif(self.DOMReady === false){\r\n\t\t\tself.DOMReady = true;\r\n\t\t\tfor (var i = 0; i < whenDOMReady.length; i++) {\r\n\t\t\t\ttry{\r\n\t\t\t\t\twhenDOMReady[i]();\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(self.loadedContent < self.totalContent || self.loadedContent === 0){\r\n\t\t\tif(!self.turnedOff)\r\n\t\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tclearInterval(everythingLoaded);\r\n\t\tself.DOMWasLoaded = true;\r\n\t\tfor (var i = 0; i < whenDOMLoaded.length; i++) {\r\n\t\t\ttry{\r\n\t\t\t\twhenDOMLoaded[i]();\r\n\t\t\t} catch(e){\r\n\t\t\t\tconsole.error(e);\r\n\t\t\t}\r\n\t\t}\r\n\t\twhenProgress.splice(0);\r\n\t\twhenDOMReady.splice(0);\r\n\t\twhenDOMLoaded.splice(0);\r\n\t\twhenProgress = whenDOMReady = whenDOMLoaded = null;\r\n\r\n\t\t// Last init\r\n\t\tsf.controller.init();\r\n\t\tsf.model.init();\r\n\t\tsf.router.init();\r\n\t}\r\n\t}, 100);\r\n};\r\nsf.prototype.constructor = sf.loader.onFinish;\r\n\r\n// Find images\r\nsf.loader.domReady(function(){\r\n\t$('img:not(onload)[src]').each(function(){\r\n\t\tsf.loader.totalContent++;\r\n\t\tthis.setAttribute('onload', \"sf.loader.f(this)\");\r\n\t});\r\n}, 0);","// Data save and HTML content binding\r\nsf.model = function(scope){\r\n\tif(!sf.model.root[scope])\r\n\t\tsf.model.root[scope] = {};\r\n\r\n\tif(sf.controller.pending[scope])\r\n\t\tsf.controller.run(scope);\r\n\r\n\treturn sf.model.root[scope];\r\n};\r\n\r\n(function(){\r\n\tvar self = sf.model;\r\n\tvar bindingEnabled = false;\r\n\tself.root = {};\r\n\r\n\tvar processingElement = null;\r\n\r\n\tvar bracketMatch = RegExp('([\\\\w.]*?[\\\\S\\\\s])\\\\('+sf.regex.avoidQuotes, 'g');\r\n\tvar chackValidFunctionCall = /[a-zA-Z0-9 \\]\\$\\)]/;\r\n\tvar allowedFunction = [':', 'for', 'if', 'while', '_content_.take', 'console.log'];\r\n\tvar localEval = function(script_, _model_, _modelScope, _content_){\r\n\t\t\"use strict\";\r\n\t\tvar script = script_;\r\n\t\tscript_ = script_.split('\\\\\"').join('\\\\$%*').split(\"\\\\'\").join('\\\\%$*'); // ToDo: Escape\r\n\t\tscript_ = script_.split('._modelScope').join('');\r\n\t\tscript_ = script_.split('._model_').join('');\r\n\r\n\t\t// Prevent vulnerability by remove bracket to avoid a function call\r\n\t\tvar preventExecution = false;\r\n\t\tvar check_ = null;\r\n\t\twhile((check_ = bracketMatch.exec(script_)) !== null){\r\n\t\t\tcheck_[1] = check_[1].trim();\r\n\r\n\t\t\tif(allowedFunction.indexOf(check_[1]) === -1 &&\r\n\t\t\t\tcheck_[1].split('.')[0] !== '_modelScope' &&\r\n\t\t\t\tchackValidFunctionCall.test(check_[1][check_[1].length-1])\r\n\t\t\t){\r\n\t\t\t\tpreventExecution = check_[1];\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar _result_ = '';\r\n\t\tscript_ = script_.split('\\\\$%*').join('\\\\\"').split('\\\\%$*').join(\"\\\\'\"); // ToDo: Unescape\r\n\t\tif(preventExecution){\r\n\t\t\tconsole.error(\"Trying to executing unrecognized function (\"+preventExecution+\")\");\r\n\t\t\tconsole.log($(processingElement.outerHTML)[0]);\r\n\t\t\tconsole.log(script_);\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\ttry{\r\n\t\t\tif(/@return /.test(script_) === true){\r\n\t\t\t\tvar _evaled_ = eval('(function(){'+script_.split('@return ').join('return ')+'})()');\r\n\t\t\t\treturn _result_ + _evaled_;\r\n\t\t\t}\r\n\t\t\telse var _evaled_ = eval(script_);\r\n\t\t} catch(e){\r\n\t\t\tconsole.error(e);\r\n\t\t\tconsole.log(script_);\r\n\t\t\tconsole.log($(processingElement.outerHTML)[0]);\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\tif(_result_ !== '') return _result_;\r\n\t\treturn _evaled_;\r\n\t}\r\n\r\n\tself.index = function(element){\r\n\t\tvar i = $(element).prevAll(element.tagName).length;\r\n\t\tvar list = element.getAttribute('sf-bind-list');\r\n\t\tif(!list) return i;\r\n\r\n\t\tvar ref = sf.controller.modelScope(element)[list];\r\n\t\tif(!ref.$virtual) return i;\r\n\r\n\t\treturn i + ref.$virtual.DOMCursor - 1;\r\n\t}\r\n\r\n\tself.for = function(name, func){\r\n\t\tif(!sf.loader.DOMWasLoaded)\r\n\t\t\treturn sf(function(){\r\n\t\t\t\tself.for(name, func);\r\n\t\t\t});\r\n\t\t\r\n\t\tfunc(self(name), self);\r\n\t}\r\n\r\n\tself.modelKeys = function(modelRef){\r\n\t\tvar keys = Object.keys(modelRef);\r\n\t\tfor (var i = keys.length - 1; i >= 0; i--) {\r\n\t\t\tif(keys[i].indexOf('$') !== -1)\r\n\t\t\t\tkeys.splice(i, 1);\r\n\t\t}\r\n\t\treturn keys.join('|');\r\n\t}\r\n\r\n\tvar clearElementData = function(current){\r\n\t\t// Clean associated data on jQuery\r\n\t\tif($ && $.cleanData)\r\n\t\t\t$.cleanData(current.getElementsByTagName(\"*\"));\r\n\r\n\t\tcurrent.innerHTML = '';\r\n\t\tfor (var i = 0; i < current.attributes.length; i++) {\r\n\t\t\tvar name = current.attributes[i].name;\r\n\t\t\tif(name !== 'sf-bind-list')\r\n\t\t\t\tcurrent.removeAttribute(name);\r\n\t\t}\r\n\t\tcurrent.setAttribute('style', 'display:none');\r\n\t}\r\n\r\n\t// For contributor of this library\r\n\t// Please be careful when you're passing the eval argument\r\n\tvar dataParser = function(html, _model_, mask, scope, runEval){\r\n\t\tvar _modelScope = self.root[scope];\r\n\t\tif(!runEval) runEval = '';\r\n\t\t\r\n\t\t// Unmatch any function\r\n\t\tvar variableList = self.modelKeys(_modelScope);\r\n\t\tfor(var i = variableList.length - 1; i >= 0; i--){\r\n\t\t\tif(_modelScope[variableList[i]] instanceof Function)\r\n\t\t\t\tvariableList.splice(i, 1);\r\n\t\t}\r\n\r\n\t\t// Don't match text inside quote, or object keys\r\n\t\tvar scopeMask = RegExp(sf.regex.strictVar+'('+variableList+')'+sf.regex.avoidQuotes+'\\\\b', 'g');\r\n\r\n\t\tif(mask)\r\n\t\t\tvar itemMask = RegExp(sf.regex.strictVar+mask+'\\\\.'+sf.regex.avoidQuotes+'\\\\b', 'g');\r\n\r\n\t\tbindingEnabled = true;\r\n\r\n\t\treturn html.replace(/{{([^@][\\s\\S]*?)}}/g, function(actual, temp){\r\n\t\t\t// ToDo: The regex should be optimized to avoid match in a quote (but not escaped quote)\r\n\t\t\ttemp = temp.split('\\\\\"').join('\\\\$%*').split(\"\\\\'\").join('\\\\%$*'); // ToDo: Escape\r\n\r\n\t\t\t// Mask item variable\r\n\t\t\tif(mask)\r\n\t\t\t\ttemp = temp.replace(itemMask, function(matched){\r\n\t\t\t\t\treturn '_model_.'+matched[0].slice(1);\r\n\t\t\t\t});\r\n\r\n\t\t\t// Mask model for variable\r\n\t\t\ttemp = temp.replace(scopeMask, function(full, matched){\r\n\t\t\t\treturn '_modelScope.'+matched;\r\n\t\t\t});\r\n\r\n\t\t\ttemp = temp.split('\\\\$%*').join('\\\\\"').split('\\\\%$*').join(\"\\\\'\"); // ToDo: Unescape\r\n\r\n\t\t\t// Evaluate\r\n\t\t\ttemp = '' + localEval.apply(self.root, [runEval + temp, _model_, _modelScope]);\r\n\r\n\t\t\treturn temp.replace(/[\\u00A0-\\u9999<>\\&]/gim, function(i) {\r\n\t\t        return '&#'+i.charCodeAt(0)+';';\r\n\t\t    });\r\n\t\t});\r\n\t}\r\n\r\n\tvar uniqueDataParser = function(html, _model_, mask, scope){\r\n\t\t// Get prepared html content\r\n\t\tvar _content_ = {\r\n\t\t\tlength:0,\r\n\t\t\ttake:function(passVar, currentIndex){\r\n\t\t\t\tif(!passVar)\r\n\t\t\t\t\treturn dataParser(this[currentIndex], _model_, mask, scope);\r\n\r\n\t\t\t\tvar strDeclare = '\"use strict\";var ';\r\n\t\t\t\tvar firstTime = true;\r\n\r\n\t\t\t\tfor(var key in passVar){\r\n\t\t\t\t\tif(typeof passVar[key] === 'string')\r\n\t\t\t\t\t\tpassVar[key] = '\"'+passVar[key].split('\"').join('\\\\\"')+'\"';\r\n\t\t\t\t\telse if(typeof passVar[key] === 'object')\r\n\t\t\t\t\t\tpassVar[key] = JSON.stringify(passVar[key]);\r\n\r\n\t\t\t\t\tif(!firstTime)\r\n\t\t\t\t\t\tstrDeclare += ',';\r\n\r\n\t\t\t\t\tstrDeclare += key + ' = ' + passVar[key];\r\n\t\t\t\t\tfirstTime = false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Remove var because no variable are being passed\r\n\t\t\t\tif(firstTime === true)\r\n\t\t\t\t\tstrDeclare = strDeclare.replace('var ', '');\r\n\r\n\t\t\t\t// Disable function call for addional security eval protection\r\n\t\t\t\tstrDeclare = strDeclare.split('(').join('').split(')').join('');\r\n\r\n\t\t\t\treturn dataParser(this[currentIndex], _model_, mask, scope, strDeclare + ';');\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\thtml = html.replace(/{\\[([\\s\\S]*?)\\]}/g, function(full, matched){\r\n\t\t\tif(/{{.*?}}/.test(matched) === false)\r\n\t\t\t\treturn \"_result_ += '\"+matched.split(\"'\").join(\"\\\\'\")+\"'\";\r\n\r\n\t\t\t_content_[_content_.length] = matched;\r\n\t\t\t_content_.length++;\r\n\t\t\treturn '_result_ += _content_.take(&VarPass&, '+(_content_.length - 1)+');';\r\n\t\t});\r\n\r\n\t\tvar _modelScope = self.root[scope];\r\n\r\n\t\t// Don't match text inside quote, or object keys\r\n\t\tvar scopeMask = RegExp(sf.regex.strictVar+'('+self.modelKeys(_modelScope)+')'+sf.regex.avoidQuotes+'\\\\b', 'g');\r\n\r\n\t\tif(mask)\r\n\t\t\tvar itemMask = RegExp(sf.regex.strictVar+mask+'\\\\.'+sf.regex.avoidQuotes+'\\\\b', 'g');\r\n\r\n\t\treturn html.replace(/{{(@[\\s\\S]*?)}}/g, function(actual, temp){\r\n\t\t\t// ToDo: The regex should be optimized to avoid match in a quote (but not escaped quote)\r\n\t\t\ttemp = temp.split('\\\\\"').join('\\\\$%*').split(\"\\\\'\").join('\\\\%$*'); // ToDo: Escape\r\n\r\n\t\t\t// Mask item variable\r\n\t\t\tif(mask)\r\n\t\t\t\ttemp = temp.replace(itemMask, function(matched){\r\n\t\t\t\t\treturn '_model_.'+matched[0].slice(1);\r\n\t\t\t\t});\r\n\r\n\t\t\t// Mask model for variable\r\n\t\t\ttemp = temp.replace(scopeMask, function(full, matched){\r\n\t\t\t\treturn '_modelScope.'+matched;\r\n\t\t\t});\r\n\t\t\ttemp = temp.split('\\\\$%*').join('\\\\\"').split('\\\\%$*').join(\"\\\\'\"); // ToDo: Unescape\r\n\r\n\t\t\tvar result = '';\r\n\t\t\tvar check = false;\r\n\r\n\t\t\tcheck = temp.split('@if ');\r\n\t\t\tif(check.length != 1){\r\n\t\t\t\tcheck = check[1].split(':');\r\n\t\t\t\tvar scopes = [check[0], _model_, _modelScope, _content_];\r\n\t\t\t\r\n\t\t\t\t// If condition was not meet\r\n\t\t\t\tif(localEval.apply(self.root, scopes) == false)\r\n\t\t\t\t\treturn '';\r\n\r\n\t\t\t\tcheck.shift();\r\n\t\t\t\tscopes.splice(0, 1, check.join(':').split('&VarPass&').join('{}'));\r\n\t\t\t\treturn localEval.apply(self.root, scopes);\r\n\t\t\t}\r\n\r\n\t\t\t// Get defined variables\r\n\t\t\tvar VarPass_ = /(var|let)([\\w,\\s]+)(?=\\s(?==|in|of))/g;\r\n\t\t\tvar VarPass = [];\r\n\t\t\tvar s1 = null;\r\n\t\t\twhile((s1 = VarPass_.exec(temp)) !== null){\r\n\t\t\t\tVarPass.push(s1[2]);\r\n\t\t\t}\r\n\t\t\tif(VarPass.length){\r\n\t\t\t\tvar obtained = [];\r\n\t\t\t\tfor (var i = 0; i < VarPass.length; i++) {\r\n\t\t\t\t\tVarPass[i].replace(/([\\n\\t\\r]|  )+/g, '').split(',').forEach(function(val){\r\n\t\t\t\t\t\tobtained.push(val);\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\t\t\t\tVarPass = obtained;\r\n\t\t\t\tfor (var i = 0; i < VarPass.length; i++) {\r\n\t\t\t\t\tVarPass[i] += ':(typeof '+VarPass[i]+'!==\"undefined\"?'+VarPass[i]+':undefined)';\r\n\t\t\t\t}\r\n\t\t\t\tVarPass = '{'+VarPass.join(',')+'}';\r\n\t\t\t\ttemp = temp.split('&VarPass&').join(VarPass);\r\n\t\t\t}\r\n\t\t\ttemp = temp.split('&VarPass&').join('{}'); \r\n\r\n\t\t\t// Warning! Avoid unencoded user inputted content\r\n\t\t\t// And always check/remove closing ']}' in user content\r\n\t\t\t// Any function call will be removed for addional security\r\n\t\t\tcheck = temp.split('@exec');\r\n\t\t\tif(check.length != 1){\r\n\t\t\t\tcheck = check[1].split('&lt;').join('<').split('&gt;').join('>').split('&amp;').join('&');\r\n\r\n\t\t\t\ttemp = localEval.apply(self.root, [check, _model_, _modelScope, _content_]);\r\n\t\t\t\treturn temp;\r\n\t\t\t}\r\n\t\t\treturn '';\r\n\t\t});\r\n\t}\r\n\r\n\tvar bindArray = function(html, list, mask, modelName, propertyName, targetNode, parentNode, htmlParsedData){\r\n\t\tvar oldArray = list.slice(0);\r\n\t\tvar editProperty = ['pop', 'push', 'splice', 'shift', 'unshift', 'softRefresh', 'hardRefresh'];\r\n\t\tvar refreshTimer = -1;\r\n\t\tvar processElement = function(index, options){\r\n\t\t\tvar exist = $(\"[sf-controller='\"+modelName+\"']\", targetNode);\r\n\t\t\tif(exist.length === 0){\r\n\t\t\t\tif(targetNode.getAttribute('sf-controller') === modelName)\r\n\t\t\t\t\texist = targetNode;\r\n\t\t\t\telse return;\r\n\t\t\t}\r\n\r\n\t\t\tif(list.$virtual){\r\n\t\t\t\tvar exist = $(list.$virtual.elements());\r\n\r\n\t\t\t\tclearTimeout(refreshTimer);\r\n\t\t\t\trefreshTimer = setTimeout(function(){\r\n\t\t\t\t\tlist.$virtual.refresh(true);\r\n\t\t\t\t}, 100);\r\n\t\t\t}\r\n\t\t\telse exist = $(\"[sf-bind-list='\"+propertyName+\"']\", exist);\r\n\r\n\t\t\tvar callback = false;\r\n\t\t\tif(self.root[modelName]['on$'+propertyName])\r\n\t\t\t\tcallback = self.root[modelName]['on$'+propertyName];\r\n\r\n\t\t\t// Hard refresh\r\n\t\t\tif(index === -1){\r\n\t\t\t\tvar item = self.root[modelName][propertyName];\r\n\t\t\t\tvar all = '';\r\n\t\t\t\tfor (var i = 0; i < item.length; i++) {\r\n\t\t\t\t\tvar temp = uniqueDataParser(html, item[i], mask, modelName);\r\n\t\t\t\t\tall += dataParser(temp, item[i], mask, modelName);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Get first element\r\n\t\t\t\tvar first = exist.eq(0).prev();\r\n\t\t\t\tif(first[0] === exist[0])\r\n\t\t\t\t\texist.parent().prepend(all);\r\n\t\t\t\telse\r\n\t\t\t\t\t$(all).insertAfter(first);\r\n\t\t\t\texist.remove();\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Remove\r\n\t\t\tif(options === 'remove'){\r\n\t\t\t\tif(exist[index]){\r\n\t\t\t\t\tvar currentRemoved = false;\r\n\t\t\t\t\tvar startRemove = function(){\r\n\t\t\t\t\t\tif(currentRemoved) return;\r\n\t\t\t\t\t\tcurrentRemoved = true;\r\n\r\n\t\t\t\t\t\tif(exist.length <= 1)\r\n\t\t\t\t\t\t\treturn clearElementData(exist[index]);\r\n\r\n\t\t\t\t\t\texist[index].remove();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(callback.remove){\r\n\t\t\t\t\t\t// Auto remove if return false\r\n\t\t\t\t\t\tif(!callback.remove(exist[index], startRemove))\r\n\t\t\t\t\t\t\tsetTimeout(startRemove, 800);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Auto remove if no callback\r\n\t\t\t\t\telse startRemove();\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Create or update\r\n\t\t\tvar item = self.root[modelName][propertyName][index];\r\n\r\n\t\t\tvar temp = uniqueDataParser(html, item, mask, modelName);\r\n\t\t\ttemp = dataParser(temp, item, mask, modelName);\r\n\t\t\ttemp = $(temp);\r\n\r\n\t\t\t// Create\r\n\t\t\tif(!exist[index] || options === 'insertAfter'){\r\n\t\t\t\tif(callback.create)\r\n\t\t\t\t\tcallback.create(temp[0]);\r\n\r\n\t\t\t\ttemp.insertAfter(exist[index !== 0 ? index - 1 : (exist.length - 1)]);\r\n\t\t\t}\r\n\r\n\t\t\telse{\r\n\t\t\t\t// Create\r\n\t\t\t\tif(options === 'insertBefore'){\r\n\t\t\t\t\tif(callback.create)\r\n\t\t\t\t\t\tcallback.create(temp[0]);\r\n\r\n\t\t\t\t\ttemp.insertBefore(exist[0]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Update\r\n\t\t\t\telse{\r\n\t\t\t\t\tif(callback.update)\r\n\t\t\t\t\t\tcallback.update(temp[0]);\r\n\r\n\t\t\t\t\t// Clean associated data on jQuery\r\n\t\t\t\t\tif($ && $.cleanData){\r\n\t\t\t\t\t\t$.cleanData(exist[index].getElementsByTagName(\"*\"));\r\n\t\t\t\t\t\t$.cleanData(exist[index]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\texist[index].outerHTML = temp[0].outerHTML;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar propertyProxy = function(subject, name){\r\n\t\t\tObject.defineProperty(subject, name, {\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tconfigurable: true,\r\n\t\t\t\tvalue: function(){\r\n\t\t\t\t\tvar temp = undefined;\r\n\t\t\t\t\tvar lastLength = this.length;\r\n\r\n\t\t\t\t\tif(Array.prototype[name])\r\n\t\t\t\t\t\ttemp = Array.prototype[name].apply(this, arguments);\r\n\r\n\t\t\t\t\tif(name === 'pop')\r\n\t\t\t\t\t\tprocessElement(lastLength - 1, 'remove');\r\n\r\n\t\t\t\t\telse if(name === 'push')\r\n\t\t\t\t\t\tprocessElement(lastLength, 'add');\r\n\r\n\t\t\t\t\telse if(name === 'shift')\r\n\t\t\t\t\t\tprocessElement(0, 'remove');\r\n\r\n\t\t\t\t\telse if(name === 'splice'){\r\n\t\t\t\t\t\t// Obtaining all data\r\n\t\t\t\t\t\tif(arguments[0] === null){\r\n\t\t\t\t\t\t\toldArray.splice(0);\r\n\t\t\t\t\t\t\treturn temp;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Removing data\r\n\t\t\t\t\t\tvar real = arguments[0];\r\n\t\t\t\t\t\tif(real < 0) real = lastLength + real;\r\n\r\n\t\t\t\t\t\tvar limit = arguments[1];\r\n\t\t\t\t\t\tif(!limit && limit !== 0) limit = oldArray.length;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tfor (var i = limit - 1; i >= 0; i--) {\r\n\t\t\t\t\t\t\tprocessElement(real + i, 'remove');\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif(arguments.length >= 3){ // Inserting data\r\n\t\t\t\t\t\t\tlimit = arguments.length - 2;\r\n\t\t\t\t\t\t\tfor (var i = 0; i < limit; i++) {\r\n\t\t\t\t\t\t\t\tprocessElement(real + i, 'insertAfter');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\telse if(name === 'unshift')\r\n\t\t\t\t\t\tprocessElement(0, 'insertBefore');\r\n\r\n\t\t\t\t\telse if(name === 'softRefresh'){\r\n\t\t\t\t\t\tif(arguments[0] || arguments[0] === 0)\r\n\t\t\t\t\t\t\tprocessElement(arguments[0], !!oldArray[arguments[0]] ? 'add':'remove');\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tvar foundChanges = false;\r\n\r\n\t\t\t\t\t\t\t// Removal\r\n\t\t\t\t\t\t\tif(oldArray.length > this.length){\r\n\t\t\t\t\t\t\t\tfor (var i = oldArray.length - 1; i >= this.length; i--) {\r\n\t\t\t\t\t\t\t\t\tif(this.indexOf(oldArray[i]) === -1){\r\n\t\t\t\t\t\t\t\t\t\tfoundChanges = true;\r\n\t\t\t\t\t\t\t\t\t\tprocessElement(i, 'remove');\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Creates\r\n\t\t\t\t\t\t\tif(oldArray.length < this.length){\r\n\t\t\t\t\t\t\t\tfor (var i = oldArray.length - 1; i < this.length; i++) {\r\n\t\t\t\t\t\t\t\t\tfoundChanges = true;\r\n\t\t\t\t\t\t\t\t\tprocessElement(i, 'insertBefore');\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Update\r\n\t\t\t\t\t\t\tfor (var i = 0; i < this.length; i++) {\r\n\t\t\t\t\t\t\t\tif(compareObject(oldArray[i], this[i]) === false){\r\n\t\t\t\t\t\t\t\t\tfoundChanges = true;\r\n\t\t\t\t\t\t\t\t\tprocessElement(i, 'add');\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif(foundChanges)\r\n\t\t\t\t\t\t\t\toldArray = this.slice(0);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if(name === 'hardRefresh')\r\n\t\t\t\t\t\tprocessElement(-1, 'remove');\r\n\r\n\t\t\t\t\tif(Array.prototype[name])\r\n\t\t\t\t\t\toldArray = this.slice(0);\r\n\r\n\t\t\t\t\treturn temp;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif(parentNode && parentNode.classList.contains('sf-virtual-list')){\r\n\t\t\tObject.defineProperty(list, '$virtual', {\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tconfigurable: true,\r\n\t\t\t\tvalue:{}\r\n\t\t\t});\r\n\r\n\t\t\t// Parse in virtual DOM\r\n\t\t\tlist.$virtual.dom = document.createElement('div');\r\n\t\t\tlist.$virtual.dom.innerHTML = htmlParsedData;\r\n\r\n\t\t\tsf.internal.virtual_scroll.handle(list, targetNode, parentNode);\r\n\t\t}\r\n\r\n\t\tfor (var i = 0; i < editProperty.length; i++) {\r\n\t\t\tpropertyProxy(list, editProperty[i]);\r\n\t\t}\r\n\r\n\t\tObject.defineProperty(list, 'getElement', {\r\n\t\t\tenumerable: false,\r\n\t\t\tconfigurable: true,\r\n\t\t\tvalue: function(index){\r\n\t\t\t\tif(list.$virtual){\r\n\t\t\t\t\tif(index < list.$virtual.DOMCursor)\r\n\t\t\t\t\t\treturn list.$virtual.dom.children[index];\r\n\r\n\t\t\t\t\tindex -= list.$virtual.DOMCursor;\r\n\t\t\t\t\tvar reducedIndex = index - parentNode.childElementCount + 2;\r\n\t\t\t\t\tif(reducedIndex <= 0)\r\n\t\t\t\t\t\treturn parentNode.children[index + 1];\r\n\r\n\t\t\t\t\treturn list.$virtual.dom.children[index + list.$virtual.DOMCursor];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(parentNode.childElementCount === list.length)\r\n\t\t\t\t\treturn parentNode.children[index];\r\n\r\n\t\t\t\treturn parentNode.querySelectorAll('[sf-bind-list=\"'+propertyName+'\"]')[index];\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tfunction compareObject(obj1, obj2){\r\n\t\tif(!obj1 || !obj2)\r\n\t\t\treturn false;\r\n\r\n\t\tfor(var i in obj1){\r\n\t\t\tif(typeof obj1[i] !== 'object' && obj1[i] !== obj2[i])\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tvar loopParser = function(name, content, script, targetNode, parentNode){\r\n\t\tvar returns = '';\r\n\t\tvar method = script.split(' in ');\r\n\t\tvar mask = method[0];\r\n\r\n\t\tif(!self.root[name])\r\n\t\t\treturn console.error(\"Can't parse element because model for '\"+name+\"' was not found\", $(content)[0]);\r\n\r\n\t\tvar items = self.root[name][method[1]];\r\n\r\n\t\t// Get reference for debugging\r\n\t\tprocessingElement = $(content).attr('sf-bind-list', method[1])[0];\r\n\r\n\t\tcontent = processingElement.outerHTML;\r\n\t\tcontent = content.replace(/  +|\\t+/g, '');\r\n\r\n\t\tif(method.length === 2){\r\n\t\t\tvar temp = '';\r\n\t\t\tfor(var i in items){\r\n\t\t\t\tvar item = items[i];\r\n\r\n\t\t\t\ttemp = uniqueDataParser(content, item, mask, name);\r\n\t\t\t\ttemp = dataParser(temp, item, mask, name);\r\n\t\t\t\treturns += temp;\r\n\t\t\t}\r\n\r\n\t\t\tvar modelRef = self.root[name];\r\n\r\n\t\t\t// Enable element binding\r\n\t\t\tif(modelRef.sf$bindedKey === undefined)\r\n\t\t\t\tinitBindingInformation(modelRef);\r\n\r\n\t\t\tif(modelRef.sf$bindedKey[method[1]] === undefined)\r\n\t\t\t\tmodelRef.sf$bindedKey[method[1]] = null;\r\n\r\n\t\t\tObject.defineProperty(modelRef, method[1], {\r\n\t\t\t\tenumerable: true,\r\n\t\t\t\tconfigurable: true,\r\n\t\t\t\tget:function(){\r\n\t\t\t\t\treturn items;\r\n\t\t\t\t},\r\n\t\t\t\tset:function(val){\r\n\t\t\t\t\tfor (var i = 0; i < val.length; i++) {\r\n\t\t\t\t\t\tif(items[i]){\r\n\t\t\t\t\t\t\titems[i] = val[i];\r\n\t\t\t\t\t\t\titems.softRefresh(i);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse items.push(val[i]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(items.length > val.length)\r\n\t\t\t\t\t\titems.splice(val.length);\r\n\r\n\t\t\t\t\treturn items;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tbindArray(content, items, mask, name, method[1], targetNode, parentNode, returns);\r\n\t\t}\r\n\t\treturn returns;\r\n\t}\r\n\r\n\tvar bindInput = function(targetNode){\r\n\t\t$('input[sf-bound]', targetNode).each(function(){\r\n\t\t\tvar model = sf.controller.modelName(this);\r\n\t\t\tif(!model) return;\r\n\r\n\t\t\tvar whichVar = this.getAttribute('sf-bound');\r\n\r\n\t\t\t// Get reference\r\n\t\t\tif(typeof self.root[model][whichVar] === undefined){\r\n\t\t\t\tconsole.error('Cannot get reference for self.root[\"' + model + '\"][\"' + whichVar+'\"]');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.setAttribute('sf-bounded', whichVar);\r\n\t\t\tthis.removeAttribute('sf-bound');\r\n\r\n\t\t\t// Bound value change\r\n\t\t\tvar element = $(this);\r\n\t\t\tif(this.tagName === 'INPUT' || this.tagName === 'TEXTAREA')\r\n\t\t\t\telement.on('keyup', function(e){\r\n\t\t\t\t\tself.root[model][whichVar] = element.val();\r\n\t\t\t\t});\r\n\r\n\t\t\telse\r\n\t\t\t\telement.on('change', function(e){\r\n\t\t\t\t\tself.root[model][whichVar] = element.val();\r\n\t\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tvar alreadyInitialized = false;\r\n\tself.init = function(targetNode){\r\n\t\tif(alreadyInitialized && !targetNode) return;\r\n\t\talreadyInitialized = true;\r\n\t\tsetTimeout(function(){\r\n\t\t\talreadyInitialized = false;\r\n\t\t}, 50);\r\n\r\n\t\tif(targetNode){\r\n\t\t\tif(!(targetNode instanceof Node))\r\n\t\t\t\ttargetNode = $(targetNode)[0];\r\n\t\t}\r\n\t\telse targetNode = document.body;\r\n\r\n\t\tself.parsePreprocess(self.queuePreprocess(targetNode));\r\n\t\tbindInput(targetNode);\r\n\r\n\t\t$('[sf-repeat-this]', targetNode).each(function(){\r\n\t\t\tvar self = $(this);\r\n\t\t\tvar parent = self.parent();\r\n\r\n\t\t\tif(this.parentNode.classList.contains('sf-virtual-list')){\r\n\t\t\t\tvar tagName = $(this.parentNode).children('[sf-repeat-this]')[0].tagName;\r\n\t\t\t\tvar ceiling = document.createElement(tagName);\r\n\t\t\t\tceiling.classList.add('virtual-spacer');\r\n\t\t\t\tceiling.classList.add('ceiling');\r\n\t\t\t\t//ceiling.style.transform = 'scaleY(0)';\r\n\t\t\t\tthis.parentNode.prepend(ceiling);\r\n\r\n\t\t\t\tvar floor = document.createElement(tagName);\r\n\t\t\t\tfloor.classList.add('virtual-spacer');\r\n\t\t\t\tfloor.classList.add('floor');\r\n\t\t\t\t//floor.style.transform = 'scaleY(0)';\r\n\t\t\t\tthis.parentNode.append(floor);\r\n\r\n\t\t\t\t// His total scrollHeight\r\n\t\t\t\tvar styles = window.getComputedStyle(this);\r\n\t\t\t\tvar absHeight = parseFloat(styles['marginTop']) + parseFloat(styles['marginBottom']);\r\n\t\t\t\tstyles = null;\r\n\r\n\t\t\t\t// Element height + margin\r\n\t\t\t\tabsHeight = Math.ceil(this.offsetHeight + absHeight);\r\n\t\t\t}\r\n\r\n\t\t\tvar after = self.next();\r\n\t\t\tif(!after.length || self[0] === after[0])\r\n\t\t\t\tafter = false;\r\n\r\n\t\t\tvar before = self.prev();\r\n\t\t\tif(!before.length || self[0] === before[0])\r\n\t\t\t\tbefore = false;\r\n\r\n\t\t\tvar script = self.attr('sf-repeat-this');\r\n\t\t\tself.removeAttr('sf-repeat-this');\r\n\t\t\tvar controller = sf.controller.modelName(this);\r\n\r\n\t\t\tvar content = this.outerHTML;\r\n\r\n\t\t\t// Check if the element was already bound to prevent vulnerability\r\n\t\t\tif(/sf-bind-key|sf-bind-list/.test(content))\r\n\t\t\t\tthrow \"Can't parse element that already bound\";\r\n\r\n\t\t\tif(this.parentNode.classList.contains('sf-virtual-list')){\r\n\t\t\t\tif(loopParser(controller, content, script, targetNode, this.parentNode))\r\n\t\t\t\t\tself.remove();\r\n\t\t\t\telse {\r\n\t\t\t\t\tself.attr('sf-bind-list', script.split(' in ')[1]);\r\n\t\t\t\t\tclearElementData(this);\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar data = loopParser(controller, content, script, targetNode, this.parentNode);\r\n\t\t\tif(data){\r\n\t\t\t\tself.remove();\r\n\t\t\t\t\r\n\t\t\t\tdata = $(data);\r\n\t\t\t\tif(after)\r\n\t\t\t\t\tdata.insertBefore(after);\r\n\t\t\t\telse if(before)\r\n\t\t\t\t\tdata.insertAfter(before);\r\n\t\t\t\telse\r\n\t\t\t\t\tparent.append(data);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tself.attr('sf-bind-list', script.split(' in ')[1]);\r\n\t\t\t\tclearElementData(this);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t// Reset model properties\r\n\t// Don't call if the removed element is TEXT or #comment\r\n\tfunction DOMNodeRemoved(element){\r\n\t\t$('[sf-controller]', element).each(function(){\r\n\t\t\tremoveModelBinding(this.getAttribute('sf-controller'));\r\n\t\t});\r\n\r\n\t\tif(element.hasAttribute('sf-controller') === false)\r\n\t\t\treturn;\r\n\r\n\t\tremoveModelBinding(element.getAttribute('sf-controller'));\r\n\t}\r\n\r\n\tsf(function(){\r\n\t\tvar everyRemovedNodes = function(nodes){\r\n\t\t\tvar tagName = nodes.nodeName;\r\n\t\t\tif(tagName === 'TEXT' || tagName === '#text' || tagName === '#comment') return;\r\n\r\n\t\t\tDOMNodeRemoved(nodes);\r\n\t\t}\r\n\r\n\t\tif(typeof MutationObserver === 'function' && MutationObserver.prototype.observe){\r\n\t\t\tvar everyRecords = function(record){\r\n\t\t\t\trecord.removedNodes.forEach(everyRemovedNodes);\r\n\t\t\t}\r\n\r\n\t\t\tvar observer = new MutationObserver(function(records){\r\n\t\t\t\tif(!bindingEnabled) return;\r\n\t\t\t\trecords.forEach(everyRecords);\r\n\t\t\t});\r\n\r\n\t\t\tobserver.observe(document.body, { childList: true, subtree: true });\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdocument.body.addEventListener('DOMNodeRemoved', function(e){\r\n\t\t\t\tif(!bindingEnabled) return;\r\n\t\t\t\teveryRemovedNodes(e.target);\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\tvar removeModelBinding = function(modelName){\r\n\t\tvar ref = self.root[modelName];\r\n\t\tif(ref === undefined)\r\n\t\t\treturn;\r\n\r\n\t\tvar bindedKey = ref.sf$bindedKey;\r\n\t\tvar temp = null;\r\n\t\tfor(var key in bindedKey){\r\n\t\t\tdelete bindedKey[key];\r\n\r\n\t\t\tif(ref[key] === undefined || ref[key] === null)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tif(ref[key].constructor === String ||\r\n\t\t\t\tref[key].constructor === Number ||\r\n\t\t\t\tref[key].constructor === Boolean\r\n\t\t\t){/* Ok */}\r\n\r\n\t\t\telse if(ref[key].constructor === Array){\r\n\t\t\t\tif(ref[key].$virtual){\r\n\t\t\t\t\tref[key].$virtual.destroy();\r\n\t\t\t\t\tdelete ref[key].$virtual;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Reset property without copying the array\r\n\t\t\t\ttemp = ref[key].splice('obtain');\r\n\t\t\t\tdelete ref[key];\r\n\t\t\t\tref[key] = temp;\r\n\t\t\t}\r\n\t\t\telse continue;\r\n\r\n\t\t\tif(Object.getOwnPropertyDescriptor(ref, key) === undefined)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\t// Reconfigure / Remove property descriptor\r\n\t\t\tvar temp = ref[key];\r\n\t\t\tdelete ref[key];\r\n\t\t\tref[key] = temp;\r\n\t\t}\r\n\t}\r\n\r\n\tvar dcBracket = /{{[\\s\\S]*?}}/;\r\n\tvar bindObject = function(element, modelRef, propertyName, which){\r\n\t\tif(!(element instanceof Node))\r\n\t\t\telement = element[0];\r\n\r\n\t\t// Get reference for debugging\r\n\t\tprocessingElement = element;\r\n\r\n\t\t// First initialization\r\n\t\telement.setAttribute('sf-bind-key', propertyName);\r\n\t\tvar modelName = sf.controller.modelName(element);\r\n\r\n\t\t// Cache attribute content\r\n\t\tif(which === 'attr' || !which){\r\n\t\t\tvar attrs = {};\r\n\r\n\t\t\tfor(var i in element.attributes){\r\n\t\t\t\t// Check if it has a bracket\r\n\t\t\t\tif(!dcBracket.test(element.attributes[i].value))\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tvar attrName = element.attributes[i].name;\r\n\t\t\t\tif(attrName === 'value')\r\n\t\t\t\t\telement.removeAttribute(attrName);\r\n\r\n\t\t\t\tattrs[attrName] = element.attributes[i].value;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Cache html content\r\n\t\tif(which === 'html' || !which)\r\n\t\t\tvar innerHTML = element.innerHTML;\r\n\r\n\t\telement = $(element);\r\n\t\tvar onChanges = function(){\r\n\t\t\tif(which === 'attr' || !which){\r\n\t\t\t\tfor(var name in attrs){\r\n\t\t\t\t\tif(attrs[name].indexOf(propertyName) === -1)\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\tvar temp = dataParser(attrs[name], modelRef, false, modelName);\r\n\t\t\t\t\tif(name === 'value')\r\n\t\t\t\t\t\telement.val(temp);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\telement.attr(name, temp);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(which === 'html' || !which){\r\n\t\t\t\tvar temp = uniqueDataParser(innerHTML, modelRef, false, modelName);\r\n\t\t\t\ttemp = dataParser(temp, modelRef, false, modelName);\r\n\t\t\t\telement.html(temp);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tif(modelRef[propertyName] === undefined)\r\n\t\t\tthrow \"Property '\"+propertyName+\"' was not found on '\"+modelName+\"' model\";\r\n\r\n\t\t// Enable multiple element binding\r\n\t\tif(modelRef.sf$bindedKey === undefined)\r\n\t\t\tinitBindingInformation(modelRef);\r\n\r\n\t\tif(modelRef.sf$bindedKey[propertyName] !== undefined){\r\n\t\t\tmodelRef.sf$bindedKey[propertyName].push(onChanges);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar objValue = modelRef[propertyName]; // Object value\r\n\t\tObject.defineProperty(modelRef, propertyName, {\r\n\t\t\tenumerable: true,\r\n\t\t\tconfigurable: true,\r\n\t\t\tget:function(){\r\n\t\t\t\treturn objValue;\r\n\t\t\t},\r\n\t\t\tset:function(val){\r\n\t\t\t\tobjValue = val;\r\n\r\n\t\t\t\tvar ref = modelRef.sf$bindedKey[propertyName];\r\n\t\t\t\tfor (var i = 0; i < ref.length; i++) {\r\n\t\t\t\t\tref[i]();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn objValue;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tmodelRef.sf$bindedKey[propertyName] = [onChanges];\r\n\t}\r\n\r\n\tself.bindElement = function(element, which){\r\n\t\tvar modelName = sf.controller.modelName(element);\r\n\t\tvar model = self.root[modelName];\r\n\t\tif(!model) return console.error(\"Model for \"+modelName+\" was not found while binding:\", element);\r\n\r\n\t\tvar html = element.outerHTML;\r\n\r\n\t\t// Check if the child element was already bound to prevent vulnerability\r\n\t\tif(/sf-bind-key|sf-bind-list/.test(html))\r\n\t\t\tthrow \"Can't parse element that already bound\";\r\n\r\n\t\tif(which === 'attr')\r\n\t\t\thtml = html.replace(element.innerHTML, '');\r\n\r\n\t\tvar brackets = /{{([\\s\\S]*?)}}/g;\r\n\r\n\t\t// Unmatch any function\r\n\t\tvar variableList = self.modelKeys(model);\r\n\t\tfor(var i = variableList.length - 1; i >= 0; i--){\r\n\t\t\tif(model[variableList[i]] instanceof Function)\r\n\t\t\t\tvariableList.splice(i, 1);\r\n\t\t}\r\n\r\n\t\tvar scopeMask = RegExp(sf.regex.strictVar+'('+variableList+')'+sf.regex.avoidQuotes+'\\\\b', 'g');\r\n\t\tvar s1, s2 = null;\r\n\t\twhile((s1 = brackets.exec(html)) !== null){\r\n\t\t\twhile ((s2 = scopeMask.exec(s1[1])) !== null) {\r\n\t\t\t\tbindObject(element, model, s2[1], which);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tself.queuePreprocess = function(targetNode){\r\n\t\tvar childNodes = (targetNode || document.body).childNodes;\r\n\r\n\t\tvar excludes = ['html','head','style','link','meta','script','object','iframe'];\r\n\t\tfor (var i = 0; i < excludes.length; i++) {\r\n\t\t\texcludes[i] = excludes[i].toUpperCase();\r\n\t\t}\r\n\r\n\t\tvar temp = [];\r\n\t\tfor (var i = 0; i < childNodes.length; i++) {\r\n\t\t\tvar currentNode = childNodes[i];\r\n\t\t\tif(excludes.indexOf(currentNode.nodeName) !== -1)\r\n\t\t\t\tcontinue;\r\n\r\n\t\t\tif(currentNode.nodeType === 1){ // Tag\r\n\t\t\t\tvar attrs = currentNode.attributes;\r\n\r\n\t\t\t\t// Skip element and it's childs that already bound to prevent vulnerability\r\n\t\t\t\tif(attrs['sf-bind-key'] || attrs['sf-repeat-this'] || attrs['sf-bind-list']) continue;\r\n\r\n\t\t\t\tfor (var a = 0; a < attrs.length; a++) {\r\n\t\t\t\t\tif(attrs[a].value.indexOf('{{') !== -1){\r\n\t\t\t\t\t\tcurrentNode.setAttribute('sf-preprocess', 'attronly');\r\n\t\t\t\t\t\ttemp.push(currentNode);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttemp = temp.concat(self.queuePreprocess(currentNode));\r\n\t\t\t}\r\n\r\n\t\t\telse if(currentNode.nodeType === 3){ // Text\r\n\t\t\t\tif(currentNode.nodeValue.indexOf('{{') !== -1){\r\n\t\t\t\t\tcurrentNode.parentNode.setAttribute('sf-preprocess', '');\r\n\r\n\t\t\t\t\t// Reset Siblings\r\n\t\t\t\t\tfor (var a = 0; a < temp.length; a++) {\r\n\t\t\t\t\t\ttemp[a].removeAttribute('sf-preprocess');\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttemp.push(currentNode.parentNode);\r\n\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn temp;\r\n\t}\r\n\r\n\tself.parsePreprocess = function(nodes){\r\n\t\tfor (var a = 0; a < nodes.length; a++) {\r\n\t\t\tvar model = sf.controller.modelName(nodes[a]);\r\n\t\t\tnodes[a].removeAttribute('sf-preprocess');\r\n\r\n\t\t\tif(!self.root[model])\r\n\t\t\t\treturn console.error(\"Can't parse element because model for '\"+model+\"' was not found\", nodes[a]);\r\n\r\n\t\t\tvar modelRef = self.root[model];\r\n\r\n\t\t\t// Get reference for debugging\r\n\t\t\tprocessingElement = nodes[a];\r\n\r\n\t\t\t// Double check if the child element already bound to prevent vulnerability\r\n\t\t\tif(/sf-bind-key|sf-bind-list/.test(nodes[a].innerHTML)){\r\n\t\t\t\tconsole.error(\"Can't parse element that already bound\");\r\n\t\t\t\tconsole.log($(processingElement.outerHTML)[0]);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif($(nodes[a]).attr('sf-bind'))\r\n\t\t\t\tself.bindElement(nodes[a], $(nodes[a]).attr('sf-bind'));\r\n\r\n\t\t\t// Avoid editing the outerHTML because it will remove the bind\r\n\t\t\tvar temp = uniqueDataParser(nodes[a].innerHTML, self.root[model], false, model);\r\n\t\t\tnodes[a].innerHTML = dataParser(temp, self.root[model], false, model);\r\n\t\t\tfor (var i = 0; i < nodes[a].attributes.length; i++) {\r\n\t\t\t\tif(nodes[a].attributes[i].value.indexOf('{{') !== -1){\r\n\t\t\t\t\tnodes[a].attributes[i].value = dataParser(nodes[a].attributes[i].value, self.root[model], false, model);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction initBindingInformation(modelRef){\r\n\t\tif(modelRef.sf$bindedKey !== undefined)\r\n\t\t\treturn;\r\n\r\n\t\t// Element binding data\r\n\t\tObject.defineProperty(modelRef, 'sf$bindedKey', {\r\n\t\t\tconfigurable: true,\r\n\t\t\tenumerable:false,\r\n\t\t\twritable:true,\r\n\t\t\tvalue:{}\r\n\t\t});\r\n\t}\r\n})();","sf.router = new function(){\r\n\tvar self = this;\r\n\tself.loading = false;\r\n\tself.enabled = false;\r\n\tself.pauseRenderOnTransition = false;\r\n\tself.currentPage = [];\r\n\tvar initialized = false;\r\n\tvar lazyRouting = false;\r\n\tvar currentRouterURL = '';\r\n\r\n\t// Should be called if not using lazy page load\r\n\tself.init = function(targetNode){\r\n\t\tif(!sf.loader.DOMWasLoaded)\r\n\t\t\treturn sf(function(){\r\n\t\t\t\tself.init();\r\n\t\t\t});\r\n\r\n\t\t// Run 'before' event for new page view\r\n\t\t$('[sf-controller], [sf-page]', $(targetNode)[0]).each(function(){\r\n\t\t\tif(this.attributes['sf-controller'])\r\n\t\t\t\tsf.controller.run(this.attributes['sf-controller'].value);\r\n\t\t\t\r\n\t\t\tif(this.attributes['sf-page']){\r\n\t\t\t\tvar name = this.attributes['sf-page'].value;\r\n\t\t\t\tbeforeEvent(name);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tinitialized = true;\r\n\t\tcurrentRouterURL = window.location.pathname;\r\n\t}\r\n\r\n\tfunction popstateListener(event) {\r\n\t\t// Don't continue if the last routing was error\r\n\t\tif(routingError){\r\n\t\t\troutingError = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\troutingBack = true;\r\n\t\tself.goto(window.location.pathname);\r\n\t}\r\n\r\n\tself.enable = function(status){\r\n\t\tif(status === undefined) status = true;\r\n\t\tif(self.enabled === status) return;\r\n\t\tself.enabled = status;\r\n\r\n\t\tif(status === true){\r\n\t\t\t// Create listener for link click\r\n\t\t\t$(document.body).on('click', 'a[href]', self.load);\r\n\r\n\t\t\t// Create listener when navigate backward\r\n\t\t\twindow.addEventListener('popstate', popstateListener, false);\r\n\t\t}\r\n\t\telse{\r\n\t\t\t$(document.body).off('click', 'a[href]', self.load);\r\n\t\t\twindow.removeEventListener('popstate', popstateListener, false);\r\n\t\t}\r\n\t}\r\n\r\n\tvar before = {};\r\n\t// Set index with number if you want to replace old function\r\n\tself.before = function(name, func, index){\r\n\t\tif(!before[name])\r\n\t\t\tbefore[name] = [];\r\n\r\n\t\tif(index === undefined){\r\n\t\t\tif(before[name].indexOf(func) === -1)\r\n\t\t\t\tbefore[name].push(func);\r\n\t\t}\r\n\t\telse\r\n\t\t\tbefore[name][index] = func;\r\n\t}\r\n\r\n\tvar after = {};\r\n\t// Set index with number if you want to replace old function\r\n\tself.after = function(name, func, index){\r\n\t\tif(!after[name])\r\n\t\t\tafter[name] = [];\r\n\r\n\t\tif(index === undefined){\r\n\t\t\tif(after[name].indexOf(func) === -1)\r\n\t\t\t\tafter[name].push(func);\r\n\t\t}\r\n\t\telse\r\n\t\t\tafter[name][index] = func;\r\n\t}\r\n\r\n\tvar root_ = function(scope){\r\n\t\tif(!sf.model.root[scope])\r\n\t\t\tsf.model.root[scope] = {};\r\n\r\n\t\tif(!sf.model.root[scope])\r\n\t\t\tsf.controller.run(scope);\r\n\t\t\r\n\t\treturn sf.model.root[scope];\r\n\t}\r\n\r\n\t// Running 'before' new page going to be displayed\r\n\tvar beforeEvent = function(name){\r\n\t\tif(self.currentPage.indexOf(name) === -1)\r\n\t\t\tself.currentPage.push(name);\r\n\r\n\t\tif(before[name]){\r\n\t\t\tfor (var i = 0; i < before[name].length; i++) {\r\n\t\t\t\tbefore[name][i](root_);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Running 'after' old page going to be removed\r\n\tvar afterEvent = function(name){\r\n\t\tif(self.currentPage.indexOf(name) === -1)\r\n\t\t\tself.currentPage.splice(self.currentPage.indexOf(name), 1);\r\n\r\n\t\tif(after[name]){\r\n\t\t\tfor (var i = 0; i < after[name].length; i++) {\r\n\t\t\t\tafter[name][i](root_);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar onEvent = {\r\n\t\t'loading':[],\r\n\t\t'loaded':[],\r\n\t\t'special':[],\r\n\t\t'error':[]\r\n\t};\r\n\tself.on = function(event, func){\r\n\t\tif(onEvent[event].indexOf(func) === -1)\r\n\t\t\tonEvent[event].push(func);\r\n\t}\r\n\r\n\tself.lazyViewPoint = {};\r\n\t/*\r\n\t\t{\r\n\t\t\toldURlPattern:{\r\n\t\t\t\tnewURLPattern:'.viewPoint'\r\n\t\t\t}\r\n\t\t}\r\n\t*/\r\n\r\n\tself.load = function(ev){\r\n\t\tif(self.enabled !== true) return;\r\n\r\n\t\tvar elem = ev.target;\r\n\t\tif(!elem.href) return;\r\n\r\n\t\tif(!history.pushState || elem.hasAttribute('sf-router-ignore'))\r\n\t\t\treturn;\r\n\r\n\t\t// Make sure it's from current origin\r\n\t\tvar path = elem.href.replace(window.location.origin, '');\r\n\t\tif(path.indexOf('//') !== -1)\r\n\t\t\treturn;\r\n\r\n\t\tev.preventDefault()\r\n\t\treturn !self.goto(path);\r\n\t}\r\n\r\n\tvar RouterLoading = false;\r\n\tvar routingBack = false;\r\n\tvar routingError = false;\r\n\tself.goto = function(path, data, method){\r\n\t\tif(!method) method = 'GET';\r\n        else method = method.toUpperCase();\r\n\r\n\t\tif(!data) data = {};\r\n\r\n\t\tfor (var i = 0; i < onEvent['loading'].length; i++) {\r\n\t\t\tif(onEvent['loading'][i](path)) return;\r\n\t\t}\r\n\t\tvar oldPath = window.location.pathname;\r\n\t\tinitialized = false;\r\n\r\n\t\tif(RouterLoading) RouterLoading.abort();\r\n\t\tRouterLoading = $.ajax({\r\n\t\t\turl:window.location.origin + path,\r\n\t\t\tmethod:method,\r\n            data:Object.assign(data, {\r\n                _scarlets:'.dynamic.'\r\n            }),\r\n\t\t\tsuccess:function(data){\r\n\t\t\t\tif(initialized) return;\r\n\t\t\t\tlazyRouting = true;\r\n\r\n\t\t\t\t// Run 'loaded' event\r\n\t\t\t\tRouterLoading = false;\r\n\r\n\t\t\t\t// Find special data\r\n\t\t\t\tvar regex = RegExp('<!-- SF-Special:(.*?)-->'+sf.regex.avoidQuotes, 'gm');\r\n\t\t\t\tvar special = regex.exec(data);\r\n\t\t\t\tif(special && special.length !== 1){\r\n\t\t\t\t\tspecial = special[1].split('--|&>').join('-->');\r\n\t\t\t\t\tspecial = JSON.parse(special);\r\n\r\n\t\t\t\t\tif(!$.isEmptyObject(special)){\r\n\t\t\t\t\t\tfor (var i = 0; i < onEvent['special'].length; i++) {\r\n\t\t\t\t\t\t\tif(onEvent['special'][i](special)) return;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar DOMReference = false;\r\n\t\t\t\tvar foundAction = function(ref){\r\n\t\t\t\t\tDOMReference = $(ref);\r\n\r\n\t\t\t\t\t// Run 'after' event for old page view\r\n\t\t\t\t\tafterEvent($('[sf-page]', DOMReference[0]).attr('sf-page'));\r\n\r\n\t\t\t\t\t// Redefine title if exist\r\n\t\t\t\t\tif(special && special.title)\r\n\t\t\t\t\t\t$('head title').html(special.title);\r\n\r\n\t\t\t\t\tfound = true;\r\n\t\t\t\t};\r\n\r\n\t\t\t\tvar found = false;\r\n\t\t\t\tfor(var oldURL in self.lazyViewPoint){\r\n\t\t\t\t\tif(currentRouterURL.indexOf(oldURL) !== -1){\r\n\t\t\t\t\t\tfor(var newURL in self.lazyViewPoint[oldURL]){\r\n\t\t\t\t\t\t\tif(currentRouterURL.indexOf(oldURL) !== -1){\r\n\t\t\t\t\t\t\t\tfoundAction(self.lazyViewPoint[oldURL][newURL]);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(found) break;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// When the view point was not found\r\n\t\t\t\tif(!found){\r\n\t\t\t\t\t// Use fallback if exist\r\n\t\t\t\t\tif(sf.router.lazyViewPoint[\"@default\"])\r\n\t\t\t\t\t\tfoundAction(sf.router.lazyViewPoint[\"@default\"]);\r\n\r\n\t\t\t\t\tif(!found){\r\n\t\t\t\t\t\tfor (var i = 0; i < onEvent['error'].length; i++) {\r\n\t\t\t\t\t\t\tonEvent['error'][i]('sf.router.lazyViewPoint[\"'+oldURL+'\"][\"'+newURL+'\"] was not found');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Run 'before' event for new page view\r\n\t\t\t\tif(!DOMReference) DOMReference = $(document.body);\r\n\t\t\t\tif(self.pauseRenderOnTransition)\r\n\t\t\t\t\tself.pauseRenderOnTransition.css('display', 'none');\r\n\r\n\t\t\t\t// Let page script running first, then update the data binding\r\n\t\t\t\tDOMReference.html(data);\r\n\r\n\t\t\t\t// Parse the DOM data binding\r\n\t\t\t\tsf.model.init(DOMReference);\r\n\r\n\t\t\t\t// Init template to model binding\r\n\t\t\t\t$('[sf-page]', DOMReference[0]).each(function(){\r\n\t\t\t\t\tif(this.attributes['sf-page'])\r\n\t\t\t\t\t\tbeforeEvent(this.attributes['sf-page'].value);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif(self.pauseRenderOnTransition)\r\n\t\t\t\t\tself.pauseRenderOnTransition.css('display', '');\r\n\r\n\t\t\t\trouterLoaded(currentRouterURL, path, DOMReference);\r\n\r\n\t\t\t\tinitialized = true;\r\n\t\t\t\tlazyRouting = false;\r\n\r\n\t\t\t\tcurrentRouterURL = path;\r\n\t\t\t\troutingError = false;\r\n\t\t\t},\r\n\t\t\terror:function(xhr, data){\r\n\t\t\t\troutingError = true;\r\n\t\t\t\tif(xhr.aborted) return;\r\n\r\n\t\t\t\tRouterLoading = false;\r\n\t\t\t\tfor (var i = 0; i < onEvent['error'].length; i++) {\r\n\t\t\t\t\tonEvent['error'][i](xhr.status, data);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Back on error\r\n\t\t\t\twindow.history.back();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif(!routingBack)\r\n\t\t\twindow.history.pushState(null, \"\", path);\r\n\r\n\t\troutingBack = false;\r\n\t\treturn true;\r\n\t}\r\n\r\n\t// Trigger loaded event\r\n\tfunction routerLoaded(currentRouterURL, path, data){\r\n\t\tfor (var i = 0; i < onEvent['loaded'].length; i++) {\r\n\t\t\tonEvent['loaded'][i](currentRouterURL, path, data);\r\n\t\t}\r\n\t}\r\n};","sf.internal.virtual_scroll = new function(){\r\n\tvar self = this;\r\n\tvar styleInitialized = false;\r\n\tvar scrollingByScript = false;\r\n\r\n\t// before and after\r\n\tself.prepareCount = 4; // 4, 8, 12, 16, ...\r\n\r\n\tself.handle = function(list, targetNode, parentNode){\r\n\t\tif(!styleInitialized){\r\n\t\t\tinitStyles();\r\n\t\t\tstyleInitialized = true;\r\n\t\t}\r\n\r\n\t\tlist.$virtual.elements = function(){\r\n\t\t\treturn obtainElements(list, parentNode);\r\n\t\t}\r\n\r\n\t\tlist.$virtual.dCursor = { // DOM Cursor\r\n\t\t\tceiling:parentNode.querySelector('.virtual-spacer.ceiling'),\r\n\t\t\tfloor:parentNode.querySelector('.virtual-spacer.floor')\r\n\t\t};\r\n\r\n\t\tlist.$virtual.bounding = {\r\n\t\t\tceiling:-1,\r\n\t\t\tfloor:0\r\n\t\t}\r\n\r\n\t\tlist.$virtual.vCursor = { // Virtual Cursor\r\n\t\t\tceiling:null, // for forward direction\r\n\t\t\tfloor:null // for backward direction\r\n\t\t}\r\n\r\n\t\tlist.$virtual.targetNode = parentNode;\r\n\t\tlist.$virtual.DOMCursor = 0; // cursor of first element in DOM tree as a cursor\r\n\r\n\t\tlist.$virtual.scrollHeight = \r\n\t\t\tlist.$virtual.dCursor.floor.offsetTop - \r\n\t\t\tlist.$virtual.dCursor.ceiling.offsetTop;\r\n\r\n\t\tvar scroller = null;\r\n\t\tlist.$virtual.destroy = function(){\r\n\t\t\t$(scroller).off('scroll');\r\n\t\t\t$(parentNode).off('mousedown mouseup');\r\n\t\t\tlist.$virtual.dom.innerHTML = '';\r\n\t\t\toffElementResize(parentNode);\r\n\t\t\tdelete list.$virtual;\r\n\t\t}\r\n\r\n\t\tlist.$virtual.resetViewport = function(){\r\n\t\t\tlist.$virtual.visibleLength = Math.floor(scroller.clientHeight / list.$virtual.scrollHeight);\r\n\t\t\tlist.$virtual.preparedLength = list.$virtual.visibleLength + self.prepareCount * 2;\r\n\t\t}\r\n\r\n\t\tsetTimeout(function(){\r\n\t\t\tscroller = parentNode;\r\n\r\n\t\t\tvar length = parentNode.getAttribute('scroll-parent-index') || 0;\r\n\t\t\tfor (var i = 0; i < length; i++) {\r\n\t\t\t\tscroller = scroller.parentElement;\r\n\t\t\t}\r\n\r\n\t\t\tlist.$virtual.resetViewport();\r\n\r\n\t\t\tif(parentNode.classList.contains('sf-list-dynamic'))\r\n\t\t\t\tdynamicHeight(list, targetNode, parentNode, scroller);\r\n\t\t\telse\r\n\t\t\t\tstaticHeight(list, targetNode, parentNode, scroller);\r\n\t\t}, 500);\r\n\t}\r\n\r\n\t// Recommended for a list that have different element height\r\n\tfunction dynamicHeight(list, targetNode, parentNode, scroller){\r\n\t\tvar virtual = list.$virtual;\r\n\t\tvar ceiling = virtual.dCursor.ceiling;\r\n\t\tvar floor = virtual.dCursor.floor;\r\n\t\tvar vCursor = virtual.vCursor;\r\n\t\tvCursor.floor = virtual.dom.firstElementChild;\r\n\t\t\r\n\t\tvirtual.scrollTo = function(index){\r\n\t\t\tscrollTo(index, list, self.prepareCount, parentNode, scroller);\r\n\t\t}\r\n\r\n\t\tvirtual.refresh = function(force){\r\n\t\t\trefresh(force, list, self.prepareCount, parentNode, scroller);\r\n\t\t}\r\n\r\n\t\t// Insert some element until reach visible height\r\n\t\tfillViewport();\r\n\r\n\t\tvirtual.visibleLength = parentNode.childElementCount - 2;\r\n\t\tvirtual.preparedLength = virtual.visibleLength + self.prepareCount * 2;\r\n\r\n\t\tfor (var i = 0; i < self.prepareCount; i++) {\r\n\t\t\tvar temp = vCursor.floor;\r\n\t\t\tif(temp === null) break;\r\n\r\n\t\t\tvCursor.floor = temp.nextElementSibling;\r\n\t\t\tfloor.insertAdjacentElement('beforeBegin', temp);\r\n\t\t}\r\n\t\tvirtual.DOMCursor = 0;\r\n\r\n\t\tvar ceilingHeight = 0;\r\n\t\tvar floorHeight = 0;\r\n\t\tfunction previousCeiling(){\r\n\t\t\tvar temp = null;\r\n\t\t\tvar resetCeiling = false;\r\n\r\n\t\t\t// Add some element on the ceiling\r\n\t\t\tfor (var i = 0; i < self.prepareCount; i++) {\r\n\t\t\t\tif(vCursor.floor === null)\r\n\t\t\t\t\ttemp = virtual.dom.lastElementChild;\r\n\t\t\t\telse\r\n\t\t\t\t\ttemp = vCursor.floor.previousElementSibling;\r\n\r\n\t\t\t\tif(temp === null) break;\r\n\t\t\t\tvCursor.ceiling = temp.previousElementSibling;\r\n\t\t\t\tvirtual.DOMCursor--;\r\n\r\n\t\t\t\tceiling.insertAdjacentElement('afterEnd', temp);\r\n\r\n\t\t\t\tif(ceilingHeight > 0)\r\n\t\t\t\t\tceilingHeight -= getAbsoluteHeight(temp);\r\n\r\n\t\t\t\tif(virtual.DOMCursor < self.prepareCount && !resetCeiling){\r\n\t\t\t\t\ti = 0;\r\n\t\t\t\t\tresetCeiling = true;\r\n\t\t\t\t\ttemp = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(ceilingHeight < 0 || temp === null)\r\n\t\t\t\tceilingHeight = 0;\r\n\r\n\t\t\tvar length = parentNode.childElementCount - 2 - list.$virtual.preparedLength;\r\n\t\t\t// Remove some element on the floor\r\n\t\t\tfor (var i = 0; i < length; i++) {\r\n\t\t\t\ttemp = floor.previousElementSibling;\r\n\t\t\t\tfloorHeight += getAbsoluteHeight(temp);\r\n\r\n\t\t\t\tif(vCursor.floor === null)\r\n\t\t\t\t\tvirtual.dom.insertAdjacentElement('beforeEnd', temp);\r\n\t\t\t\telse vCursor.floor.insertAdjacentElement('beforeBegin', temp);\r\n\r\n\t\t\t\tvCursor.floor = temp;\r\n\t\t\t}\r\n\r\n\t\t\tif(vCursor.floor === null)\r\n\t\t\t\tvCursor.ceiling = virtual.dom.lastElementChild;\r\n\t\t\telse \r\n\t\t\t\tvCursor.ceiling = vCursor.floor.previousElementSibling;\r\n\r\n\t\t\tceiling.style.height = ceilingHeight+'px';\r\n\t\t\tfloor.style.height = floorHeight+'px';\r\n\t\t}\r\n\r\n\t\tfunction fillViewport(){\r\n\t\t\t// Insert some element depend on prepared length\r\n\t\t\tvar length = virtual.preparedLength - (parentNode.childElementCount - 2);\r\n\t\t\tfor (var i = 0; i < length; i++) {\r\n\t\t\t\tif(vCursor.ceiling === null)\r\n\t\t\t\t\ttemp = virtual.dom.firstElementChild;\r\n\t\t\t\telse\r\n\t\t\t\t\ttemp = vCursor.ceiling.nextElementSibling;\r\n\r\n\t\t\t\tif(temp === null) break;\r\n\t\t\t\tvCursor.floor = temp.nextElementSibling;\r\n\r\n\t\t\t\tfloor.insertAdjacentElement('beforeBegin', temp);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction nextFloor(){\r\n\t\t\tvar temp = null;\r\n\t\t\tfillViewport();\r\n\r\n\t\t\tif(vCursor.ceiling === null)\r\n\t\t\t\tvCursor.ceiling = vCursor.floor.previousElementSibling;\r\n\r\n\t\t\t// Add extra element based on prepare count\r\n\t\t\tfor (var i = 0; i < self.prepareCount; i++) {\r\n\t\t\t\ttemp = vCursor.floor;\r\n\t\t\t\tif(temp === null) break;\r\n\r\n\t\t\t\tvCursor.floor = temp.nextElementSibling;\r\n\t\t\t\tfloor.insertAdjacentElement('beforeBegin', temp);\r\n\r\n\t\t\t\tif(floorHeight > 0)\r\n\t\t\t\t\tfloorHeight -= getAbsoluteHeight(temp);\r\n\t\t\t}\r\n\r\n\t\t\tif(floorHeight < 0 || temp === null)\r\n\t\t\t\tfloorHeight = 0;\r\n\r\n\t\t\t// Remove some element on the ceiling\r\n\t\t\tvar length = parentNode.childElementCount - 2 - list.$virtual.preparedLength;\r\n\t\t\tfor (var i = 0; i < length; i++) {\r\n\t\t\t\ttemp = ceiling.nextElementSibling;\r\n\t\t\t\tceilingHeight += getAbsoluteHeight(temp);\r\n\t\t\t\tvirtual.DOMCursor++;\r\n\r\n\t\t\t\tif(vCursor.ceiling === null)\r\n\t\t\t\t\tvirtual.dom.insertAdjacentElement('afterBegin', temp);\r\n\t\t\t\telse vCursor.ceiling.insertAdjacentElement('afterEnd', temp);\r\n\r\n\t\t\t\tvCursor.ceiling = temp;\r\n\t\t\t}\r\n\r\n\t\t\tif(vCursor.ceiling === null)\r\n\t\t\t\tvCursor.floor = virtual.dom.firstElementChild;\r\n\t\t\telse \r\n\t\t\t\tvCursor.floor = vCursor.ceiling.nextElementSibling;\r\n\r\n\t\t\tceiling.style.height = ceilingHeight+'px';\r\n\t\t\tfloor.style.height = floorHeight+'px';\r\n\t\t}\r\n\r\n\t\tvar bounding = virtual.bounding;\r\n\t\trefreshScrollBounding(0, bounding, list, parentNode);\r\n\r\n\t\tvar updating = false;\r\n\t\tfunction checkCursorPosition(){\r\n\t\t\tif(updating || scrollingByScript) return;\r\n\t\t\tupdating = true;\r\n\r\n\t\t\tif(scroller.scrollTop < bounding.ceiling){\r\n\t\t\t\t// console.log('back', bounding, scroller.scrollTop, virtual.DOMCursor);\r\n\t\t\t\tpreviousCeiling();\r\n\t\t\t\trefreshScrollBounding(virtual.DOMCursor, bounding, list, parentNode);\r\n\t\t\t\t// console.warn('back', bounding, scroller.scrollTop, virtual.DOMCursor);\r\n\t\t\t}\r\n\r\n\t\t\telse if(scroller.scrollTop > bounding.floor){\r\n\t\t\t\t// console.log('front', bounding, scroller.scrollTop, virtual.DOMCursor);\r\n\t\t\t\tnextFloor();\r\n\t\t\t\trefreshScrollBounding(virtual.DOMCursor, bounding, list, parentNode);\r\n\t\t\t\t// console.warn('front', bounding, scroller.scrollTop, virtual.DOMCursor);\r\n\t\t\t}\r\n\r\n\t\t\tupdating = false;\r\n\t\t}\r\n\r\n\t\t$(scroller).on('scroll', checkCursorPosition);\r\n\t\tonElementResize(parentNode, function(){\r\n\t\t\trefreshScrollBounding(virtual.DOMCursor, bounding, list, parentNode);\r\n\t\t});\r\n\t}\r\n\r\n\t// Recommended for a list that have similar element height\r\n\tfunction staticHeight(list, targetNode, parentNode, scroller){\r\n\t\tvar virtual = list.$virtual;\r\n\t\tvar ceiling = virtual.dCursor.ceiling;\r\n\t\tvar floor = virtual.dCursor.floor;\r\n\r\n\t\t// Insert visible element to dom tree\r\n\t\tvar insertCount = virtual.preparedLength <= list.length ? virtual.preparedLength : list.length;\r\n\t\tfor (var i = 0; i < insertCount; i++) {\r\n\t\t\tif(virtual.dom.firstElementChild === null)\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tfloor.insertAdjacentElement('beforeBegin', virtual.dom.firstElementChild);\r\n\t\t}\r\n\r\n\t\tfunction refreshVirtualSpacer(cursor){\r\n\t\t\tif(cursor >= self.prepareCount){\r\n\t\t\t\tceiling.style.height = (cursor - self.prepareCount) * virtual.scrollHeight + 'px';\r\n\t\t\t\tfloor.style.height = (list.length - virtual.preparedLength - cursor) * virtual.scrollHeight + 'px';\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tceiling.style.height = cursor * virtual.scrollHeight + 'px'; //'0px';\r\n\t\t\t\tvar count = (list.length - virtual.preparedLength);\r\n\t\t\t\tfloor.style.height = (count || 0) * virtual.scrollHeight + 'px';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar bounding = virtual.bounding;\r\n\r\n\t\trefreshVirtualSpacer(0);\r\n\t\trefreshScrollBounding(self.prepareCount, bounding, list, parentNode);\r\n\t\tbounding.ceiling = -1;\r\n\r\n\t\tvirtual.offsetTo = function(index){\r\n\t\t\treturn index * virtual.scrollHeight + ceiling.offsetTop;\r\n\t\t}\r\n\r\n\t\tvar vCursor = virtual.vCursor;\r\n\t\tvCursor.floor = virtual.dom.firstElementChild;\r\n\t\tvirtual.scrollTo = function(index){\r\n\t\t\tscrollTo(index, list, self.prepareCount, parentNode, scroller, refreshVirtualSpacer);\r\n\t\t}\r\n\r\n\t\tvirtual.refresh = function(force){\r\n\t\t\trefresh(force, list, self.prepareCount, parentNode, scroller, checkCursorPosition, refreshVirtualSpacer);\r\n\t\t}\r\n\r\n\t\tvar updating = false;\r\n\t\tvar fromCeiling = true;\r\n\t\tvar scrollFocused = false;\r\n\t\tfunction checkCursorPosition(){\r\n\t\t\tif(updating || scrollingByScript || scroller.scrollTop >= bounding.ceiling && scroller.scrollTop <= bounding.floor){\r\n\t\t\t\t// Fix chrome scroll anchoring bugs when scrolling at corner\r\n\t\t\t\tif(scrollFocused){\r\n\t\t\t\t\tif(scroller.scrollTop === 0 || scroller.scrollTop === scroller.scrollHeight - scroller.clientHeight){\r\n\t\t\t\t\t\tremoveUserScrollFocus(scroller);\r\n\t\t\t\t\t\tscrollFocused = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar cursor = Math.floor(scroller.scrollTop / virtual.scrollHeight);\r\n\t\t\tif(cursor + virtual.preparedLength > list.length)\r\n\t\t\t\tcursor = list.length - virtual.preparedLength;\r\n\r\n\t\t\tif(fromCeiling){\r\n\t\t\t\tif(cursor < self.prepareCount*2)\r\n\t\t\t\t\tcursor -= self.prepareCount;\r\n\r\n\t\t\t\t// Fix chrome scroll anchoring bugs\r\n\t\t\t\tif(scrollFocused){\r\n\t\t\t\t\tremoveUserScrollFocus(scroller);\r\n\t\t\t\t\tscrollFocused = false;\r\n\t\t\t\t}\r\n\t\t\t\tfromCeiling = false;\r\n\t\t\t}\r\n\r\n\t\t\tif(cursor < self.prepareCount){\r\n\t\t\t\tcursor = 0;\r\n\t\t\t\tfromCeiling = true;\r\n\t\t\t}\r\n\r\n\t\t\tupdating = true;\r\n\r\n\t\t\tvar changes = cursor - virtual.DOMCursor;\r\n\t\t\tif(cursor + changes >= list.length)\r\n\t\t\t\tchanges = cursor + changes - list.length;\r\n\r\n\t\t\tif(changes === 0){ // This should be fixed to improve performance and future bugs\r\n\t\t\t\t//console.warn(\"No changes (The scroll bounding is not correct)\");\r\n\t\t\t\tupdating = false;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvirtual.DOMCursor = cursor;\r\n\r\n\t\t\t//console.log(cursor, changes);\r\n\r\n\t\t\t//console.log(cursor, changes, bounding.ceiling, bounding.floor, scroller.scrollTop);\r\n\t\t\tmoveElementCursor(changes, list);\r\n\t\t\trefreshVirtualSpacer(cursor);\r\n\t\t\trefreshScrollBounding(cursor, bounding, list, parentNode);\r\n\t\t\t//console.log('a', bounding.ceiling, bounding.floor, scroller.scrollTop);\r\n\r\n\t\t\tupdating = false;\r\n\t\t}\r\n\r\n\t\t$(scroller).on('scroll', checkCursorPosition);\r\n\r\n\t\t// For preventing scroll jump if scrolling over than viewport\r\n\t\tif(scroller === parentNode && navigator.userAgent.indexOf('Chrom') !== -1){\r\n\t\t\t$(parentNode).on('mousedown', function(){\r\n\t\t\t\tscrollFocused = true;\r\n\t\t\t});\r\n\t\t\t$(parentNode).on('mouseup', function(){\r\n\t\t\t\tscrollFocused = false;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tfunction refreshScrollBounding(cursor, bounding, list, parentNode){\r\n\t\tvar temp = Math.floor(self.prepareCount / 2); // half of element preparation\r\n\t\tif(cursor < self.prepareCount){\r\n\t\t\tbounding.ceiling = -1;\r\n\t\t\tbounding.floor = parentNode.children[self.prepareCount * 2 + 1];\r\n\r\n\t\t\tif(bounding.floor !== undefined)\r\n\t\t\t\tbounding.floor = bounding.floor.offsetTop;\r\n\t\t\telse bounding.floor = parentNode.lastElementChild.offsetTop + 1000;\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\t\telse if(parentNode.children[temp + 1] !== undefined)\r\n\t\t\t\tbounding.ceiling = parentNode.children[temp + 1].offsetTop; // -2 element\r\n\r\n\t\tif(list.$virtual.preparedLength !== undefined && cursor >= list.length - list.$virtual.preparedLength)\r\n\t\t\tbounding.floor = list.$virtual.dCursor.floor.offsetTop + list.$virtual.scrollHeight*2;\r\n\t\telse{\r\n\t\t\tbounding.floor = parentNode.children[self.prepareCount + 3].offsetTop; // +2 element\r\n\r\n\t\t\tif(parentNode.hasAttribute('scroll-reduce-floor')){\r\n\t\t\t\tbounding.floor -= parentNode.getAttribute('scroll-reduce-floor');\r\n\t\t\t\tbounding.ceiling -= parentNode.getAttribute('scroll-reduce-floor');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction moveElementCursor(changes, list){\r\n\t\tvar vDOM = list.$virtual.dom;\r\n\t\tvar vCursor = list.$virtual.vCursor;\r\n\t\tvar dCursor = list.$virtual.dCursor;\r\n\r\n\t\tif(changes > 0){ // forward\r\n\t\t\tvar ref = 0;\r\n\r\n\t\t\t// Select from virtual ceiling cursor to Dom tree\r\n\t\t\tfor (var i = 0; i < changes; i++) { // vDom -> Dom tree\r\n\t\t\t\tif(vCursor.ceiling === null)\r\n\t\t\t\t\tref = vDOM.firstElementChild;\r\n\r\n\t\t\t\telse ref = vCursor.ceiling.nextElementSibling;\r\n\t\t\t\tdCursor.floor.insertAdjacentElement('beforeBegin', ref);\r\n\t\t\t}\r\n\r\n\t\t\t// Move element on the ceiling to vDom\r\n\t\t\tfor (var i = changes; i > 0; i--) { // Dom tree -> vDom\r\n\t\t\t\tif(vCursor.ceiling === null){\r\n\t\t\t\t\tvCursor.ceiling = dCursor.ceiling.nextElementSibling;\r\n\t\t\t\t\tvDOM.insertAdjacentElement('afterBegin', vCursor.ceiling);\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tref = dCursor.ceiling.nextElementSibling;\r\n\t\t\t\t\tvCursor.ceiling.insertAdjacentElement('afterEnd', ref);\r\n\t\t\t\t\tvCursor.ceiling = ref;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvCursor.floor = vCursor.ceiling.nextElementSibling;\r\n\t\t}\r\n\t\telse if(changes < 0){ // backward\r\n\t\t\tvar ref = 0;\r\n\t\t\tchanges = -changes;\r\n\r\n\t\t\t// Select from virtual floor cursor to Dom tree\r\n\t\t\tfor (var i = 0; i < changes; i++) { // vDom -> Dom tree\r\n\t\t\t\tif(vCursor.floor === null)\r\n\t\t\t\t\tref = vDOM.lastElementChild;\r\n\r\n\t\t\t\telse ref = vCursor.floor.previousElementSibling;\r\n\t\t\t\tdCursor.ceiling.insertAdjacentElement('afterEnd', ref);\r\n\t\t\t}\r\n\r\n\t\t\t// Move element on the floor to vDom\r\n\t\t\tfor (var i = 0; i < changes; i++) { // Dom tree -> vDom\r\n\t\t\t\tif(vCursor.floor === null){\r\n\t\t\t\t\tvCursor.floor = dCursor.floor.previousElementSibling;\r\n\t\t\t\t\tvDOM.insertAdjacentElement('beforeEnd', vCursor.floor);\r\n\t\t\t\t}\r\n\r\n\t\t\t\telse{\r\n\t\t\t\t\tref = dCursor.floor.previousElementSibling;\r\n\t\t\t\t\tvCursor.floor.insertAdjacentElement('beforeBegin', ref);\r\n\t\t\t\t\tvCursor.floor = ref;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvCursor.ceiling = vCursor.floor.previousElementSibling;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction scrollTo(index, list, prepareCount, parentNode, scroller, refreshVirtualSpacer){\r\n\t\tvar virtual = list.$virtual;\r\n\t\tvar reduce = 0;\r\n\r\n\t\tif(index >= list.length - virtual.preparedLength){\r\n\t\t\treduce -= prepareCount;\r\n\t\t\tindex = list.length - virtual.preparedLength;\r\n\t\t}\r\n\r\n\t\tif(index - virtual.DOMCursor === 0 || index >= list.length) return;\r\n\r\n\t\tscrollingByScript = true;\r\n\r\n\t\t// Already on DOM tree\r\n\t\tif((virtual.DOMCursor === 0 && index < prepareCount + prepareCount/2) ||\r\n\t\t\t(virtual.DOMCursor + prepareCount/2 > index\r\n\t\t\t&& virtual.DOMCursor + prepareCount < index))\r\n\t\t\tscroller.scrollTop = parentNode.children[index - virtual.DOMCursor + 1].offsetTop;\r\n\r\n\t\t// Move cursor\r\n\t\telse {\r\n\t\t\tvar temp = null;\r\n\t\t\tvar ceiling = virtual.dCursor.ceiling;\r\n\t\t\tvar floor = virtual.dCursor.floor;\r\n\t\t\tvar vCursor = virtual.vCursor;\r\n\r\n\t\t\t// DOM tree to virtual DOM\r\n\t\t\tvar length = parentNode.childElementCount - 2;\r\n\t\t\tfor (var i = 0; i < length; i++) {\r\n\t\t\t\ttemp = ceiling.nextElementSibling;\r\n\r\n\t\t\t\tif(vCursor.floor === null){\r\n\t\t\t\t\tvirtual.dom.insertAdjacentElement('beforeEnd', temp);\r\n\r\n\t\t\t\t\tif(i === length-1)\r\n\t\t\t\t\t\tvCursor.floor = temp;\r\n\t\t\t\t}\r\n\t\t\t\telse vCursor.floor.insertAdjacentElement('beforeBegin', temp);\r\n\t\t\t}\r\n\r\n\t\t\tif(index >= prepareCount){\r\n\t\t\t\tif(index < list.length - virtual.preparedLength)\r\n\t\t\t\t\tindex -= prepareCount;\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\treduce = prepareCount - index;\r\n\t\t\t\tvirtual.DOMCursor = index = 0;\r\n\t\t\t}\r\n\r\n\t\t\tvar insertCount = virtual.preparedLength <= list.length ? virtual.preparedLength : list.length;\r\n\r\n\t\t\t// Virtual DOM to DOM tree\r\n\t\t\tfor (var i = 0; i < insertCount; i++) {\r\n\t\t\t\ttemp = virtual.dom.children[index];\r\n\t\t\t\tif(temp === undefined) break;\r\n\r\n\t\t\t\tfloor.insertAdjacentElement('beforeBegin', temp);\r\n\t\t\t}\r\n\t\t\tvirtual.DOMCursor = index;\r\n\r\n\t\t\tvCursor.floor = virtual.dom.children[index] || null;\r\n\t\t\tvCursor.ceiling = vCursor.floor ? vCursor.floor.previousElementSibling : null;\r\n\r\n\t\t\tif(refreshVirtualSpacer)\r\n\t\t\t\trefreshVirtualSpacer(index);\r\n\r\n\t\t\trefreshScrollBounding(index, virtual.bounding, list, parentNode);\r\n\r\n\t\t\ttemp = parentNode.children[prepareCount - reduce + 1];\r\n\t\r\n\t\t\tif(temp !== undefined)\r\n\t\t\t\tscroller.scrollTop = temp.offsetTop - scroller.offsetTop;\r\n\t\t}\r\n\r\n\t\tscrollingByScript = false;\r\n\t}\r\n\r\n\tfunction removeUserScrollFocus(parentNode){\r\n\t\tparentNode.style.overflow = 'hidden';\r\n\t\tsetTimeout(function(){\r\n\t\t\tparentNode.style.overflow = '';\r\n\t\t}, 50);\r\n\t}\r\n\r\n\tfunction getAbsoluteHeight(el){\r\n\t  var styles = window.getComputedStyle(el);\r\n\t  var margin = parseInt(styles['marginTop']) + parseInt(styles['marginBottom']);\r\n\t  return el.offsetHeight + margin || 0;\r\n\t}\r\n\r\n\tfunction obtainElements(list, parentNode){\r\n\t\tvar exist = [];\r\n\t\tvar temp = undefined;\r\n\r\n\t\tvar length = list.$virtual.DOMCursor;\r\n\t\tfor (var i = 0; i < length; i++) {\r\n\t\t\ttemp = list.$virtual.dom.children[i];\r\n\t\t\tif(temp === undefined) break;\r\n\t\t\texist.push(temp);\r\n\t\t}\r\n\r\n\t\tlength = parentNode.childElementCount - 2;\r\n\t\tfor (var i = 1; i <= length; i++) {\r\n\t\t\ttemp = parentNode.children[i];\r\n\t\t\tif(temp === undefined) break;\r\n\t\t\texist.push(temp);\r\n\t\t}\r\n\r\n\t\tlength = list.length - length - list.$virtual.DOMCursor;\r\n\t\tfor (var i = 0; i < length; i++) {\r\n\t\t\ttemp = list.$virtual.dom.children[list.$virtual.DOMCursor + i];\r\n\t\t\tif(temp === undefined) break;\r\n\t\t\texist.push(temp);\r\n\t\t}\r\n\r\n\t\treturn exist;\r\n\t}\r\n\r\n\tfunction refresh(force, list, prepareCount, parentNode, scroller, checkCursorPosition, refreshVirtualSpacer){\r\n\t\tvar cursor = list.$virtual.DOMCursor;\r\n\t\tvar additionalScroll = 0;\r\n\r\n\t\t// Find nearest cursor for current view position\r\n\t\tif(force){\r\n\t\t\tvar i = -1;\r\n\t\t\tvar length = list.$virtual.preparedLength;\r\n\r\n\t\t\tdo{\r\n\t\t\t\ti++;\r\n\t\t\t} while(i < length && parentNode.children[i].offsetTop < scroller.scrollTop);\r\n\r\n\t\t\tcursor = cursor + i;\r\n\t\t\tif(cursor > 0) cursor -= 1;\r\n\r\n\t\t\tadditionalScroll = scroller.scrollTop - parentNode.children[i].offsetTop;\r\n\t\t}\r\n\r\n\t\t// Force move cursor if element in the DOM tree was overloaded\r\n\t\tif(force || parentNode.childElementCount - 2 > list.$virtual.preparedLength){\r\n\t\t\tlist.$virtual.DOMCursor = list.length;\r\n\t\t\tvar moveTo = cursor;\r\n\t\t\tif(!force)\r\n\t\t\t\tmoveTo = cursor <= prepareCount ? cursor : (cursor + prepareCount);\r\n\r\n\t\t\tscrollTo(moveTo,\r\n\t\t\t\tlist,\r\n\t\t\t\tprepareCount,\r\n\t\t\t\tparentNode,\r\n\t\t\t\tscroller,\r\n\t\t\t\trefreshVirtualSpacer\r\n\t\t\t);\r\n\r\n\t\t\tscroller.scrollTop += additionalScroll;\r\n\t\t}\r\n\r\n\t\tif(refreshVirtualSpacer)\r\n\t\t\trefreshVirtualSpacer(cursor);\r\n\r\n\t\tif(checkCursorPosition)\r\n\t\t\tcheckCursorPosition();\r\n\r\n\t\trefreshScrollBounding(cursor, list.$virtual.bounding, list, parentNode);\r\n\t}\r\n\r\n\tvar _onElementResize = [];\r\n\tvar _onElementResize_timer = -1;\r\n\tfunction onElementResize(parentNode, callback){\r\n\t\tif(_onElementResize_timer === -1){\r\n\t\t\t_onElementResize_timer = setInterval(function(){\r\n\t\t\t\tvar temp = null;\r\n\t\t\t\tfor (var i = _onElementResize.length - 1; i >= 0; i--) {\r\n\t\t\t\t\ttemp = _onElementResize[i];\r\n\r\n\t\t\t\t\t// Check resize\r\n\t\t\t\t\tif(temp.element.scrollHeight === temp.height\r\n\t\t\t\t\t\t|| temp.element.scrollWidth === temp.width)\r\n\t\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t\t// Check if it's removed from DOM\r\n\t\t\t\t\tif(temp.element.parentElement === null){\r\n\t\t\t\t\t\t_onElementResize.splice(i, 1);\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttemp.callback();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(_onElementResize.length === 0){\r\n\t\t\t\t\tclearInterval(_onElementResize_timer);\r\n\t\t\t\t\t_onElementResize_timer = -1;\r\n\t\t\t\t}\r\n\t\t\t}, 200);\r\n\t\t}\r\n\r\n\t\t_onElementResize.push({\r\n\t\t\telement:parentNode,\r\n\t\t\tcallback:callback,\r\n\t\t\theight:parentNode.scrollHeight,\r\n\t\t\twidth:parentNode.scrollWidth\r\n\t\t});\r\n\t}\r\n\r\n\tfunction offElementResize(parentNode){\r\n\t\tfor (var i = _onElementResize.length - 1; i >= 0; i--) {\r\n\t\t\tif(_onElementResize[i].element === parentNode)\r\n\t\t\t\t_onElementResize.splice(i, 1);\r\n\t\t}\r\n\r\n\t\t// Interval will be cleared when the array is empty\r\n\t}\r\n\r\n\tfunction initStyles(){\r\n\t\tvar style = document.getElementById('sf-styles');\r\n\r\n\t\tif(!style){\r\n\t\t\tstyle = document.createElement('style');\r\n\t\t\tstyle.id = 'sf-styles';\r\n        \tdocument.head.appendChild(style);\r\n\t\t}\r\n\r\n\t\tstyle.sheet.insertRule(\r\n\t\t'.sf-virtual-list .virtual-spacer{'+\r\n            'visibility: hidden;'+\r\n            'position: relative;'+\r\n            'height: 1px;'+\r\n            'transform-origin: 0 0;'+\r\n            'width: 1px;'+\r\n            'margin: 0;'+\r\n            'padding: 0;'+\r\n            'background: none;'+\r\n            'border: none;'+\r\n            'box-shadow: none;'+\r\n         '}');\r\n\t}\r\n};"]}